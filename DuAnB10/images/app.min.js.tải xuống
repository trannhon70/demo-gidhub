function fallingSnow(){function a(){if(!document.getElementById("canvas"))return void clearInterval(c);e.clearRect(0,0,d.width,d.height),e.fillStyle="rgba(255, 255, 255, 1)",e.beginPath();for(var a=0;i>a;a++){var g=k[a];if(g.s<o){var h=Math.max(g.d/i,n/m);e.translate(g.x,g.y),e.rotate(-g.a),e.drawImage(f[0],-m/2*h,-m/2*h,m*h,m*h),e.rotate(g.a),e.translate(-g.x,-g.y)}else e.moveTo(g.x,g.y),e.arc(g.x,g.y,g.r,0,2*Math.PI,!0)}e.fill(),b()}function b(){q+=.01;for(var a=0;i>a;a++){var b=k[a];if(b.y+=Math.cos(q+b.d)+1+b.r/2,b.x+=2*Math.sin(q),b.s<o){var c=Math.max(b.d/i,n/m);b.a+=l/c*Math.sin(q)}(b.x>d.width+5||b.x<-5||b.y>d.height)&&(a%3>0?k[a]={x:Math.random()*d.width,y:-10,r:b.r,d:b.d,a:b.a,s:b.s}:Math.sin(q)>0?k[a]={x:-5,y:Math.random()*d.height,r:b.r,d:b.d,a:b.a,s:b.s}:k[a]={x:d.width+5,y:Math.random()*d.height,r:b.r,d:b.d,a:b.a,s:b.s})}}var c,d=document.getElementById("canvas"),e=d.getContext("2d"),f=document.getElementsByClassName("snowflake"),g=window.innerWidth,h=window.innerHeight;d.width=g,d.height=h;for(var i=300,j=0,k=[],l=.05,m=24,n=15,o=15,p=0;i>p;p++)k.push({x:Math.random()*d.width,y:Math.random()*d.height,r:2*Math.random()+1,d:Math.random()*i,a:Math.random()*Math.PI,s:j++});var q=0;c=setInterval(a,33)}function floatingCloud(){function a(){d.style.opacity=1,d.style.left="80%",e.style.opacity=1,e.style.left="0",f=1,1>g&&setTimeout(function(){b()},4e3)}function b(){d.style.opacity=0,e.style.opacity=0,d.style.left="50%",e.style.left="50%",setTimeout(function(){1==f?c():a()},3e3)}function c(){d.style.opacity=1,d.style.left="0",e.style.opacity=1,e.style.left="80%",f=0,g++,setTimeout(function(){b()},4e3)}var d=$(".cloud1","#navbarHeader")[0],e=$(".cloud2","#navbarHeader")[0],f=1,g=0;d&&e&&a()}var Common={};Common.convertDate=function(a){var b=a.split("-");return b[2]+"/"+b[1]+"/"+b[0]},Common.dayOfWeek=["Chủ nhật","Thứ hai","Thứ ba","Thứ tư","Thứ năm","Thứ sáu","Thứ bảy"],Common.mergeQueryString=function(a){var b=[];for(var c in a)b.push(c+"="+a[c]);return"?"+b.join("&")},Common.isBooking=function(a){var b=["1","2","3","4","6","16","17","18","19","20","22","23","24","25"];return b.includes(a)};var Config={object_type:{news:1,review:2,comment:3,comment_cinema:31,comment_news:32}},Dictionary={};Dictionary.definition={vi:{hello:"Xin chao",choose_film:"Vui lòng chọn phim",map:"Bản đồ",no_session:"Không có suất chiếu"},en:{hello:"Hello",choose_film:"Please choose movie",map:"Map",no_session:"No session"}},Dictionary.get=function(a,b){return Dictionary.definition[a][b]},function(){angular.module("TIX").controller("AppController",[function(){$(function(){var a=document.documentElement,b=$("#tai-app");b.click(function(){$.scrollTo("#gioi-thieu",500)}),$(window).scroll(function(c){window.pageYOffset<a.offsetHeight-window.innerHeight?b.fadeIn(200):b.fadeOut(200)}),$("#slider").slick({autoplay:!0,autoplaySpeed:2e3,dots:!1,arrows:!1})})}])}(),$(function(){function a(){b=$("#sliderTrailer").height()+61;var a=Math.max(b+d-window.innerHeight,0);c.scrollTop()>=a&&c.scrollTop()<$("body").height()-1200?($("#supportFixedLeft").addClass("active"),$("#supportFixedRight").addClass("active")):($("#supportFixedLeft").removeClass("active"),$("#supportFixedRight").removeClass("active"))}var b,c=($("#supportFixed"),$("#footer"),$(window)),d=327;window.addEventListener("load",a),window.addEventListener("resize",a),window.addEventListener("scroll",a)}),function(){angular.module("TIX").controller("CheckoutBHDController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$stateParams","CommonService",function(a,b,c,d,e,f,g,h,i){function j(){a.merchantCode=d.params.merchantCode,a.cinemaCode=d.params.cinemaCode?d.params.cinemaCode:"",a.sessionCode=d.params.sessionCode,a.usersessionid=d.params.usersessionid,a.userid=d.params.userid,a.isBHDMember=!1,a.isRedirectOuterPage=!1,a.bhdUserEmail="",a.bhdUserPhone="",g.get(c,{url:"/session/merchant?merchantCode="+a.merchantCode+"&cinemaCode="+a.cinemaCode+"&sessionCode="+a.sessionCode,keyCache:"no-cache"},function(b){var e=b.data.result;e?angular.isDefined(a.merchantCode)&&"4"===a.merchantCode?(a.refId=1,g.get(c,{url:"/checkout/bhd/loyalty?method=ValidateMember&MemberId="+a.userid+"&UserSessionId="+a.usersessionid,keyCache:"no-cache"},function(b){if(!b.data.hasOwnProperty("error")){a.isBHDMember=!0,a.bhdUserEmail=b.data.result.LoyaltyMember.Email,a.bhdUserPhone=b.data.result.LoyaltyMember.MobilePhone;var c={result:{isBHDMember:!0,bhdUserEmail:a.bhdUserEmail,bhdUserPhone:a.bhdUserPhone,userId:a.userid,userSessionId:a.usersessionid,validated:!0},expire:Math.floor(Date.now()/1e3)};localStorage.setItem("bhdMember",JSON.stringify(c))}a.pCinemaId=4,a.isRedirectOuterPage=!0,d.go("checkout.index",{sessionId:e})})):d.go("checkout.index",{sessionId:e}):d.go("main.home")})}j(),b.reloadcheckoutInvalid=function(){document.location.href="/"}}])}(),function(){angular.module("TIX").controller("CheckoutController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","APIServiceV2","$stateParams","CommonService","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){a.user.user_id||v();var b=localStorage.getItem("bhdMember");null!==b&&angular.isDefined(b)&&(x=JSON.parse(b).result),a.isBHDMember=x.isBHDMember,a.isRedirectOuterPage=x.isBHDMember,a.bhdUserEmail=x.bhdUserEmail,a.bhdUserPhone=x.bhdUserPhone,a.userid=x.userId,a.usersessionid=x.userSessionId,!x.validated&&angular.isDefined(a.userid)&&angular.isDefined(a.usersessionid)&&g.get(c,{url:"/checkout/bhd/loyalty?method=ValidateMember&MemberId="+a.userid+"&UserSessionId="+a.usersessionid,keyCache:"no-cache"},function(a){}),x.validated=!1;var e={result:x,expire:Math.floor(Date.now()/1e3)};localStorage.setItem("bhdMember",JSON.stringify(e)),a.sessionId=d.params.sessionId,u()}function m(a){var b=a.split("-");return b[2]+"/"+b[1]+"/"+b[0]}function n(b){var c=b.split(" ")[0];a.session_date=m(c);for(var d=parseInt(c[8]+c[9]),e=0;7>e;e++)if(moment().add("days",e).date()==d)return 0==e?"Hôm nay":1==e?"Ngày mai":Common.dayOfWeek[moment().add("days",e).day()]}function o(a){var b=a.split(" ")[1].split(":");return b[0]+":"+b[1]}function p(){a.isNewApi?h.get(c,{url:"/api/booking/lotte/tickettype",keyCache:"no-cache"},function(b){return a.fullchosen=!0,"0"!=b.data.code?void(a.errorGetTicket=b.data.msg):(a.maxTotalCapacity=b.data.data.maxCapacity,void t(b.data.data.tickets))},function(a){console.log("error")}):g.get(c,{url:"/cinevouchers/type",keyCache:"no-cache"},function(b){a.fullchosen=!0,t(b.data.result)},function(a){console.log("error")})}function q(){h.get(c,{url:"/api/booking/standard/tickettype?sessionId="+a.sessionId,keyCache:"no-cache"},function(b){if(!_.isUndefined(b.data)&&"0"==b.data.code){a.seatTicketType={},a.listStandardTicketType=[],a.modalStudentDesc=b.data.data.desc;for(var c=b.data.data.tickets,d=[2,3,16,20],e=[7],f=0;f<c.length;f++){_.isUndefined(a.listStandardTicketType[c[f].ticketType])&&(a.listStandardTicketType[c[f].ticketType]={},a.seatTicketType[c[f].ticketType]={},a.seatTicketType[c[f].ticketType].title=c[f].ticketDesc,a.seatTicketType[c[f].ticketType].codes=[]);for(var g=0;g<c[f].seatPrices.length;g++)-1!=e.indexOf(c[f].seatPrices[g].seatType-0)?a.listStandardTicketType[c[f].ticketType][c[f].seatPrices[g].seatType]=c[f].seatPrices[g].price/3:-1!=d.indexOf(c[f].seatPrices[g].seatType-0)?a.listStandardTicketType[c[f].ticketType][c[f].seatPrices[g].seatType]=c[f].seatPrices[g].price/2:a.listStandardTicketType[c[f].ticketType][c[f].seatPrices[g].seatType]=c[f].seatPrices[g].price}_.isUndefined(a.listStandardTicketType[1])||(a.isAllowedStudentPrice=!0)}r()},function(a){console.log("error"),r()})}function r(){a.isLoadConfig=!0,$(window).width()>768&&(a.step=3,setTimeout(function(){var a=$("#rightcheckout").width(),b=Math.floor(100*($("#stepcheckout").width()-a+20)/$("#stepcheckout").width());$(window).width()>=1024&&$("#stepcheckout").css("width",b.toString()+"%")},500))}function s(){h.get(c,{url:"/api/booking/vista/tickettype?sessionId="+a.sessionId+"&userHash="+a.user.user_hash,keyCache:"no-cache"},function(b){if("0"!=b.data.code)return void(a.errorGetTicket=b.data.msg);var c=b.data.data;a.maxTotalCapacity=b.data.maxTotalCapacity,t(c)},function(a){console.log("error")})}function t(b){if(a.loadingTicketData=!1,a.isLoadConfig=!0,a.ticketTypes.length=0,1==a.isNewApi)if(1==a.pCinemaId)for(var c in b){var d={};d.type_num=0,d.type_desc=b[c].name,d.type_price=b[c].price,d.type_descdetail=b[c].desc,d.type_code=b[c].id,d.type_capacity=b[c].capacity?b[c].capacity:1,a.ticketTypes.push(d)}else for(var c in b){var d={};d.type_num=0,d.type_desc=b[c].typeName,d.type_price=b[c].typePrice,d.type_area=b[c].areaId,d.type_code=b[c].typeCode,d.type_capacity=b[c].typeCapacity?b[c].typeCapacity:1,_.isUndefined(b[c].typeDesc)||""==b[c].typeDesc||(d.type_descdetail=b[c].typeDesc),a.ticketTypes.push(d)}else if(1==a.pCinemaId)for(var c in b){var d={};d.type_num=0,d.type_desc=b[c].title,d.type_price=b[c].price,d.type_descdetail=b[c].description,d.type_code=b[c].id,d.type_max=12==b[c].id?5:10,d.type_capacity=12==b[c].id?2:1,a.ticketTypes.push(d)}else if(2==a.pCinemaId||4==a.pCinemaId||6==a.pCinemaId||17==a.pCinemaId)for(var c in b){var d={};d.type_num=0,d.type_desc=b[c].type_description,d.type_price=b[c].type_price,d.type_area=b[c].area_id,d.type_code=b[c].type_code,d.type_max=b[c].type_max,d.type_capacity=b[c].typeCapacity?b[c].typeCapacity:1,b[c].description&&""!=b[c].description&&(d.type_descdetail=b[c].description),a.ticketTypes.push(d)}a.ticketTypes[0].type_num=2,j.calTotal(a)}function u(){h.get(c,{url:"/api/data/session?sessionId="+a.sessionId,keyCache:"no-cache"},function(c){if(_.isUndefined(c.data)||_.isEmpty(c.data))d.go("main.home");else{if(0==c.data.code){var e=c.data.data;a.pCinemaId=e.pCinemaId,a.pCinemaId_real=e.pCinemaId,a.flowId=e.pCinema.flowId,a.cinema_id=e.cinemaId,a.cinemaAddress=e.cinema.address,a.cinema_name=e.cinema.name,a.cinema_logo=e.pCinema.logo,a.cinemaCode=e.cinemaCode,a.pCinema=e.cinema.nameS1,a.pName=e.cinema.nameS2,a.sessionCode=e.sessionCode,a.session_time_original=e.time,a.session_time=o(e.time),a.session_day=n(e.time),a.room_name=e.room.name,a.film_duration=e.film.duration,a.film_name=e.film.nameVI,a.film_id=e.film.id,a.film_age=e.film.age,a.leftImage=a.isMobile?e.film.images.type6_path:e.film.images.type1_path,a.imdb_point=e.film.imdbPoint,b.ageRestrict=e.film.age,a.isAcceptAgeRestrict=b.ageRestrict>0?!1:!0,a.exitsVip=!0,y[a.sessionId]?a.version_id=y[a.sessionId]:a.version_id=w(e.version,e.isDub),k.init(),1!=a.pCinemaId?k.setDefaultTag("title",a.film_name):k.setDefaultTag("title","Lotte - Voucher"),1==a.pCinemaId?(a.isAcceptAgeRestrict=!0,a.step=1,a.colorpCinema="#CA4137",a.isNewApi=!0,p()):2==a.pCinemaId?(a.step=1,a.colorpCinema="#ff6600",a.loadingTicketData=!0,a.isNewApi=!0,a.exitsVip=!1,s()):3==a.pCinemaId?(a.step=2,a.pCinemaId=16,a.colorpCinema="#9C9C9C",a.isNewApi=!0,a.user.is_allow_cgv=1,r()):4==a.pCinemaId?(a.colorpCinema="#8bc541",a.loadingTicketData=!0,a.step=2,a.pCinemaId=16,a.isNewApi=!0,a.exitsVip=!0,r()):6==a.pCinemaId?(a.step=2,a.pCinemaId=16,a.colorpCinema="#9C9C9C",a.isNewApi=!0,r()):17==a.pCinemaId?(a.step=1,a.colorpCinema="#e5a813",a.loadingTicketData=!0,a.isNewApi=!0,a.exitsVip=!1,s()):16==a.pCinemaId?(a.step=2,a.colorpCinema="#df0d7a",a.isNewApi=!0,1==a.isMobile?r():q()):19==a.pCinemaId?(a.step=2,a.pCinemaId=16,a.colorpCinema="#008FE5",a.isNewApi=!0,r()):20==a.pCinemaId?(a.step=2,a.pCinemaId=16,a.colorpCinema="#9C9C9C",a.isNewApi=!0,r()):22==a.pCinemaId?(a.step=2,a.pCinemaId=16,a.colorpCinema="#ea3b92",a.isNewApi=!0,r()):23==a.pCinemaId||24==a.pCinemaId?(a.step=2,a.pCinemaId=16,a.colorpCinema="#008FE5",a.isNewApi=!0,r()):25==a.pCinemaId&&(a.step=2,a.pCinemaId=16,a.colorpCinema="#008FE5",a.isNewApi=!0,r())}else d.go("main.home");$("#mainContent").addClass("checkout")}},function(a){console.log("error")})}function v(){a.redirectUrlLogin=d.current.name,a.redirectParams={};for(var b in d.params)a.redirectParams[b]=d.params[b];d.go("login.index1",{})}function w(a,b){var c="";return c+=a+"D",2==a&&(c+=_.isUndefined(b)||1!=b?"/Digital":"/L.Tiếng"),c}a.leftImage="",a.step=5,a.cinema_name="",a.cinema_logo="",a.session_time_original="",a.session_time="",a.session_day="",a.session_date="",a.room_name="",a.totalPrice=0,a.imdb_point=0,a.rating=0,a.version_id=0,a.film_duration=0,a.film_name="",a.pCinema="",a.pName="",a.colorpCinema="",a.ticketTypes=[],a.sessionId=0,a.sessionCode=0,a.cinemaCode=0,a.userSessionId="",a.fullchosen=!1,a.totalticket=2,a.user_session_id="";var x={};a.errorGetTicket="",a.countUnload=0,a.isHideUserNotSignIn=!0,a.isShowModalAgeRestrict=!1,a.isAcceptAgeRestrict=!1,b.ageRestrict=13,a.isNewApi=!1,a.isLoadConfig=!1,a.loadingTicketData=!1,a.isShowModalStudent=!1,a.isStudentPrice=!1,a.isAllowedStudentPrice=!1;var y=JSON.parse(localStorage.getItem("sessionVersion"));(null===y||angular.isUndefined(y))&&(y=[]),l(),a.maxTotalCapacity=10,$(window).width()<=768&&(a.isMobile=!0),a.convertMoney=function(a){return(a/1e3).toFixed(3).replace(/(\d)(?=(\d{3})+\.)/g,"$1.")},a.convertMoneyMobile=function(a){return a.toFixed(0).replace(/(\d)(?=(\d{3})+\.)/g,"$1.")},a.closeAgeRestrict=function(){a.isShowModalAgeRestrict=!1},a.showModalStudent=function(b){a.isShowModalStudent=!0},a.closeModalStudent=function(){a.isShowModalStudent=!1}}])}(),function(){angular.module("TIX").controller("CheckoutLeftController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService",function(a,b,c,d,e,f,g){b.backPage=function(){d.go("main.home")},b.removeAge=function(a){var b="";if(void 0!=a){var c=a.indexOf("(");b=-1!=c?a.slice(0,c):a}return b}}])}(),function(){angular.module("TIX").controller("CheckoutComboController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService",function(a,b,c,d,e,f,g){function h(){a.combocost=0;for(var b in a.combolist)for(var c in a.combolist[b].items)a.combolist[b].items[c].amount>0&&(a.combocost+=a.combolist[b].items[c].item_cost)}function i(){a.combocost=0;for(var b in a.combolist)for(var c in a.combolist[b].concessions)a.combolist[b].concessions[c].amount>0&&(a.combocost+=a.combolist[b].concessions[c].cost)}var j=0,k=0;b.totalComboAmount=0,b.maxComboAmount=10,b.addCombo=function(c){++b.totalComboAmount,c.amount=Math.min(10,c.amount+1),c.item_cost=c.amount*c.item_price,a.sendGA("Payment","Click Next Combo",c.amount+" "+c.item_name),h(),$(window).width()>768?$("#totalcost").is(":animated")?($("#totalcost").stop(!0,!1).animate({fontSize:(j+10).toString()+"px"},400),$("#totalcost").animate({fontSize:j.toString()+"px"},400)):(j=parseInt($("#totalcost").css("font-size")),$("#totalcost").animate({fontSize:(j+10).toString()+"px"},400).animate({fontSize:j.toString()+"px"},400)):$("#totalcostmobile").is(":animated")?($("#totalcostmobile").stop(!0,!1).animate({fontSize:(j+8).toString()+"px"},400),$("#totalcostmobile").animate({fontSize:j.toString()+"px"},400),$("#detailsub").stop(!0,!1).animate({fontSize:(k+4).toString()+"px","margin-top":"2px","margin-bottom":"13px"},400),$("#detailsub").animate({fontSize:k.toString()+"px","margin-top":"0px","margin-bottom":"10px"},400),$("#detailunit").stop(!0,!1).animate({fontSize:(k+4).toString()+"px"},400),$("#detailunit").animate({fontSize:k.toString()+"px"},400)):(j=parseInt($("#totalcostmobile").css("font-size")),k=j/2-2,$("#totalcostmobile").animate({fontSize:(j+8).toString()+"px"},400).animate({fontSize:j.toString()+"px"},400),$("#detailsub").animate({fontSize:(k+4).toString()+"px","margin-top":"2px","margin-bottom":"13px"},400).animate({fontSize:k.toString()+"px","margin-top":"0px","margin-bottom":"10px"},400),$("#detailunit").animate({fontSize:(k+4).toString()+"px"},400).animate({fontSize:k.toString()+"px"},400))},b.minusCombo=function(a){--b.totalComboAmount,a.amount=Math.max(0,a.amount-1),a.item_cost=a.amount*a.item_price,h(),$(window).width()>768?$("#totalcost").is(":animated")?($("#totalcost").stop(!0,!1).animate({fontSize:(j+10).toString()+"px"},400),$("#totalcost").animate({fontSize:j.toString()+"px"},400)):(j=parseInt($("#totalcost").css("font-size")),$("#totalcost").animate({fontSize:(j+10).toString()+"px"},400).animate({fontSize:j.toString()+"px"},400)):$("#totalcostmobile").is(":animated")?($("#totalcostmobile").stop(!0,!1).animate({fontSize:(j+8).toString()+"px"},400),$("#totalcostmobile").animate({fontSize:j.toString()+"px"},400),$("#detailsub").stop(!0,!1).animate({fontSize:(k+4).toString()+"px","margin-top":"2px","margin-bottom":"13px"},400),$("#detailsub").animate({fontSize:k.toString()+"px","margin-top":"0px","margin-bottom":"10px"},400),$("#detailunit").stop(!0,!1).animate({fontSize:(k+4).toString()+"px"},400),$("#detailunit").animate({fontSize:k.toString()+"px"},400)):(j=parseInt($("#totalcostmobile").css("font-size")),k=j/2-2,$("#totalcostmobile").animate({fontSize:(j+8).toString()+"px"},400).animate({fontSize:j.toString()+"px"},400),$("#detailsub").animate({fontSize:(k+4).toString()+"px","margin-top":"2px","margin-bottom":"13px"},400).animate({fontSize:k.toString()+"px","margin-top":"0px","margin-bottom":"10px"},400),$("#detailunit").animate({fontSize:(k+4).toString()+"px"},400).animate({fontSize:k.toString()+"px"},400))},b["continue"]=function(){$("#combocheckout").hide(),$(window).width()<=768&&($("#stepcheckout").show(),$("#rightcheckout").show())},b.addComboNew=function(c){++b.totalComboAmount,c.amount=Math.min(10,c.amount+1),c.cost=c.amount*c.price,a.sendGA("Payment","Click Next Combo",c.amount+" "+c.name),i(),$(window).width()>768?$("#totalcost").is(":animated")?($("#totalcost").stop(!0,!1).animate({fontSize:(j+10).toString()+"px"},400),$("#totalcost").animate({fontSize:j.toString()+"px"},400)):(j=parseInt($("#totalcost").css("font-size")),$("#totalcost").animate({fontSize:(j+10).toString()+"px"},400).animate({fontSize:j.toString()+"px"},400)):$("#totalcostmobile").is(":animated")?($("#totalcostmobile").stop(!0,!1).animate({fontSize:(j+8).toString()+"px"},400),$("#totalcostmobile").animate({fontSize:j.toString()+"px"},400),$("#detailsub").stop(!0,!1).animate({fontSize:(k+4).toString()+"px","margin-top":"2px","margin-bottom":"13px"},400),$("#detailsub").animate({fontSize:k.toString()+"px","margin-top":"0px","margin-bottom":"10px"},400),$("#detailunit").stop(!0,!1).animate({fontSize:(k+4).toString()+"px"},400),$("#detailunit").animate({fontSize:k.toString()+"px"},400)):(j=parseInt($("#totalcostmobile").css("font-size")),k=j/2-2,$("#totalcostmobile").animate({fontSize:(j+8).toString()+"px"},400).animate({fontSize:j.toString()+"px"},400),$("#detailsub").animate({fontSize:(k+4).toString()+"px","margin-top":"2px","margin-bottom":"13px"},400).animate({fontSize:k.toString()+"px","margin-top":"0px","margin-bottom":"10px"},400),$("#detailunit").animate({fontSize:(k+4).toString()+"px"},400).animate({fontSize:k.toString()+"px"},400))},b.minusComboNew=function(a){--b.totalComboAmount,a.amount=Math.max(0,a.amount-1),a.cost=a.amount*a.price,i(),$(window).width()>768?$("#totalcost").is(":animated")?($("#totalcost").stop(!0,!1).animate({fontSize:(j+10).toString()+"px"},400),$("#totalcost").animate({fontSize:j.toString()+"px"},400)):(j=parseInt($("#totalcost").css("font-size")),$("#totalcost").animate({fontSize:(j+10).toString()+"px"},400).animate({fontSize:j.toString()+"px"},400)):$("#totalcostmobile").is(":animated")?($("#totalcostmobile").stop(!0,!1).animate({fontSize:(j+8).toString()+"px"},400),$("#totalcostmobile").animate({fontSize:j.toString()+"px"},400),$("#detailsub").stop(!0,!1).animate({fontSize:(k+4).toString()+"px","margin-top":"2px","margin-bottom":"13px"},400),$("#detailsub").animate({fontSize:k.toString()+"px","margin-top":"0px","margin-bottom":"10px"},400),$("#detailunit").stop(!0,!1).animate({fontSize:(k+4).toString()+"px"},400),$("#detailunit").animate({fontSize:k.toString()+"px"},400)):(j=parseInt($("#totalcostmobile").css("font-size")),k=j/2-2,$("#totalcostmobile").animate({fontSize:(j+8).toString()+"px"},400).animate({fontSize:j.toString()+"px"},400),$("#detailsub").animate({fontSize:(k+4).toString()+"px","margin-top":"2px","margin-bottom":"13px"},400).animate({fontSize:k.toString()+"px","margin-top":"0px","margin-bottom":"10px"},400),$("#detailunit").animate({fontSize:(k+4).toString()+"px"},400).animate({fontSize:k.toString()+"px"},400))}}])}(),function(){angular.module("TIX").controller("CheckoutRightController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","APIServiceV2",function(a,b,c,d,e,f,g,h){function i(){return angular.isDefined(a.isBHDMember)&&a.isBHDMember&&""!==a.bhdUserEmail?a.bhdUserEmail:(ea=localStorage.getItem("email"),(angular.isUndefined(ea)||null===ea)&&angular.isDefined(ga)&&null!==ga&&(ea=ga.email),ea)}function j(){return angular.isDefined(a.isBHDMember)&&a.isBHDMember&&""!==a.bhdUserPhone?a.bhdUserPhone.replace(/\s/g,""):(fa=localStorage.getItem("phone"),(angular.isUndefined(fa)||null===fa)&&angular.isDefined(ga)&&null!==ga&&(fa=ga.phone),fa)}function k(){return a.isPayoo=localStorage.getItem("payoo_success"),1==a.isPayoo?{bank_code:"PAYOO",index_bank_code:0,payment_type:"PAYOO"}:(ha=localStorage.getItem("methodpay"),angular.isDefined(ha)&&!_.isEmpty(ha)?ha=JSON.parse(ha):{bank_code:"ZALOPAY",index_bank_code:0,payment_type:"ZALOPAY"})}function l(){localStorage.setItem("email",a.userEmail)}function m(){localStorage.setItem("phone",a.userPhone)}function n(b,c,d){if(1==a.isNewApi){for(var e=0;e<d.length;e++)if(c==d[e].paymentType){if(!d[e].is_list)return 0;for(var f=0;f<d[e].banks.length;f++)if(b==d[e].banks[f].bank_code)return f}}else for(var e=0;e<d.length;e++)if(c==d[e].payment_type)for(var f=0;f<d[e].list.length;f++)if(b==d[e].list[f].bank_code)return f}function o(a,c){var d={};d.bank_code=a,d.payment_type=c,d.index_bank_code=n(a,c,b.listPayment),localStorage.setItem("methodpay",JSON.stringify(d))}function p(){a.isPayoo=localStorage.getItem("payoo_success"),a.userEmail=i(),""!==a.userEmail&&"undefined"!==a.userEmail&&void 0!==a.userEmail&&null!==b.userMethodPay?a.isEmailValid=!0:(a.userEmail="",a.isEmailValid=!1,a.isShowClearEmail=!1),a.userPhone=j(),""!==a.userPhone&&"undefined"!==a.userPhone&&void 0!==a.userPhone&&null!==b.userMethodPay?a.isPhoneValid=!0:(a.userPhone="",a.isPhoneValid=!1,a.isShowClearPhone=!1),b.userMethodPay=k(),void 0!==b.userMethodPay&&null!==b.userMethodPay&&(b.bank_code=b.userMethodPay.bank_code),S()}function q(a,b,c,d,e,f){for(var g=0;g<f.length;g++)for(var h=0;h<f[g].length;h++)if(f[g][h]==a)return[g,h]}function r(a,b){for(var c=0;c<b.length;c++)for(var d=0;d<b[c].length;d++)if(b[c][d].code==a)return b[c][d]}function s(b){var d={};d.items={};var e=[];for(var f in a.combolist)for(var h in a.combolist[f].items)a.combolist[f].items[h].amount>0&&e.push(a.combolist[f].items[h]);e.length>0?(d.items=e,d.user_session_id=a.user_session_id,d.cinema_id=a.cinema_id,g.post(c,{url:"/checkout/megags/concession",keyCache:"no-cache"},d,function(c){c.data.hasOwnProperty("error")?(a.rightErrorContent=c.data.error.message,$("#right-error-modal").modal("show")):x(b)},function(a){console.log("error")})):x(b)}function t(b){b.list_concession={};var c=[];for(var d in a.combolist)for(var e in a.combolist[d].items)a.combolist[d].items[e].amount>0&&c.push(a.combolist[d].items[e]);c.length>0&&(b.list_concession=c),x(b)}function u(b){var d={};d.items={};var e=[];for(var f in a.combolist)for(var h in a.combolist[f].items)a.combolist[f].items[h].amount>0&&e.push(a.combolist[f].items[h]);e.length>0?(d.items=e,d.user_session_id=a.user_session_id,d.cinema_id=a.cinema_id,g.post(c,{url:"/checkout/galaxy/concession",keyCache:"no-cache"},d,function(c){c.data.hasOwnProperty("error")?(a.rightErrorContent=c.data.error.message,$("#right-error-modal").modal("show")):x(b)},function(a){console.log("error")})):x(b)}function v(b){var d={};d.items={};var e=[];for(var f in a.combolist)for(var h in a.combolist[f].items)a.combolist[f].items[h].amount>0&&e.push(a.combolist[f].items[h]);e.length>0?(d.items=e,d.user_session_id=a.user_session_id,d.cinema_id=a.cinema_id,g.post(c,{url:"/checkout/ddc/concession",keyCache:"no-cache"},d,function(c){c.data.hasOwnProperty("error")?(a.rightErrorContent=c.data.error.message,$("#right-error-modal").modal("show")):x(b)},function(a){console.log("error")})):x(b)}function w(){if(a.isEmailValid&&a.isPhoneValid&&1!=ra){ra=!0;var c={},d=$('.chosenmethod input[name="method"]:checked').val(),e=["ZALOPAY","PAYOO","ZALOPAYGW","123F","CC"];if(0==a.isNewApi){if(c.session_id=parseInt(a.sessionId),1!=a.pCinemaId&&(c.list_seat=a.listseatchosencode),c.redirect_url=window.location.origin+"/checkout/result/",c.debug=1,c.payment_info={},c.payment_info.site_type=0,c.payment_info.bank_code=e.includes(d)?d:b.bank_code,c.payment_info.payment_type=d,c.payment_info.cardNumber="",c.payment_info.cardHolderName="",c.payment_info.user_id=a.user.user_id,c.payment_info.customer_name=a.user.fullname,c.payment_info.customer_phone=a.userPhone,c.payment_info.customer_email=a.userEmail,""==c.payment_info.bank_code)return $(".errormethodpay").show(),$(".errormethodpay").text("Bạn chưa chọn loại thẻ thanh toán"),ra=!1,void(b.loading=!1);if($(".errormethodpay").hide(),l(),m(),o(c.payment_info.bank_code,c.payment_info.payment_type),c.booking_data={},1!=a.pCinemaId&&16!=a.pCinemaId){c.booking_data.user_session_id=a.user_session_id,c.booking_data.list_seat={};for(var f=0;f<a.listseatchosencode.length;f++){var g=q(a.listseatchosencode[f],a.area_id,a.area_index,a.col_index,a.row_index,a.seat_code);c.booking_data.list_seat[f]={},c.booking_data.list_seat[f].area_id=a.area_id[g[0]][g[1]],c.booking_data.list_seat[f].row_index=a.row_index[g[0]][g[1]],c.booking_data.list_seat[f].seat_code=a.seat_code[g[0]][g[1]],c.booking_data.list_seat[f].col_index=a.col_index[g[0]][g[1]],c.booking_data.list_seat[f].area_index=a.area_index[g[0]][g[1]]}}c.booking_data.list_ticket={};var h=[];for(var i in a.ticketTypes)a.ticketTypes[i].type_num>0&&h.push(a.ticketTypes[i]);c.booking_data.list_ticket=h,a.sendGA("Payment","Click Next Seat",a.film_name),a.sendGA("Payment","Click Payment",a.user.fullname+", "+a.cinema_name+", "+a.film_name+", "+c.payment_info.bank_code+", "+c.payment_info.payment_type),a.combolist.length>0?2==a.pCinemaId?u(c):6==a.pCinemaId?v(c):17==a.pCinemaId?s(c):t(c):x(c)}else{if(c.sessionId=a.sessionId,c.customerEmail=a.userEmail,c.customerPhone=a.userPhone,c.userSessionId=a.user_session_id,c.seats=[],c.concessions=[],c.paymentChannel={paymentType:d,bankCode:e.includes(d)?d:b.bank_code},c.userHash=a.user.user_hash,c.totalPrice=a.totalPrice+a.combocost,""==c.paymentChannel.bankCode)return $(".errormethodpay").show(),$(".errormethodpay").text("Bạn chưa chọn loại thẻ thanh toán"),ra=!1,void(b.loading=!1);if($(".errormethodpay").hide(),l(),m(),o(c.paymentChannel.bankCode,c.paymentChannel.paymentType),3!=a.flowId){if(a.isAllowedStudentPrice)for(var f=0;f<a.listseatchosencode.length;f++){var j=a.listseatchosentickettype[f],k=r(a.listseatchosencode[f],a.typeSeatV2[0]);c.seats[f]={},c.seats[f].code=k.code.split("_")[0],c.seats[f].data=JSON.parse(atob(k.data)),c.seats[f].type=k.type,""!=k.group&&(c.seats[f].group=k.group),c.seats[f].data.metadata=j-0,_.isUndefined(a.listStandardTicketType[j][k.type])||(c.seats[f].data.price=a.listStandardTicketType[j][k.type])}else for(var f=0;f<a.listseatchosencode.length;f++){var k=r(a.listseatchosencode[f],a.typeseat);c.seats[f]={},c.seats[f].code=k.code.split("_")[0],c.seats[f].data=JSON.parse(atob(k.data)),c.seats[f].type=k.type,""!=k.group&&(c.seats[f].group=k.group)}for(var n in a.combolist)for(var i in a.combolist[n].concessions)a.combolist[n].concessions[i].amount>0&&(a.combolist[n].concessions[i].quantity=a.combolist[n].concessions[i].amount,c.concessions.push(a.combolist[n].concessions[i]))}else{var h=[];for(var i in a.ticketTypes)a.ticketTypes[i].type_num>0&&h.push({id:a.ticketTypes[i].type_code,price:a.ticketTypes[i].type_price,quantity:a.ticketTypes[i].type_num,capacity:a.ticketTypes[i].type_capacity});c.tickets=h}0!=b.voucherValue&&(c.discountInfo={discountAmount:b.voucherValue,voucherInfo:{voucherCode:a.userVoucher,voucherValue:b.voucherValue}}),Y(c)}}}function x(d){angular.isDefined(a.refId)&&1===a.refId&&(d.ref_id=a.refId),g.post(c,{url:"/checkout/create",keyCache:"no-cache"},d,function(c){$(".errorbook").hide(),b.loading=!1,c.data.hasOwnProperty("error")?(ra=!1,a.rightErrorContent=c.data.error.message,$("#right-error-modal").modal("show")):(b.payment_type=d.payment_info.payment_type,a.isMobile&&"ZALOPAY"==d.payment_info.payment_type?(a.countUnload+=1,window.location.replace(c.data.result.verify.zpOrderUrl)):"PAYOO"==d.payment_info.payment_type?A(c.data.result,d.payment_info):"ZALOPAY"==d.payment_info.payment_type?B(c.data.result):("ZALOPAYGW"==d.payment_info.payment_type||"ATM"==d.payment_info.payment_type||"CC"==d.payment_info.payment_type||"123F"==d.payment_info.payment_type)&&C(c.data.result))},function(a){console.log("error")})}function y(b){a.countUnload+=1;var c=window.location.origin+"/checkout/result/";window.location.replace(c+"?invoice_no="+b)}function z(){if(1==a.isNewApi){var d="/api/booking";1==a.flowId?d+="/vista/order":2==a.flowId?d+="/standard/order":3==a.flowId?d+="/lotte/order":4==a.flowId&&(d+="/jupiter/order"),d+="?invoiceNo="+a.invoice_no,h.get(c,{url:d,keyCache:"no-cache"},function(c){var d=c.data;0==d.code?(clearInterval(ma),y(a.invoice_no)):10==d.code||("PAYOO"==b.payment_type?$("#trans-status").text("Đơn hàng không thành công"):"ZALOPAY"==b.payment_type&&(clearInterval(b.timeintervalzalopay),$("#zalopaycheckout").hide(),a.rightErrorContent="Giao dịch không thành công. Xin vui lòng thực hiện lại.",$("#right-error-modal").modal("show"),$(".btnOk","#right-error-modal").click(function(){P()})),clearInterval(ma))},function(a){console.log("error")})}else g.get(c,{url:"/transaction/paymentstatus?invoice_no="+a.invoice_no,keyCache:"no-cache"},function(c){var d=c.data.result.payment_status;1==d?(clearInterval(ma),y(a.invoice_no)):0==d||("PAYOO"==b.payment_type?$("#trans-status").text("Đơn hàng không thành công"):"ZALOPAY"==b.payment_type&&(clearInterval(b.timeintervalzalopay),$("#zalopaycheckout").hide(),a.rightErrorContent="Giao dịch không thành công. Xin vui lòng thực hiện lại.",$("#right-error-modal").modal("show"),$(".btnOk","#right-error-modal").click(function(){O({invoice_no:a.invoice_no})})),clearInterval(ma))},function(a){console.log("error")})}function A(c,d){localStorage.setItem("payoo_success",1),1!=c.verify.responseCode?(a.rightErrorContent=c.verify.responseDescription,$("#right-error-modal").modal("show"),$(".btnOk","#right-error-modal").click(function(){b.reloadcheckout()})):(a.flagmodal=!0,$("#payoocheckout").show(),a.isDisable=!1,$(window).width()<=768&&($(".contentfullright").hide(),$(".buyticket").hide(),$(".continuebuttonmobile").addClass("hide-by-payoo")),clearInterval(a.timeinterval),a.orderNo=c.verify.orderNo,a.expiredDate=D(c.verify.expiredDate),a.invoice_no=c.transaction.invoice_no,a.transaction_id=c.transaction.transaction_id,a.total_revenue=c.transaction.total_revenue,a.fullname=d.customer_name,a.email=d.customer_email,a.phone=d.customer_phone,a.timebook=moment().format("hh:mm DD/MM"),a.timeshow=E(a.session_time_original),z(),ma=setInterval(z,3e3))}function B(c){localStorage.setItem("payoo_success",0),1!=c.verify.responseCode?(a.rightErrorContent=c.verify.responseDescription,$("#right-error-modal").modal("show"),$(".btnOk","#right-error-modal").click(function(){b.reloadcheckout()})):(a.flagmodal=!0,$("#zalopaycheckout").show(),a.isDisable=!1,clearInterval(a.timeinterval),a.invoice_no=c.transaction.invoice_no,c.verify.zpOrderUrl?a.qrCode=c.verify.zpOrderUrl:a.qrCode=c.verify.qrCode,a.zptranstoken=c.verify.zptranstoken,a.total_revenue=c.transaction.total_revenue,a.total_item=c.transaction.total_item,z(),ma=setInterval(z,3e3),b.timeintervalzalopay=setInterval(R,1e3))}function C(b){localStorage.setItem("payoo_success",0),a.invoice_no=b.transaction.invoice_no,a.transaction_id=b.transaction.transaction_id,a.total_revenue=b.transaction.total_revenue,a.orderNo=b.verify.orderNo,a.countUnload+=1,
window.location.replace(b.verify.redirectURL)}function D(a){var a=a.split(" "),b=a[0].split("-"),c=a[1].split(":");return c[0]+":"+c[1]+" "+b[2]+"/"+b[1]+"/"+b[0]}function E(a){var a=a.split(" "),b=a[0].split("-"),c=a[1].split(":");return c[0]+":"+c[1]+" "+b[2]+"/"+b[1]}function F(){g.get(c,{url:"/checkout/bank?session_id="+a.sessionId,keyCache:"no-cache"},function(a){if(I(),a.data&&!a.data.hasOwnProperty("error")){var c=a.data.result.groups;$(window).width()<=768&&(c=c.filter(H));for(var d in c){var e=c[d];if(1===e.list.length){e.is_list=!1;for(var f in e.list[0])e[f]=e.list[0][f]}else e.is_list=!0;e.img_mobile&&(b.paymentIcon[e.payment_type]=e.img_mobile),pa[e.payment_type]?e.note=pa[e.payment_type]:e.note=!1}b.listPayment=c}})}function G(){h.get(c,{url:"/api/data/payment",keyCache:"no-cache"},function(a){if(I(),0!=a.data.code)return void console.log(a.data.err);var c=a.data.data;for(var d in c){var e=c[d];_.isUndefined(e.banks)?e.is_list=!1:e.is_list=!0,e.imgMobile&&(b.paymentIcon[e.paymentType]=e.imgMobile),pa[e.paymentType]?e.note=pa[e.paymentType]:e.note=!1}b.listPayment=c})}function H(a){return a.payment_type}function I(){1==a.isNewApi&&[1,2,4,6,16,17].includes(parseInt(a.pCinemaId))?M():1==a.pCinemaId||(2==a.pCinemaId?J():6==a.pCinemaId||(17==a.pCinemaId?K():L()))}function J(){g.get(c,{url:"/checkout/galaxy/concession?cinema_id="+a.cinema_id,keyCache:"no-cache"},function(b){a.combolist=N(b.data.result)})}function K(){g.get(c,{url:"/checkout/megags/concession?cinema_id="+a.cinema_id,keyCache:"no-cache"},function(b){a.combolist=N(b.data.result)})}function L(){g.get(c,{url:"/checkout/concession?cinema_id="+a.cinema_id,keyCache:"no-cache"},function(b){a.combolist=N(b.data.result)})}function M(){h.get(c,{url:"/api/data/concession?cinemaId="+a.cinema_id+"&sessionId="+a.sessionId,keyCache:"no-cache"},function(b){return 0!=b.data.code?void console.log(b.data.err):void(a.combolist=N(b.data.data))})}function N(b){if(1==a.isNewApi)for(var c in b)for(var d in b[c].concessions)b[c].concessions[d].amount=0,b[c].concessions[d].item_cost=0;else for(var c in b)for(var d in b[c].items)b[c].items[d].amount=0,b[c].items[d].item_cost=0;return b}function O(a){g.post(c,{url:"/checkout/cancel",keyCache:"no-cache"},a,function(a){a.data.hasOwnProperty("error")||window.location.reload(!1)},function(a){console.log("Cancel Order Error")})}function P(){if(!_.isUndefined(a.invoice_no)&&!_.isEmpty(a.invoice_no)){var b="";1==a.flowId?b="/api/booking/vista/order?invoiceNo="+a.invoice_no+"&sessionId="+a.sessionId:2==a.flowId?b="/api/booking/standard/order?invoiceNo="+a.invoice_no+"&sessionId="+a.sessionId:3==a.flowId?b="/api/booking/lotte/order?invoiceNo="+a.invoice_no:4==a.flowId&&(b="/api/booking/jupiter/order?invoiceNo="+a.invoice_no+"&sessionId="+a.sessionId),""!=b&&h["delete"](c,{url:b,keyCache:"no-cache"},function(a){0==a.data.code&&window.location.reload(!1)},function(a){console.log("Cancel Order Error")})}}function Q(){ta-=1e3;var a=Math.floor(ta/1e3%60),b=Math.floor(ta/1e3/60%60);return{total:ta,minutes:b,seconds:a}}function R(){var a=Q();$("#zalopaycheckout .qr-countdown .minute").text(("0"+a.minutes).slice(-2)),$("#zalopaycheckout .qr-countdown .second").text(("0"+a.seconds).slice(-2)),a.total<=0&&(clearInterval(b.timeintervalzalopay),$("#zalopaycheckout").hide(),$("#rebookticketcheckout").show())}function S(){g.get(c,{url:"/promotions?session_id="+a.sessionId,keyCache:"no-cache"},function(b){b.data.hasOwnProperty("error")||(pa=b.data.result?b.data.result:{}),1==a.isNewApi?G():F()},function(b){1==a.isNewApi?G():F(),console.log("error")})}function T(){if(a.isEmailValid&&a.isPhoneValid&&1!=ra){ra=!0,b.loading=!0;var c={},d=$('.chosenmethod input[name="method"]:checked').val(),e=["ZALOPAY","PAYOO","ZALOPAYGW","123F","CC"];if(c.site_type=0,c.debug=1,c.payment={},c.payment.bank_code=e.includes(d)?d:b.bank_code,c.payment.payment_type=d,c.payment.cinevoucher_total=0,c.payment.final_total=0,c.customer={},c.customer.user_id=a.user.user_id,c.customer.phone=a.userPhone,c.customer.email=a.userEmail,""==c.payment.bank_code)return $(".errormethodpay").show(),$(".errormethodpay").text("Bạn chưa chọn loại thẻ thanh toán"),ra=!1,void(b.loading=!1);$(".errormethodpay").hide(),l(),m(),o(c.payment.bank_code,c.payment.payment_type),c.booking=[];for(var f in a.ticketTypes)if(a.ticketTypes[f].type_num>0){var g={voucher_type_id:a.ticketTypes[f].type_code,quantity:a.ticketTypes[f].type_num,price:a.ticketTypes[f].type_price};c.booking.push(g),c.payment.cinevoucher_total+=g.quantity*g.price,c.payment.final_total+=g.quantity*g.price}a.sendGA("Payment","Click Next Seat",a.cinema_name),a.sendGA("Payment","Click Payment",a.user.fullname+", "+a.cinema_name+", "+c.payment.bank_code+", "+c.payment.payment_type),U(c)}}function U(d){angular.isDefined(a.refId)&&1===a.refId&&(d.ref_id=a.refId),g.post(c,{url:"/cinevouchers/order",keyCache:"no-cache"},d,function(c){$(".errorbook").hide(),b.loading=!1,c.data.hasOwnProperty("error")?(ra=!1,a.rightErrorContent=c.data.error.message,$("#right-error-modal").modal("show")):(b.payment_type=d.payment.payment_type,a.isMobile&&"ZALOPAY"==d.payment.payment_type?(a.countUnload+=1,window.location.replace(c.data.result.payment.zpOrderUrl)):(a.invoice_no=c.data.result.invoice_no||c.data.result.invoiceNo,1==c.data.result.payment.byPassPayment&&setTimeout(function(){var b=window.location.origin+"/checkout/result/";window.location.replace(b+"?invoice_no="+a.invoice_no)},1e3),"PAYOO"==d.payment.payment_type?V(c.data.result):"ZALOPAY"==d.payment.payment_type?W(c.data.result):("ZALOPAYGW"==d.payment.payment_type||"ATM"==d.payment.payment_type||"CC"==d.payment.payment_type||"123F"==d.payment.payment_type)&&X(c.data.result)))},function(a){console.log("error")})}function V(c){var d=c.payment;localStorage.setItem("payoo_success",1),c.payment&&1!=c.payment.responseCode?(a.rightErrorContent=c.payment.responseDescription,$("#right-error-modal").modal("show"),$(".btnOk","#right-error-modal").click(function(){b.reloadcheckout()})):(a.flagmodal=!0,$("#payoocheckout").show(),a.isDisable=!1,$(window).width()<=768&&($(".contentfullright").hide(),$(".buyticket").hide(),$(".continuebuttonmobile").addClass("hide-by-payoo")),clearInterval(a.timeinterval),a.orderNo=d.orderNo,a.expiredDate=D(d.expiredDate),a.transaction_id=c.transaction_id,a.total_revenue=c.total_revenue,a.timeshow=E(a.session_time_original),a.fullname=c.customer_email,a.email=c.customer_email,a.phone=c.customer_phone,z(),ma=setInterval(z,3e3))}function W(c){localStorage.setItem("payoo_success",0),c.payment&&1!=c.payment.responseCode?(a.rightErrorContent=c.payment.responseDescription,$("#right-error-modal").modal("show"),$(".btnOk","#right-error-modal").click(function(){b.reloadcheckout()})):(a.flagmodal=!0,$("#zalopaycheckout").show(),a.isDisable=!1,clearInterval(a.timeinterval),c.payment.zpOrderUrl?a.qrCode=c.payment.zpOrderUrl:a.qrCode=c.payment.qrCode,a.zptranstoken=c.payment.zptranstoken,a.total_revenue=c.total_revenue,a.total_item=c.total_item,z(),ma=setInterval(z,3e3),b.timeintervalzalopay=setInterval(R,1e3))}function X(b){localStorage.setItem("payoo_success",0),a.transaction_id=b.transaction_id,a.total_revenue=b.total_revenue,a.countUnload+=1,window.location.replace(b.payment.redirectURL)}function Y(d){var e="/api/booking";1==a.flowId?e+="/vista/order":2==a.flowId?e+="/standard/order":3==a.flowId?e+="/lotte/order":4==a.flowId&&(e+="/jupiter/order"),h.post(c,{url:e,keyCache:"no-cache"},d,function(c){$(".errorbook").hide(),b.loading=!1,0==c.data.code?(b.payment_type=d.paymentChannel.paymentType,a.isMobile&&"ZALOPAY"==d.paymentChannel.paymentType?(a.countUnload+=1,window.location.replace(c.data.data.payment.redirectURL)):(a.invoice_no=c.data.data.invoiceNo,1==c.data.data.payment.byPassPayment&&setTimeout(function(){var b=window.location.origin+"/checkout/result/";window.location.replace(b+"?invoice_no="+a.invoice_no)},1e3),"PAYOO"==d.paymentChannel.paymentType?Z(c.data.data,d):"ZALOPAY"==d.paymentChannel.paymentType?aa(c.data.data,d):("ZALOPAYGW"==d.paymentChannel.paymentType||"ATM"==d.paymentChannel.paymentType||"CC"==d.paymentChannel.paymentType||"123F"==d.paymentChannel.paymentType)&&ba(c.data.data,d))):(ra=!1,a.rightErrorContent=c.data.msg,$("#right-error-modal").modal("show"))},function(a){console.log("error")})}function Z(c,d){localStorage.setItem("payoo_success",1),c.payment&&(a.flagmodal=!0,$("#payoocheckout").show(),a.isDisable=!1,$(window).width()<=768&&($(".contentfullright").hide(),$(".buyticket").hide(),$(".continuebuttonmobile").addClass("hide-by-payoo")),clearInterval(a.timeinterval),a.orderNo=c.payment.transToken,a.expiredDate=D(c.payment.expiredAt),a.transaction_id="",a.total_revenue=d.totalPrice-b.voucherValue,a.timeshow=E(a.session_time_original),a.fullname=d.customerEmail,a.email=d.customerEmail,a.phone=d.customerPhone,z(),ma=setInterval(z,3e3))}function aa(c,d){if(localStorage.setItem("payoo_success",0),a.flagmodal=!0,$("#zalopaycheckout").show(),a.isDisable=!1,clearInterval(a.timeinterval),a.qrCode=c.payment.redirectURL,a.zptranstoken=c.payment.transToken,a.total_revenue=d.totalPrice-b.voucherValue,3!=a.flowId)a.total_item=d.seats.length;else{a.total_item=0;for(var e=0;e<d.tickets.length;e++)a.total_item+=d.tickets[e].quantity*d.tickets[e].capacity}z(),ma=setInterval(z,3e3),b.timeintervalzalopay=setInterval(R,1e3)}function ba(b,c){localStorage.setItem("payoo_success",0),a.transaction_id="",a.total_revenue=c.totalPrice,a.orderNo="",a.countUnload+=1,window.location.replace(b.payment.redirectURL)}function ca(){b.voucherValue=0,b.voucherDesc="",a.isShowClearVoucher=!1,$(".js-voucher-label").html("Mã giảm giá").removeClass("success error")}function da(d){var e="/api/booking";1==a.flowId?e+="/vista":2==a.flowId?e+="/standard":4==a.flowId&&(e+="/jupiter"),e+="/checkvoucher",h.post(c,{url:e,keyCache:"no-cache"},d,function(c){if(a.isShowClearVoucher=!0,sa=!1,0==c.data.code){var d=c.data.data;b.voucherOrgValue=d.voucherOrgValue?d.voucherOrgValue:d.voucherValue,b.voucherValue=d.voucherValue,b.voucherDesc=d.voucherDesc,$(".js-voucher-label").html("Áp dụng thành công").addClass("success").removeClass("error")}else $(".js-voucher-label").html(c.data.msg).addClass("error").removeClass("success")},function(b){a.isShowClearVoucher=!0,sa=!1,$(".js-voucher-label").html("Hệ thống lỗi, vui lòng thử lại sau").addClass("error").removeClass("success"),console.log("error")})}b.bank_code="",b.timeintervalzalopay=0,b.loading=!1,b.phoneErrorMsg="",b.emailErrorMsg="",b.isCheckedPay=!1,b.userMethodPay="",b.voucherOrgValue=0,b.voucherValue=0,b.voucherDesc="",a.combolist=[],a.flagcombo=!1,a.flagmodal=!1,a.combocost=0,a.isDisable=!0,a.userEmail="",a.userPhone="",a.userVoucher="",a.isEmailValid=!1,a.isPhoneValid=!1,a.isShowClearEmail=!1,a.isShowClearPhone=!1,a.isShowClearVoucher=!1,a.cancelZaloPay=!1,a.methodpay="";var ea,fa,ga,ha,ia="Email không được bỏ trống",ja="Email không đúng định dạng",ka="Phone không được bỏ trống",la="Phone chỉ được chứa số",ma=0,na=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,oa=/^[0-9-+]+$/,pa={},qa="",ra=!1,sa=!1;angular.isDefined(localStorage.getItem("user"))&&(ga=JSON.parse(localStorage.getItem("user")),null===ga&&(ga={})),1==a.isLoadConfig&&p(),a.backPage=function(){b.showcombolist()},b.editEmail=function(c){a.userEmail=c,""===c||void 0===c?(a.isShowClearEmail=!1,a.isEmailValid=!1,b.emailErrorMsg=ia):c.match(na)?(a.isEmailValid=!0,a.isShowClearEmail=!0):(a.isEmailValid=!1,b.emailErrorMsg=ja,a.isShowClearEmail=!0),a.sendGA("Payment","Change Email",c)},b.editPhone=function(c){a.userPhone=c,""===c||void 0===c?(a.isShowClearPhone=!1,a.isPhoneValid=!1,b.phoneErrorMsg=ka):c.match(oa)?(a.isPhoneValid=!0,a.isShowClearPhone=!0):(a.isPhoneValid=!1,b.phoneErrorMsg=la,a.isShowClearPhone=!0),a.sendGA("Payment","Change Phone",c)},b.clearEmail=function(){var c=$("#emailCheckout");c.val(""),c.trigger("input"),c.trigger("change"),a.isShowClearEmail=!1,a.isEmailValid=!1,b.emailErrorMsg=ia},b.clearPhone=function(){var c=$("#phoneCheckout");c.val(""),c.trigger("input"),c.trigger("change"),a.isShowClearPhone=!1,a.isPhoneValid=!1,b.phoneErrorMsg=ka},b.isCheckedMethodPay=function(){return b.isCheckedPay?!0:void 0!==$('.chosenmethod input[name="method"]:checked').val()?(b.isCheckedPay=!0,!0):!1},b["continue"]=function(){return a.isAcceptAgeRestrict?(qa&&clearTimeout(qa),b.loading=!0,void(qa=setTimeout(w,1e3))):void(a.isShowModalAgeRestrict=!0)},a.acceptAgeRestrict=function(){b.closeAgeRestrict(),a.isAcceptAgeRestrict=!0,b.loading=!0,qa=setTimeout(w,500)},b.choosePayment=function(a){var c=$(a.target),d=a.target.dataset;if($(".chosenmethod").removeClass("active"),$(".listChildren").removeClass("active"),c.find('input[name="method"]').prop("checked",!0),c.addClass("active"),"ATM"===d.type||"CC"===d.type)c.find(".listChildren").addClass("active");else{var e=$(this),d=e.data();$(".bank").removeClass("active"),$(".chosenmethod.list").each(function(a,c){var d=$(this),e=d.data();d.find(".titlechosen").text(e.name),d.find(".icon").attr("src",b.paymentIcon[e.type])})}$(window).height()<=1024&&"ATM"===d.type&&$("#rightcheckout .contentfullright").animate({scrollTop:$("#rightcheckout .contentfullright").height()},"slow"),b.bank_code=""},b.chooseBank=function(a){a.stopPropagation(),a.preventDefault(),$(".chosenmethod.list").each(function(a,c){var d=$(this),e=d.data();d.find(".titlechosen").text(e.name),d.find(".icon").attr("src",b.paymentIcon[e.type])});var c=$(a.target),d=c.data();$(".bank").removeClass("active"),$(".chosenmethod").removeClass("active"),$(".listChildren").removeClass("active"),c.addClass("active"),c.parents(".chosenmethod").find(".titlechosen").text(d.name),b.bank_code=d.code,c.parents(".chosenmethod").find(".icon").attr("src",d.img),$(".errormethodpay").hide()},b.paymentIcon={CC:"app/assets/img/icons/Group14.png",ATM:"app/assets/img/icons/Group13.png",PAYOO:"app/assets/img/icons/Payoo.png",ZALOPAY:"app/assets/img/icons/ZaloPay.png",ZALOPAYGW:"https://s3img.vcdn.vn/123phim/2017/01/4c37a2f61a6089a334d4e10bccd3a268.png","123F":"https://s3img.vcdn.vn/123phim/2018/08/e91c8941f8227e078fa5532e3643e3dc.png"},a.isRedirectOuterPage&&(b.paymentIcon.ZALOPAY="app/assets/img/icons/ZaloPayOut.png"),b.listPayment=[],b.showcombolist=function(){if($(window).width()>768){var b=$("#rightcheckout").width(),c=parseInt($("#rightcheckout").css("padding-right")),d=b+2*c;$("#combocheckout").is(":animated")||(a.flagcombo?$("#combocheckout").animate({right:-(465-d)},"slow"):$("#combocheckout").animate({right:d},"slow"),a.flagcombo=!a.flagcombo)}else $("#stepcheckout").hide(),$("#rightcheckout").hide(),$("#combocheckout").show()},b.closepayoo=function(){a.sendGA("Payment","Close Payoo","Not Payment"),a.methodpay="PAYOO",$("#confirmcheckout").show()},b.closezalopay=function(){a.sendGA("Payment","Close ZaloPay","Not Payment"),a.methodpay="ZALOPAY",$("#confirmcheckout").show()},b.reloadcheckout=function(){var b={};a.countUnload+=1,"ZALOPAY"===a.methodpay?(b.invoice_no=a.invoice_no,$("#confirmcheckout").hide(),a.cancelZaloPay=!0,1==a.isNewApi?P():O(b)):window.location.reload(!1)},b.closeconfirm=function(){$("#confirmcheckout").hide()};var ta=3e5;b.checkoutInvalid=function(){var a=$("#emailCheckout").val(),c=$("#phoneCheckout").val();b.editEmail(a),b.editPhone(c),$("#seatcheckout .error")[0]&&"block"===$("#seatcheckout .error")[0].style.display&&window.scrollTo(0,document.body.scrollHeight)},a.closeErrorRightModal=function(){$("#right-error-modal").modal("hide")},b.removeAge=function(a){var b="";if(void 0!=a){var c=a.indexOf("(");b=-1!=c?a.slice(0,c):a}return b},b.continueVoucher=function(){qa&&clearTimeout(qa),qa=1==a.isNewApi?setTimeout(w,500):setTimeout(T,500)},b.checkShowPayment=function(a,b,c){var d=b>0,e=b+c;return _.isUndefined(a.maxAmount)||(d&=a.maxAmount>=e),_.isUndefined(a.minAmount)||(d&=a.minAmount<=e),d},a.resetVoucher=function(){var c=$("#voucherPromotion");c.val(""),c.trigger("input"),c.trigger("change"),a.userVoucher="",b.voucherValue=0,b.voucherDesc="",a.isShowClearVoucher=!1,$(".js-voucher-label").html("Vui lòng nhập lại mã").removeClass("success").addClass("error")},b.editVoucher=function(b){b=b.trim().toUpperCase(),a.userVoucher=b,ca()},b.isDisableVoucher=function(){return a.isEmailValid&&a.isPhoneValid&&b.isCheckedMethodPay()&&a.fullchosen&&a.totalticket>0},b.resetApplyVoucher=function(){b.closeApplyVoucher(),b.resetVoucher()},b.applyVoucher=function(){if(""===a.userVoucher);else{if(!a.isEmailValid||!a.isPhoneValid||1==sa)return;sa=!0;var c={},d=$('.chosenmethod input[name="method"]:checked').val(),e=["ZALOPAY","PAYOO","ZALOPAYGW","123F","CC"];if(c.sessionId=a.sessionId,c.customerEmail=a.userEmail,c.customerPhone=a.userPhone,c.userSessionId=a.user_session_id,c.seats=[],c.concessions=[],c.paymentChannel={paymentType:d,bankCode:e.includes(d)?d:b.bank_code},c.userHash=a.user.user_hash,c.totalPrice=a.totalPrice+a.combocost,c.voucher=a.userVoucher,""==c.paymentChannel.bankCode)return $(".errormethodpay").show(),$(".errormethodpay").text("Bạn chưa chọn loại thẻ thanh toán"),void(sa=!1);if($(".errormethodpay").hide(),3!=a.flowId){for(var f=0;f<a.listseatchosencode.length;f++){var g=r(a.listseatchosencode[f],a.typeseat);c.seats[f]={},c.seats[f].code=g.code.split("_")[0],c.seats[f].data=JSON.parse(atob(g.data)),c.seats[f].type=g.type,c.seats[f].group=g.group}for(var h in a.combolist)for(var i in a.combolist[h].concessions)a.combolist[h].concessions[i].amount>0&&(a.combolist[h].concessions[i].quantity=a.combolist[h].concessions[i].amount,c.concessions.push(a.combolist[h].concessions[i]))}else{var j=[];for(var i in a.ticketTypes)a.ticketTypes[i].type_num>0&&j.push({id:a.ticketTypes[i].type_code,price:a.ticketTypes[i].type_price,quantity:a.ticketTypes[i].type_num,capacity:a.ticketTypes[i].type_capacity});c.tickets=j}da(c)}},a.applyStudentPrice=function(){a.isShowModalStudent=!1,a.isStudentPrice=!0},b.chooseStandardTicket=function(b){var c=b.target;a.curTicketType=c.dataset.tabval-0}}])}(),function(){angular.module("TIX").controller("CheckoutSeatController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","CommonService",function(a,b,c,d,e,f,g,h){function i(){1==a.pCinemaId||(2==a.pCinemaId?o():4==a.pCinemaId?n():17==a.pCinemaId?p():q())}function j(c){b.maxseat=a.isMobile?1:2,b.numseat=c}function k(a,c){b.total[a]=0,b.idarea[c]=a}function l(c,d,e,f){for(var g={0:!0,1:!0,2:!0,5:!0,6:!0,7:!0},h=0;h<d.length;h++){a.typeseat[h]=[];for(var i=0;i<d[h].length;i++)0==b.maxseat&&j(d[h].length),a.typeseat[h][i]={},a.typeseat[h][i].indexi="",a.typeseat[h][i].indexj="",a.typeseat[h][i].partner="",a.typeseat[h][i].code=c[h][i],a.typeseat[h][i].status=d[h][i],0==d[h][i]?0==e[h][i]?(a.typeseat[h][i].type=0,a.typeseat[h][i].indexi=h,a.typeseat[h][i].indexj=i,g[0]&&(k(f[h][i],0),g[0]=!1),a.typeseat[h][i].iconType="icon-s-type-single"):1==e[h][i]?(a.typeseat[h][i].type=1,a.typeseat[h][i].indexi=h,a.typeseat[h][i].indexj=i,g[1]&&(k(f[h][i],1),g[1]=!1),a.typeseat[h][i].iconType="icon-s-type-single"):3==e[h][i]?(a.typeseat[h][i].type=2,a.typeseat[h][i].partner=c[h][i+1],a.typeseat[h][i].iconType="icon-s-type-left",a.typeseat[h][i+1]={},a.typeseat[h][i+1].type=13,a.typeseat[h][i+1].code=c[h][i+1],a.typeseat[h][i+1].partner=c[h][i],a.typeseat[h][i+1].iconType="icon-s-type-right",i+=1,g[2]&&(k(f[h][i],2),g[2]=!1)):6==e[h][i]?(a.typeseat[h][i].type=25,a.typeseat[h][i].indexi=h,a.typeseat[h][i].indexj=i,g[6]&&(k(f[h][i],25),g[6]=!1),a.typeseat[h][i].iconType="icon-s-type-single"):7==e[h][i]?(a.typeseat[h][i].type=20,a.typeseat[h][i].partner=[c[h][i+1],c[h][i+2]],a.typeseat[h][i].iconType="icon-s-type-left",a.typeseat[h][i+1]={},a.typeseat[h][i+1].type=21,a.typeseat[h][i+1].code=c[h][i+1],a.typeseat[h][i+1].partner=[c[h][i],c[h][i+2]],a.typeseat[h][i+1].status=d[h][i+1],a.typeseat[h][i+1].iconType="icon-s-type-mid",a.typeseat[h][i+2]={},a.typeseat[h][i+2].type=22,a.typeseat[h][i+2].code=c[h][i+2],a.typeseat[h][i+2].partner=[c[h][i],c[h][i+1]],a.typeseat[h][i+2].status=d[h][i+2],a.typeseat[h][i+2].iconType="icon-s-type-right",i+=2,g[7]&&(k(f[h][i],20),g[7]=!1)):(a.typeseat[h][i].type=14,a.typeseat[h][i].indexi=h,a.typeseat[h][i].indexj=i,g[5]&&(k(f[h][i],14),g[5]=!1),a.typeseat[h][i].iconType="icon-s-type-single"):1==d[h][i]?3==e[h][i]?(a.typeseat[h][i].type=3,a.typeseat[h][i].iconType="icon-s-type-left",a.typeseat[h][i+1]={},a.typeseat[h][i+1].type=13,a.typeseat[h][i+1].code=c[h][i+1],a.typeseat[h][i+1].status=d[h][i+1],a.typeseat[h][i+1].iconType="icon-s-type-right",i+=1):7==e[h][i]?(a.typeseat[h][i].type=23,a.typeseat[h][i].iconType="icon-s-type-left",a.typeseat[h][i+1]={},a.typeseat[h][i+1].type=21,a.typeseat[h][i+1].code=c[h][i+1],a.typeseat[h][i+1].status=d[h][i+1],a.typeseat[h][i+1].iconType="icon-s-type-mid",a.typeseat[h][i+2]={},a.typeseat[h][i+2].type=22,a.typeseat[h][i+2].code=c[h][i+2],a.typeseat[h][i+2].status=d[h][i+2],a.typeseat[h][i+2].iconType="icon-s-type-right",i+=2):0==e[h][i]?(a.typeseat[h][i].type=8,a.typeseat[h][i].iconType="icon-s-type-single"):1==e[h][i]?(a.typeseat[h][i].type=9,a.typeseat[h][i].iconType="icon-s-type-single"):6==e[h][i]?(a.typeseat[h][i].type=26,a.typeseat[h][i].iconType="icon-s-type-single"):(a.typeseat[h][i].type=15,a.typeseat[h][i].iconType="icon-s-type-single"):12==e[h][i]?a.typeseat[h][i].type=12:11==e[h][i]?a.typeseat[h][i].type=11:3==e[h][i]?(a.typeseat[h][i].type=7,a.typeseat[h][i].iconType="icon-s-type-left",a.typeseat[h][i+1]={},a.typeseat[h][i+1].type=13,a.typeseat[h][i+1].code=c[h][i+1],a.typeseat[h][i+1].status=d[h][i+1],a.typeseat[h][i+1].iconType="icon-s-type-right",i+=1):7==e[h][i]?(a.typeseat[h][i].type=24,a.typeseat[h][i].iconType="icon-s-type-left",a.typeseat[h][i+1]={},a.typeseat[h][i+1].type=21,a.typeseat[h][i+1].code=c[h][i+1],a.typeseat[h][i+1].status=d[h][i+1],a.typeseat[h][i+1].iconType="icon-s-type-mid",a.typeseat[h][i+2]={},a.typeseat[h][i+2].type=22,a.typeseat[h][i+2].code=c[h][i+2],a.typeseat[h][i+2].status=d[h][i+2],a.typeseat[h][i+2].iconType="icon-s-type-right",i+=2):""!=c[h][i]?(a.typeseat[h][i].type=4,a.typeseat[h][i].iconType="icon-s-type-single"):a.typeseat[h][i].type=6}a.timeinterval=setInterval(s,1e3),a.loadingseat=!1}function m(c,d,e){for(var f=0;f<d.length;f++){a.typeseat[f]=[];for(var g=0;g<d[f].length;g++)0==b.maxseat&&j(d[f].length),a.typeseat[f][g]={},a.typeseat[f][g].indexi="",a.typeseat[f][g].indexj="",a.typeseat[f][g].partner="",a.typeseat[f][g].code=c[f][g],a.typeseat[f][g].status=d[f][g],0==d[f][g]?0==e[f][g]?""!=c[f][g]?(a.typeseat[f][g].type=0,a.typeseat[f][g].iconType="icon-s-type-single",a.typeseat[f][g].indexi=f,a.typeseat[f][g].indexj=g):a.typeseat[f][g].type=6:1==e[f][g]?(a.typeseat[f][g].type=1,a.typeseat[f][g].iconType="icon-s-type-single",a.typeseat[f][g].indexi=f,a.typeseat[f][g].indexj=g):3==e[f][g]?(a.typeseat[f][g].type=2,a.typeseat[f][g].partner=c[f][g+1],a.typeseat[f][g].iconType="icon-s-type-left",a.typeseat[f][g+1]={},a.typeseat[f][g+1].type=13,a.typeseat[f][g+1].code=c[f][g+1],a.typeseat[f][g+1].partner=c[f][g],a.typeseat[f][g+1].status=d[f][g+1],a.typeseat[f][g+1].iconType="icon-s-type-right",g+=1):12==e[f][g]?a.typeseat[f][g].type=12:11==e[f][g]?a.typeseat[f][g].type=11:7==e[f][g]?(a.typeseat[f][g].type=20,a.typeseat[f][g].partner=[c[f][g+1],c[f][g+2]],a.typeseat[f][g].iconType="icon-s-type-left",a.typeseat[f][g+1]={},a.typeseat[f][g+1].type=21,a.typeseat[f][g+1].code=c[f][g+1],a.typeseat[f][g+1].partner=[c[f][g],c[f][g+2]],a.typeseat[f][g+1].status=d[f][g+1],a.typeseat[f][g+1].iconType="icon-s-type-mid",a.typeseat[f][g+2]={},a.typeseat[f][g+2].type=22,a.typeseat[f][g+2].code=c[f][g+2],a.typeseat[f][g+2].partner=[c[f][g],c[f][g+1]],a.typeseat[f][g+2].status=d[f][g+2],a.typeseat[f][g+2].iconType="icon-s-type-right",g+=2):6==e[f][g]&&(a.typeseat[f][g].type=25,a.typeseat[f][g].indexi=f,a.typeseat[f][g].indexj=g,a.typeseat[f][g].iconType="icon-s-type-single"):1==d[f][g]&&(3==e[f][g]?(a.typeseat[f][g].type=3,a.typeseat[f][g].iconType="icon-s-type-left",a.typeseat[f][g+1]={},a.typeseat[f][g+1].type=13,a.typeseat[f][g+1].code=c[f][g+1],a.typeseat[f][g+1].status=d[f][g+1],a.typeseat[f][g+1].iconType="icon-s-type-right",g+=1):7==e[f][g]?(a.typeseat[f][g].type=24,a.typeseat[f][g].iconType="icon-s-type-left",a.typeseat[f][g+1]={},a.typeseat[f][g+1].type=21,a.typeseat[f][g+1].code=c[f][g+1],a.typeseat[f][g+1].status=d[f][g+1],a.typeseat[f][g+1].iconType="icon-s-type-mid",a.typeseat[f][g+2]={},a.typeseat[f][g+2].type=22,a.typeseat[f][g+2].code=c[f][g+2],a.typeseat[f][g+2].status=d[f][g+2],a.typeseat[f][g+2].iconType="icon-s-type-right",g+=2):6==e[f][g]?(a.typeseat[f][g].type=26,a.typeseat[f][g].iconType="icon-s-type-single"):0==e[f][g]?(a.typeseat[f][g].type=8,a.typeseat[f][g].iconType="icon-s-type-single"):1==e[f][g]?(a.typeseat[f][g].type=9,a.typeseat[f][g].iconType="icon-s-type-single"):(a.typeseat[f][g].type=15,a.typeseat[f][g].iconType="icon-s-type-single"))}a.timeinterval=setInterval(s,1e3),a.loadingseat=!1}function n(){b.title=a.list_seat.title,b.best_seat=a.list_seat.best_seat,b.area_summary=a.list_seat.area_summary,a.area_id=a.list_seat.area_id,a.area_index=a.list_seat.area_index,a.col_index=a.list_seat.col_index,a.row_index=a.list_seat.row_index,a.seat_code=a.list_seat.seat_code;var c=a.seat_code,d=a.list_seat.status,e=a.list_seat.type;b.rowlength=c[1].length,l(c,d,e,a.area_id)}function o(){b.title=a.list_seat.title,b.best_seat=a.list_seat.best_seat,b.area_summary=a.list_seat.area_summary,a.area_id=a.list_seat.area_id,a.area_index=a.list_seat.area_index2,a.col_index=a.list_seat.col_index,a.row_index=a.list_seat.row_index,a.seat_code=a.list_seat.seat_code;var c=a.list_seat.seat_code,d=a.list_seat.status,e=a.list_seat.type;b.rowlength=c[1].length,l(c,d,e,a.area_id)}function p(){b.title=a.list_seat.title,b.best_seat=a.list_seat.best_seat,b.area_summary=a.list_seat.area_summary,a.area_id=a.list_seat.area_id,a.area_index=a.list_seat.area_index,a.col_index=a.list_seat.col_index,a.row_index=a.list_seat.row_index,a.seat_code=a.list_seat.seat_code;var c=a.list_seat.seat_code,d=a.list_seat.status,e=a.list_seat.type;b.rowlength=c[1].length,l(c,d,e,a.area_id)}function q(){g.get(c,{url:"/checkout/room/seat?session_id="+a.sessionId,keyCache:"no-cache"},function(c){if(c.data.hasOwnProperty("error"))b.errorLoadingSeat=c.data.error.message,a.loadingseat=!1;else{b.title=c.data.result.title,b.best_seat=c.data.result.best_seat,b.idarea={0:2,1:3,2:4},b.total={2:0,3:0,4:0},b.area_summary={2:10,3:10,4:10};var d=c.data.result.seat_code,e=c.data.result.status,f=c.data.result.type;b.rowlength=d[1].length,m(d,e,f),$(function(){b.loadSeat()})}},function(a){console.log("error")})}function r(){A-=1e3;var a=Math.floor(A/1e3%60),b=Math.floor(A/1e3/60%60);return{total:A,minutes:b,seconds:a}}function s(){var b=r();$("#seat .minute").text(("0"+b.minutes).slice(-2)),$("#seat .second").text(("0"+b.seconds).slice(-2)),b.total<=0&&(clearInterval(a.timeinterval),$("#seat-error-modal").modal("hide"),$("#rebookticketcheckout").show())}function u(a,b,c){for(var d=0;d<a.length;d++)if(a[d]==c){a.splice(d,1),b.splice(d,1);break}}function v(a,b){for(var c in b)if(a[c]!=b[c])return!1;return!0}function w(a){var b=0;for(var c in a)b+=a[c];return b}function x(a){var b=$("#seat"+a);return b.hasClass("seatchoosing")?!0:!1}function y(a){return 0!=a&&1!=a&&14!=a&&25!=a?!1:!0}function z(b){var c;for(b.length>0&&(c=a.typeseat[parseInt($("#seat"+b[0]).data("indexi"))].length),t=0;t<b.length;t++){var d=$("#seat"+b[t]),e=parseInt(d.data("indexi")),f=parseInt(d.data("indexj"));if(f>0&&y(a.typeseat[e][f-1].type)&&!x(a.typeseat[e][f-1].code))if(f-1==0){if(y(a.typeseat[e][f+1].type))return 1}else if(f-1>0)if(y(a.typeseat[e][f-2].type)){if(x(a.typeseat[e][f-2].code))return 2}else for(var g=1;c>f+g&&y(a.typeseat[e][f+g].type);){if(!x(a.typeseat[e][f+g].code))return 1;g++}if(c>f+1&&y(a.typeseat[e][f+1].type)&&!x(a.typeseat[e][f+1].code))if(f+2==c){if(y(a.typeseat[e][f-1].type))return 1}else if(c>f+2)if(y(a.typeseat[e][f+2].type)){if(x(a.typeseat[e][f+2].code))return 2}else for(var g=1;f-g+1>0&&y(a.typeseat[e][f-g].type);){if(!x(a.typeseat[e][f-g].code))return 1;g++}}return 0}a.listseatchosencode=[],a.listseatchosencodesort=[],a.listseatchosentype=[],a.typeseat=[],a.timeinterval=0,b.rowlength=0,b.total={},b.idarea={},b.seattype={0:"seatsimple",1:"seatvip",2:"seatcouple",3:"seatcouplechosen",4:"seatnotchoose",6:"seatnull",7:"seatcouplenotchoose",8:"seatsimplechosen",9:"seatvipchosen",14:"seatdeluxe",15:"seatdeluxechosen",11:"exit",12:"aisle",20:"seatsofa",23:"seatsofachosen",24:"seatsofanotchoose",25:"seatfirst",26:"seatfirstchosen"},a.loadingseat=!0,b.errorLoadingSeat="",b.maxseat=0,a.fullchosen=!1,(1==a.isRedirectOuterPage&&a.isMobile&&2==a.step||!a.isMobile&&3==a.step||!a.isRedirectOuterPage&&a.step<4)&&i();var A=3e5;b.choose=function(d,e,f,h){var i=0,j=angular.element(d.currentTarget);if(0==f||1==f||2==f||14==f||20==f||25==f){if(1!=f||a.exitsVip||(f=0),j.hasClass("seatchoosing")){if(j.removeClass("seatchoosing"),j.children(".numbercode").text(""),u(a.listseatchosencode,a.listseatchosentype,e),2==f){var k=h;$(".seat"+k).removeClass("seatchoosing"),$(".seat"+k).children(".numbercode").text(""),u(a.listseatchosencode,a.listseatchosentype,k)}else if(20==f)for(var l in h)$(".seat"+h[l]).removeClass("seatchoosing"),$(".seat"+h[l]).children(".numbercode").text(""),u(a.listseatchosencode,a.listseatchosentype,h[l]);b.total[b.idarea[f]]-=1,2==f?b.total[b.idarea[f]]-=1:20==f&&(b.total[b.idarea[f]]-=2)}else{if(16==a.pCinemaId&&(i=w(b.total),i+=2!=f||20!=f?1:20!=f?2:3),b.area_summary[b.idarea[f]]==b.total[b.idarea[f]]&&16!=a.pCinemaId){for(var m,l=0;l<a.listseatchosentype.length;l++)if(a.listseatchosentype[l]==f){m=a.listseatchosencode[l];break}if($(".seat"+m).removeClass("seatchoosing"),$(".seat"+m).children(".numbercode").text(""),u(a.listseatchosencode,a.listseatchosentype,m),2==f){var k=$("#seat"+m).data("partner");$(".seat"+k).removeClass("seatchoosing"),$(".seat"+k).children(".numbercode").text(""),u(a.listseatchosencode,a.listseatchosentype,k)}else if(20==f){var k=$("#seat"+m).data("partner");for(var l in k)$(".seat"+k[l]).removeClass("seatchoosing"),$(".seat"+k[l]).children(".numbercode").text(""),u(a.listseatchosencode,a.listseatchosentype,k[l])}}else 10>=i&&(b.total[b.idarea[f]]+=1,2==f?b.total[b.idarea[f]]+=1:20==f&&(b.total[b.idarea[f]]+=2));if(10>=i){var n=e,o=f;if(j.addClass("seatchoosing"),j.children(".numbercode").text(parseInt(n.substring(1,n.length))),a.listseatchosencode.push(n),a.listseatchosentype.push(o),2==f){var k=h;n=k,o=2,$(".seat"+n).addClass("seatchoosing"),$(".seat"+n).children(".numbercode").text(parseInt(n.substring(1,n.length))),a.listseatchosencode.push(n),a.listseatchosentype.push(o)}else if(20==f){var k=h,p=!1;n==k[0]&&n==k[1]&&(p=!0,j.children(".numbercode").text(""));for(var l in k)n=k[l],o=20,$(".seat"+n).addClass("seatchoosing"),p?$(".seat"+n+".sofamiddle").children(".numbercode").text(parseInt(n.substring(1,n.length))):($(".seat"+n).children(".numbercode").text(parseInt(n.substring(1,n.length))),a.listseatchosencode.push(n),a.listseatchosentype.push(o))}}}if(16!=a.pCinemaId){if($("#seat-error-modal").modal("hide"),a.fullchosen=v(b.total,b.area_summary),a.fullchosen){var q=z(a.sortfilter(a.listseatchosencode,a.listseatchosentype));2==q?(b.seatErrorContent="Bạn không thể bỏ trống 1 ghế ở giữa",$("#seat-error-modal").modal("show"),a.fullchosen=!1):1==q&&($("#seat-error-modal").modal("show"),b.seatErrorContent="Bạn không thể bỏ trống 1 ghế ở đầu mỗi dãy",a.fullchosen=!1)}}else{var q=z(a.sortfilter(a.listseatchosencode,a.listseatchosentype));if(2==q)return b.seatErrorContent="Bạn không thể bỏ trống 1 ghế ở giữa",$("#seat-error-modal").modal("show"),void(a.fullchosen=!1);if(1==q)return b.seatErrorContent="Bạn không thể bỏ trống 1 ghế ở đầu mỗi dãy",$("#seat-error-modal").modal("show"),void(a.fullchosen=!1);var r={};r.list_seat=a.listseatchosencode,r.session_id=a.sessionId,r.list_seat.length>0?g.post(c,{url:"/checkout/price",
keyCache:"no-cache"},r,function(c){if(c.data.hasOwnProperty("error"))b.seatErrorContent=c.data.error.message,$("#seat-error-modal").modal("show");else if(a.totalPrice=c.data.result.price_after,i>10)b.seatErrorContent="Mỗi giao dịch chỉ được chọn tối đa 10 ghế",$("#seat-error-modal").modal("show"),a.fullchosen=!0;else{var d=36;$(window).width()>768&&($("#totalcost").is(":animated")?($("#totalcost").stop(!0,!1).animate({fontSize:(d+10).toString()+"px"},400),$("#totalcost").animate({fontSize:d.toString()+"px"},400)):(d=parseInt($("#totalcost").css("font-size")),$("#totalcost").animate({fontSize:(d+10).toString()+"px"},400).animate({fontSize:d.toString()+"px"},400))),a.fullchosen=!0,$("#seat-error-modal").modal("hide")}},function(a){console.log("error")}):($("#seat-error-modal").modal("hide"),a.totalPrice=0,a.fullchosen=!1)}}},b.loadSeat=function(){var a=($("#leftcheckout"),$("#seatcheckout"),$("#rightcheckout"),31*parseInt(b.numseat)+100);$(window).width()<1024?($(".room").css("width",a),$(".noteseat").css("margin-top","20"),$(".parent-panzoom").css("overflow-x","scroll"),$(".parent-panzoom").css("overflow-y","hidden")):a>$(".parent-panzoom").width()&&($(".room").css("width",a).css("margin-left","15px"),$(".parent-panzoom").css({"overflow-x":"scroll","white-space":"nowrap"}))},a.sortfilter=function(a,b){for(var c=[],d=0;d<a.length;d++)2!=b[d]&&20!=b[d]&&c.push(a[d]);return c.sort()},a.sortlist=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return b.sort()},b.closeErrorSeatModal=function(){$("#seat-error-modal").modal("hide")},$(window).on("beforeunload",function(){!angular.isDefined(a.user_session_id)||_.isNull(a.user_session_id)||_.isEmpty(a.user_session_id)||!angular.isDefined(a.pCinemaId)||_.isNull(a.pCinemaId)||_.isEmpty(a.pCinemaId)||0!==a.countUnload||(a.countUnload+=1,a.cancelOrderOnUnload(a.user_session_id,a.pCinemaId))})}])}(),function(){angular.module("TIX").controller("CheckoutSeatV2Controller",["$rootScope","$scope","$http","$state","$sce","$cookies","APIServiceV2","CommonService",function(a,b,c,d,e,f,g,h){function i(){1==a.flowId?4==a.pCinemaId_real?p():n():2==a.flowId?o():4==a.flowId&&q()}function j(c){b.maxseat=a.isMobile?1:2,b.numseat=c}function k(a,c){_.isUndefined(a)&&(a=c),b.total[a]=0,b.idarea[c]=a}function l(a){for(var c={},d=[],e=!1,f={},g=0;g<B.length;g++)c[B[g]]=!0;for(var g=0;g<a.length;g++){d[g]=[];for(var h=0;h<a[g].length;h++)0==b.maxseat&&j(a[g].length),f=m(g,h,a,d,c,e),g=f.i,h=f.j}for(var g in c)0==c[g]&&(b.seat_desc[g].is_show=1,b.seat_desc[g]["class"]=b.seatColor[g]);return d}function m(a,b,c,d,e,f){var g=c[a][b].type;if(d[a][b]={},10==g)d[a][b].type=g,d[a][b].code=c[a][b].code;else if(11==g)d[a][b].type=g,d[a][b].status=c[a][b].status,d[a][b].displayType="s-square",d[a][b].iconType="icon-s-type-single";else if(B.includes(parseInt(g))){const h=99,i=100;d[a][b]={},d[a][b].type=g,d[a][b].indexi="",d[a][b].indexj="",d[a][b].group="",0!=c[a][b].status||f?1!=c[a][b].status||f?(d[a][b].status=c[a][b].status,2==g||3==g?(d[a][b].type=h,d[a][b].code=c[a][b].code,d[a][b].displayType="s-cp-left-corner s-unclickable",d[a][b].iconType="icon-s-type-left",d[a][b+1]={},d[a][b+1].type=h,d[a][b+1].code=c[a][b+1].code,d[a][b+1].status=c[a][b+1].status,d[a][b+1].displayType="s-cp-right-corner s-unclickable",d[a][b+1].iconType="icon-s-type-right",b+=1):7==g?(d[a][b].type=h,d[a][b].code=c[a][b].code,d[a][b].displayType="s-sf-left-corner s-unclickable",d[a][b].iconType="icon-s-type-left",d[a][b+1]={},d[a][b+1].type=h,d[a][b+1].code=c[a][b+1].code,d[a][b+1].status=c[a][b+1].status,d[a][b+1].displayType="s-sf-middle s-unclickable",d[a][b+1].iconType="icon-s-type-mid",d[a][b+2]={},d[a][b+2].type=h,d[a][b+2].code=c[a][b+2].code,d[a][b+2].status=c[a][b+2].status,d[a][b+2].displayType="s-sf-right-corner s-unclickable",d[a][b+2].iconType="icon-s-type-right",b+=2):20==g?(d[a][b].type=h,d[a][b].displayType="s-cp-left-corner s-unclickable",d[a][b].iconType="icon-s-type-left",d[a][b+1]={},d[a][b+1].type=h,d[a][b+1].code=c[a][b+1].code,d[a][b+1].status=c[a][b+1].status,d[a][b+1].displayType="s-cp-right-corner s-unclickable",d[a][b+1].iconType="icon-s-type-right",b+=1):16==g?(d[a][b].type=h,d[a][b].displayType="s-b-left-corner s-unclickable",d[a][b].iconType="icon-b-type-left",d[a][b+1]={},d[a][b+1].type=h,d[a][b+1].code=c[a][b+1].code,d[a][b+1].status=c[a][b+1].status,d[a][b+1].displayType="s-b-right-corner s-unclickable",d[a][b+1].iconType="icon-b-type-right",b+=1):""==c[a][b].code||_.isUndefined(c[a][b].code)?d[a][b].displayType="s-null s-unclickable":(d[a][b].type=h,d[a][b].code=c[a][b].code,d[a][b].displayType="s-square s-unclickable",d[a][b].iconType="icon-s-type-single")):(d[a][b].type=i,d[a][b].code=c[a][b].code,d[a][b].status=c[a][b].status,2==g||3==g?(d[a][b].displayType="s-cp-left-corner s-unclickable",d[a][b].iconType="icon-s-type-left",d[a][b+1]={},d[a][b+1].type=i,d[a][b+1].code=c[a][b+1].code,d[a][b+1].status=c[a][b+1].status,d[a][b+1].displayType="s-cp-right-corner s-unclickable",d[a][b+1].iconType="icon-s-type-right",b+=1):7==g?(d[a][b].displayType="s-sf-left-corner s-unclickable",d[a][b].iconType="icon-s-type-left",d[a][b+1]={},d[a][b+1].type=i,d[a][b+1].code=c[a][b+1].code,d[a][b+1].status=c[a][b+1].status,d[a][b+1].displayType="s-sf-middle s-unclickable",d[a][b+1].iconType="icon-s-type-mid",d[a][b+2]={},d[a][b+2].type=i,d[a][b+2].code=c[a][b+2].code,d[a][b+2].status=c[a][b+2].status,d[a][b+2].displayType="s-sf-right-corner s-unclickable",d[a][b+2].iconType="icon-s-type-right",b+=2):20==g?(d[a][b].displayType="s-cp-left-corner s-unclickable",d[a][b].iconType="icon-s-type-left",d[a][b+1]={},d[a][b+1].type=i,d[a][b+1].code=c[a][b+1].code,d[a][b+1].status=c[a][b+1].status,d[a][b+1].displayType="s-cp-right-corner s-unclickable",d[a][b+1].iconType="icon-s-type-right",b+=1):16==g?(d[a][b].displayType="s-b-left-corner s-unclickable",d[a][b].iconType="icon-b-type-left",d[a][b+1]={},d[a][b+1].type=i,d[a][b+1].code=c[a][b+1].code,d[a][b+1].status=c[a][b+1].status,d[a][b+1].displayType="s-b-right-corner s-unclickable",d[a][b+1].iconType="icon-b-type-right",b+=1):(d[a][b].displayType="s-square s-unclickable",d[a][b].iconType="icon-s-type-single")):(d[a][b].code=c[a][b].code,d[a][b].status=c[a][b].status,0==g?(d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].indexi=a,d[a][b].indexj=b,d[a][b].displayType="s-square",d[a][b].iconType="icon-s-type-single"):1==g?(d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].indexi=a,d[a][b].indexj=b,d[a][b].displayType="s-square",d[a][b].iconType="icon-s-type-single"):3==g||2==g?(g=3,d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].displayType="s-cp-left-corner",d[a][b].iconType="icon-s-type-left",d[a][b].group=c[a][b].group,d[a][b+1]={},d[a][b+1].type=g,d[a][b+1].code=c[a][b+1].code+"_P0",d[a][b+1].status=c[a][b+1].status,d[a][b+1].data=btoa(JSON.stringify(c[a][b+1].data)),d[a][b+1].displayType="s-cp-right-corner",d[a][b+1].iconType="icon-s-type-right",d[a][b+1].group=c[a][b+1].group,b+=1):5==g?(d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].indexi=a,d[a][b].indexj=b,d[a][b].displayType="s-square",d[a][b].iconType="icon-s-type-single"):6==g?(d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].indexi=a,d[a][b].indexj=b,d[a][b].displayType="s-square",d[a][b].iconType="icon-s-type-single"):7==g?(d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].displayType="s-sf-left-corner",d[a][b].iconType="icon-s-type-left",d[a][b].group=c[a][b].group,d[a][b+1]={},d[a][b+1].type=g,d[a][b+1].code=c[a][b+1].code+"_P0",d[a][b+1].status=c[a][b+1].status,d[a][b+1].data=btoa(JSON.stringify(c[a][b+1].data)),d[a][b+1].displayType="s-sf-middle",d[a][b+1].iconType="icon-s-type-mid",d[a][b+1].group=c[a][b+1].group,d[a][b+2]={},d[a][b+2].type=g,d[a][b+2].code=c[a][b+2].code+"_P1",d[a][b+2].status=c[a][b+2].status,d[a][b+2].data=btoa(JSON.stringify(c[a][b+2].data)),d[a][b+2].displayType="s-sf-right-corner",d[a][b+2].iconType="icon-s-type-right",d[a][b+2].group=c[a][b+2].group,b+=2):20==g?(d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].displayType="s-cp-left-corner",d[a][b].iconType="icon-s-type-left",d[a][b].group=c[a][b].group,d[a][b+1]={},d[a][b+1].type=g,d[a][b+1].code=c[a][b+1].code+"_P0",d[a][b+1].status=c[a][b+1].status,d[a][b+1].data=btoa(JSON.stringify(c[a][b+1].data)),d[a][b+1].displayType="s-cp-right-corner",d[a][b+1].iconType="icon-s-type-right",d[a][b+1].group=c[a][b+1].group,b+=1):16==g?(d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].displayType="s-b-left-corner",d[a][b].iconType="icon-b-type-left",d[a][b].group=c[a][b].group,d[a][b+1]={},d[a][b+1].type=g,d[a][b+1].code=c[a][b+1].code+"_P0",d[a][b+1].status=c[a][b+1].status,d[a][b+1].data=btoa(JSON.stringify(c[a][b+1].data)),d[a][b+1].displayType="s-b-right-corner",d[a][b+1].iconType="icon-b-type-right",d[a][b+1].group=c[a][b+1].group,b+=1):(d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].indexi=a,d[a][b].indexj=b,d[a][b].displayType="s-square",d[a][b].iconType="icon-s-type-single"),e[g]&&(k(c[a][b].data.areaId,g),e[g]=!1))}else d[a][b].type=g,d[a][b].displayType="s-null s-unclickable";return{i:a,j:b}}function n(){b.best_seat=_.isUndefined(a.list_seat_java.bestSeat)?"":a.list_seat_java.bestSeat;var c=a.list_seat_java.areaSummary;b.area_summary={},b.seat_desc=a.list_seat_java.seatTypes;for(var d in c)b.area_summary[c[d].areaId]=c[d].requiredCapacity;a.typeseat=l(a.list_seat_java.seats),a.timeinterval=setInterval(s,1e3),a.loadingseat=!1}function o(){g.get(c,{url:"/api/booking/standard/seatdata?sessionId="+a.sessionId+"&userHash="+a.user.user_hash,keyCache:"no-cache"},function(c){if(a.typeseat=[],_.isUndefined(c.data)||"0"!=c.data.code)b.errorLoadingSeat=c.data.msg;else{b.best_seat=_.isUndefined(c.data.data.bestSeat)?"":c.data.data.bestSeat,b.seat_desc=c.data.data.seatTypes,a.maxTotalCapacity=_.isUndefined(c.data.data.maxTotalCapacity)?a.maxTotalCapacity:c.data.data.maxTotalCapacity,a.typeseat=l(c.data.data.seats),a.timeinterval=setInterval(s,1e3),b.area_summary={};for(var d in b.seat_desc)b.area_summary[d]=a.maxTotalCapacity}a.loadingseat=!1},function(a){console.log("error")})}function p(){g.get(c,{url:"/api/booking/vista/seatdata?sessionId="+a.sessionId+"&userHash="+a.user.user_hash,keyCache:"no-cache"},function(c){if(a.typeseat=[],_.isUndefined(c.data)||"0"!=c.data.code)b.errorLoadingSeat=c.data.msg;else{b.best_seat=_.isUndefined(c.data.data.bestSeat)?"":c.data.data.bestSeat,b.seat_desc=c.data.data.seatTypes,a.maxTotalCapacity=_.isUndefined(c.data.data.maxTotalCapacity)?a.maxTotalCapacity:c.data.data.maxTotalCapacity,a.typeseat=l(c.data.data.seats),a.timeinterval=setInterval(s,1e3),b.area_summary={};for(var d in b.seat_desc)b.area_summary[d]=a.maxTotalCapacity}a.loadingseat=!1},function(a){console.log("error")})}function q(){g.get(c,{url:"/api/booking/jupiter/seatdata?sessionId="+a.sessionId,keyCache:"no-cache"},function(c){if(a.typeseat=[],_.isUndefined(c.data)||"0"!=c.data.code)b.errorLoadingSeat=c.data.msg;else{b.best_seat=_.isUndefined(c.data.data.bestSeat)?"":c.data.data.bestSeat,b.seat_desc=c.data.data.seatTypes,a.maxTotalCapacity=c.data.data.maxTotalCapacity||10,a.user_session_id=c.data.data.userSessionId,a.typeseat=l(c.data.data.seats),a.timeinterval=setInterval(s,1e3),b.area_summary={};for(var d in b.seat_desc)b.area_summary[d]=a.maxTotalCapacity}a.loadingseat=!1},function(a){console.log("error")})}function r(){D-=1e3;var a=Math.floor(D/1e3%60),b=Math.floor(D/1e3/60%60);return{total:D,minutes:b,seconds:a}}function s(){var b=r();$("#seatv2 .minute").text(("0"+b.minutes).slice(-2)),$("#seatv2 .second").text(("0"+b.seconds).slice(-2)),b.total<=0&&(clearInterval(a.timeinterval),$("#seat-error-modal").modal("hide"),$("#rebookticketcheckout").show())}function u(a,b,c){for(var d=0;d<a.length;d++)if(a[d]==c){a.splice(d,1),b.splice(d,1);break}}function v(a,b){for(var c in b)if(a[c]!=b[c])return!1;return!0}function w(a){var b=0;for(var c in a)b+=a[c];return b}function x(a){var b=$("#seat"+a);return b.hasClass("colorchoosing")?!0:!1}function y(a){var b=0+a.type,c=0+a.status;return-1==C.indexOf(b)||-1!=[1,2].indexOf(c)?!1:!0}function z(b){var c;for(b.length>0&&(c=a.typeseat[parseInt($("#seat"+b[0]).data("indexi"))].length),t=0;t<b.length;t++){var d=$("#seat"+b[t]),e=parseInt(d.data("indexi")),f=parseInt(d.data("indexj"));if(f>0&&y(a.typeseat[e][f-1])&&!x(a.typeseat[e][f-1].code))if(f-1==0){if(y(a.typeseat[e][f+1]))return 1}else if(f-1>0)if(y(a.typeseat[e][f-2])){if(x(a.typeseat[e][f-2].code))return 2}else for(var g=1;c>f+g&&y(a.typeseat[e][f+g]);){if(!x(a.typeseat[e][f+g].code))return 1;g++}if(c>f+1&&y(a.typeseat[e][f+1])&&!x(a.typeseat[e][f+1].code))if(f+2==c){if(y(a.typeseat[e][f-1]))return 1}else if(c>f+2)if(y(a.typeseat[e][f+2])){if(x(a.typeseat[e][f+2].code))return 2}else for(var g=1;f-g+1>0&&y(a.typeseat[e][f-g]);){if(!x(a.typeseat[e][f-g].code))return 1;g++}}return 0}function A(a,b){var c=0;if(b.length>0)for(var d=0;d<b.length;d++)if(b[d]!=a){c=1;break}return c}a.listseatchosencode=[],a.listseatchosencodesort=[],a.listseatchosentype=[],a.typeseat=[],a.timeinterval=0,b.rowlength=0,b.total={},b.idarea={},b.seatColor={0:"colornormal",1:"colorvip",2:"colorcouple",3:"colorcouple",5:"colordeluxe",6:"colorfirst",7:"colorsofa",15:"colorgold",16:"colorbed",17:"colorpremium",18:"colorbeanbag",19:"color4dx",20:"colorsweetbox",21:"colorbed",99:"colornotchosen",100:"colorchosen"},a.loadingseat=!0,b.errorLoadingSeat="",b.maxseat=0,a.fullchosen=!1;var B=[0,1,2,3,5,6,7,8,15,16,17,18,19,20,21],C=[0,1,5,6,15,17,18,19,21];(1==a.isRedirectOuterPage&&a.isMobile&&2==a.step||!a.isMobile&&3==a.step||!a.isRedirectOuterPage&&a.step<4)&&i();var D=3e5;b.choose=function(c,d,e,f){var g=0,h=angular.element(c.currentTarget),i=JSON.parse(atob(h[0].dataset.data));if(""!=f)var j=document.getElementsByClassName("js-seat-group-"+f);if(B.includes(parseInt(e))){if(""!=a.userVoucher&&a.resetVoucher(),1!=e||a.exitsVip||(e=0),3==a.pCinemaId_real){var k=A(e,a.listseatchosentype);if(1==k)return b.seatErrorContent="Vui lòng chọn tất cả ghế cùng loại",$("#seat-error-modal").modal("show"),void(a.fullchosen=!1)}if(h.hasClass("colorchoosing")){if(""==f)h.removeClass("colorchoosing"),h.children(".numbercode").text(""),u(a.listseatchosencode,a.listseatchosentype,d),b.total[b.idarea[e]]-=1;else for(var l=0;l<j.length;l++)$(j[l]).removeClass("colorchoosing"),$(j[l]).children(".numbercode").text(""),u(a.listseatchosencode,a.listseatchosentype,j[l].dataset.code),b.total[b.idarea[e]]-=1;if(2==a.flowId||4==a.flowId||4==a.pCinemaId_real)if(""==f)a.totalPrice-=i.price||0;else for(var m=0,l=0;l<j.length;l++)m=JSON.parse(atob(j[l].dataset.data)).price||0,a.totalPrice-=m}else{if((2==a.flowId||4==a.flowId||4==a.pCinemaId_real)&&(g=w(b.total),g+=""==f?1:j.length,g<=a.maxTotalCapacity))if(""==f)a.totalPrice+=i.price||0;else for(var m=0,l=0;l<j.length;l++)m=JSON.parse(atob(j[l].dataset.data)).price||0,a.totalPrice+=m;if(1==a.flowId&&b.area_summary[b.idarea[e]]==b.total[b.idarea[e]]&&4!=a.pCinemaId_real){for(var n,l=0;l<a.listseatchosentype.length;l++)if(a.listseatchosentype[l]==e){n=a.listseatchosencode[l];break}var o=$(".seat"+n).data("group");if(""==o)$(".seat"+n).removeClass("colorchoosing"),$(".seat"+n).children(".numbercode").text(""),u(a.listseatchosencode,a.listseatchosentype,n);else for(var p=document.getElementsByClassName("js-seat-group-"+o),l=0;l<p.length;l++)$(p[l]).removeClass("colorchoosing"),$(p[l]).children(".numbercode").text(""),u(a.listseatchosencode,a.listseatchosentype,p[l].dataset.code)}else g<=a.maxTotalCapacity&&(""==f?b.total[b.idarea[e]]+=1:b.total[b.idarea[e]]+=j.length);if(g<=a.maxTotalCapacity){var q=d,r=e;if(""==f)h.addClass("colorchoosing"),h.children(".numbercode").text(parseInt(q.substring(1,q.length))),a.listseatchosencode.push(q),a.listseatchosentype.push(r);else for(var l=0;l<j.length;l++)q=j[l].dataset.code,$(j[l]).addClass("colorchoosing"),$(j[l]).children(".numbercode").text(parseInt(q.substring(1,q.length))),a.listseatchosencode.push(q),a.listseatchosentype.push(r)}else b.seatErrorContent="Bạn không thể chọn quá "+a.maxTotalCapacity+" ghế",$("#seat-error-modal").modal("show"),a.fullchosen=!1}if((1!=a.flowId||4==a.pCinemaId_real)&&3!=a.flowId){var k=z(a.sortfilter(a.listseatchosencode,a.listseatchosentype));return void(2==k?(b.seatErrorContent="Bạn không thể bỏ trống 1 ghế ở giữa",$("#seat-error-modal").modal("show"),a.fullchosen=!1):1==k?(b.seatErrorContent="Bạn không thể bỏ trống 1 ghế ở đầu mỗi dãy",$("#seat-error-modal").modal("show"),a.fullchosen=!1):a.listseatchosencode.length>0?a.fullchosen=!0:a.fullchosen=!1)}if($("#seat-error-modal").modal("hide"),a.fullchosen=v(b.total,b.area_summary),a.fullchosen){var k=z(a.sortfilter(a.listseatchosencode,a.listseatchosentype));2==k?(b.seatErrorContent="Bạn không thể bỏ trống 1 ghế ở giữa",$("#seat-error-modal").modal("show"),a.fullchosen=!1):1==k&&($("#seat-error-modal").modal("show"),b.seatErrorContent="Bạn không thể bỏ trống 1 ghế ở đầu mỗi dãy",a.fullchosen=!1)}}},b.loadSeat=function(){var a=($("#leftcheckout"),$("#seatcheckout"),$("#rightcheckout"),31*parseInt(b.numseat)+100);$(window).width()<1024?($(".room").css("width",a),$(".noteseat").css("margin-top","20"),$(".parent-panzoom").css({"overflow-x":"scroll","overflow-y":"hidden"})):a>$(".parent-panzoom").width()&&($(".room").css("width",a).css("margin-left","15px"),$(".seat").addClass("small"),$(".parent-panzoom").css({"overflow-x":"scroll","white-space":"nowrap"}))},a.sortfilter=function(a,b){for(var c=[],d=0;d<a.length;d++)3!=b[d]&&7!=b[d]&&16!=b[d]&&20!=b[d]&&c.push(a[d]);return c.sort()},a.sortlist=function(a){for(var b=[],c="",d=0;d<a.length;d++)c=a[d].split("_")[0],b.push(c);return b.sort()},b.closeErrorSeatModal=function(){$("#seat-error-modal").modal("hide")},$(window).on("beforeunload",function(){!angular.isDefined(a.user_session_id)||_.isNull(a.user_session_id)||_.isEmpty(a.user_session_id)||!angular.isDefined(a.sessionId)||_.isNull(a.sessionId)||_.isEmpty(a.sessionId)||0!==a.countUnload||(a.countUnload+=1,1==a.flowId&&a.cancelOrderOnUnloadV2(a.sessionId,a.user_session_id))})}]),angular.module("TIX").controller("CheckoutSeatV3Controller",["$rootScope","$scope","$http","$state","$sce","$cookies","APIServiceV2","CommonService",function(a,b,c,d,e,f,g,h){function i(){1==a.flowId?n():2==a.flowId?o():4==a.flowId&&p()}function j(c){b.maxseat=a.isMobile?1:2,b.numseat=c}function k(a,c){_.isUndefined(a)&&(a=c),b.total[a]=0,b.idarea[c]=a}function l(c){for(var d,e={},f=[],g=!1,h={},i=0;i<A.length;i++)e[A[i]]=!0;for(var i=0;i<c.length;i++){f[i]=[];for(var k=0;k<c[i].length;k++)for(0==b.maxseat&&j(c[i].length),h=m(i,k,c,f,e,g),d=k,i=h.i,k=h.j;k>=d;){if(2==a.flowId&&!_.isUndefined(f[i][d].data)){var l=JSON.parse(atob(f[i][d].data));_.isUndefined(a.listStandardTicketType[0])||_.isUndefined(a.listStandardTicketType[0][c[i][d].type])||(l.price=a.listStandardTicketType[0][c[i][d].type]),f[i][d].data=btoa(JSON.stringify(l))}d++}}for(var i in e)0==e[i]&&(b.seat_desc[i].is_show=1,b.seat_desc[i]["class"]=b.seatColor[i]);return f}function m(a,b,c,d,e,f){var g=c[a][b].type;if(d[a][b]={},10==g)d[a][b].type=g,d[a][b].code=c[a][b].code;else if(11==g)d[a][b].type=g,d[a][b].status=c[a][b].status,d[a][b].displayType="s-square",d[a][b].iconType="icon-s-type-single";else if(A.includes(parseInt(g))){const h=99,i=100;d[a][b]={},d[a][b].type=g,d[a][b].indexi="",d[a][b].indexj="",d[a][b].group="",0!=c[a][b].status||f?1!=c[a][b].status||f?(d[a][b].status=c[a][b].status,2==g||3==g?(d[a][b].type=h,d[a][b].code=c[a][b].code,d[a][b].displayType="s-cp-left-corner s-unclickable",d[a][b].iconType="icon-s-type-left",d[a][b+1]={},d[a][b+1].type=h,d[a][b+1].code=c[a][b+1].code,d[a][b+1].status=c[a][b+1].status,d[a][b+1].displayType="s-cp-right-corner s-unclickable",d[a][b+1].iconType="icon-s-type-right",b+=1):7==g?(d[a][b].type=h,d[a][b].code=c[a][b].code,d[a][b].displayType="s-sf-left-corner s-unclickable",d[a][b].iconType="icon-s-type-left",d[a][b+1]={},d[a][b+1].type=h,d[a][b+1].code=c[a][b+1].code,d[a][b+1].status=c[a][b+1].status,d[a][b+1].displayType="s-sf-middle s-unclickable",d[a][b+1].iconType="icon-s-type-mid",d[a][b+2]={},d[a][b+2].type=h,d[a][b+2].code=c[a][b+2].code,d[a][b+2].status=c[a][b+2].status,d[a][b+2].displayType="s-sf-right-corner s-unclickable",d[a][b+2].iconType="icon-s-type-right",b+=2):20==g?(d[a][b].type=h,d[a][b].displayType="s-cp-left-corner s-unclickable",d[a][b].iconType="icon-s-type-left",d[a][b+1]={},d[a][b+1].type=h,d[a][b+1].code=c[a][b+1].code,d[a][b+1].status=c[a][b+1].status,d[a][b+1].displayType="s-cp-right-corner s-unclickable",d[a][b+1].iconType="icon-s-type-right",b+=1):16==g?(d[a][b].type=h,d[a][b].displayType="s-b-left-corner s-unclickable",d[a][b].iconType="icon-b-type-left",d[a][b+1]={},d[a][b+1].type=h,d[a][b+1].code=c[a][b+1].code,d[a][b+1].status=c[a][b+1].status,d[a][b+1].displayType="s-b-right-corner s-unclickable",d[a][b+1].iconType="icon-b-type-right",b+=1):""==c[a][b].code||_.isUndefined(c[a][b].code)?d[a][b].displayType="s-null s-unclickable":(d[a][b].type=h,d[a][b].code=c[a][b].code,d[a][b].displayType="s-square s-unclickable",d[a][b].iconType="icon-s-type-single")):(d[a][b].type=i,d[a][b].code=c[a][b].code,d[a][b].status=c[a][b].status,2==g||3==g?(d[a][b].displayType="s-cp-left-corner s-unclickable",d[a][b].iconType="icon-s-type-left",d[a][b+1]={},d[a][b+1].type=i,d[a][b+1].code=c[a][b+1].code,d[a][b+1].status=c[a][b+1].status,d[a][b+1].displayType="s-cp-right-corner s-unclickable",d[a][b+1].iconType="icon-s-type-right",b+=1):7==g?(d[a][b].displayType="s-sf-left-corner s-unclickable",d[a][b].iconType="icon-s-type-left",d[a][b+1]={},d[a][b+1].type=i,d[a][b+1].code=c[a][b+1].code,d[a][b+1].status=c[a][b+1].status,d[a][b+1].displayType="s-sf-middle s-unclickable",d[a][b+1].iconType="icon-s-type-mid",d[a][b+2]={},d[a][b+2].type=i,d[a][b+2].code=c[a][b+2].code,d[a][b+2].status=c[a][b+2].status,d[a][b+2].displayType="s-sf-right-corner s-unclickable",d[a][b+2].iconType="icon-s-type-right",b+=2):20==g?(d[a][b].displayType="s-cp-left-corner s-unclickable",d[a][b].iconType="icon-s-type-left",d[a][b+1]={},d[a][b+1].type=i,d[a][b+1].code=c[a][b+1].code,d[a][b+1].status=c[a][b+1].status,d[a][b+1].displayType="s-cp-right-corner s-unclickable",d[a][b+1].iconType="icon-s-type-right",b+=1):16==g?(d[a][b].displayType="s-b-left-corner s-unclickable",d[a][b].iconType="icon-b-type-left",d[a][b+1]={},d[a][b+1].type=i,d[a][b+1].code=c[a][b+1].code,d[a][b+1].status=c[a][b+1].status,d[a][b+1].displayType="s-b-right-corner s-unclickable",d[a][b+1].iconType="icon-b-type-right",b+=1):(d[a][b].displayType="s-square s-unclickable",d[a][b].iconType="icon-s-type-single")):(d[a][b].code=c[a][b].code,d[a][b].status=c[a][b].status,0==g?(d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].indexi=a,d[a][b].indexj=b,d[a][b].displayType="s-square",d[a][b].iconType="icon-s-type-single"):1==g?(d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].indexi=a,d[a][b].indexj=b,d[a][b].displayType="s-square",d[a][b].iconType="icon-s-type-single"):3==g||2==g?(g=3,d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].displayType="s-cp-left-corner",d[a][b].iconType="icon-s-type-left",d[a][b].group=c[a][b].group,d[a][b+1]={},d[a][b+1].type=g,d[a][b+1].code=c[a][b+1].code+"_P0",d[a][b+1].status=c[a][b+1].status,d[a][b+1].data=btoa(JSON.stringify(c[a][b+1].data)),d[a][b+1].displayType="s-cp-right-corner",d[a][b+1].iconType="icon-s-type-right",d[a][b+1].group=c[a][b+1].group,b+=1):5==g?(d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].indexi=a,d[a][b].indexj=b,d[a][b].displayType="s-square",d[a][b].iconType="icon-s-type-single"):6==g?(d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].indexi=a,d[a][b].indexj=b,d[a][b].displayType="s-square",d[a][b].iconType="icon-s-type-single"):7==g?(d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].displayType="s-sf-left-corner",d[a][b].iconType="icon-s-type-left",d[a][b].group=c[a][b].group,d[a][b+1]={},d[a][b+1].type=g,d[a][b+1].code=c[a][b+1].code+"_P0",d[a][b+1].status=c[a][b+1].status,d[a][b+1].data=btoa(JSON.stringify(c[a][b+1].data)),d[a][b+1].displayType="s-sf-middle",d[a][b+1].iconType="icon-s-type-mid",d[a][b+1].group=c[a][b+1].group,d[a][b+2]={},d[a][b+2].type=g,d[a][b+2].code=c[a][b+2].code+"_P1",d[a][b+2].status=c[a][b+2].status,d[a][b+2].data=btoa(JSON.stringify(c[a][b+2].data)),d[a][b+2].displayType="s-sf-right-corner",d[a][b+2].iconType="icon-s-type-right",d[a][b+2].group=c[a][b+2].group,b+=2):20==g?(d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].displayType="s-cp-left-corner",d[a][b].iconType="icon-s-type-left",d[a][b].group=c[a][b].group,d[a][b+1]={},d[a][b+1].type=g,d[a][b+1].code=c[a][b+1].code+"_P0",d[a][b+1].status=c[a][b+1].status,d[a][b+1].data=btoa(JSON.stringify(c[a][b+1].data)),d[a][b+1].displayType="s-cp-right-corner",d[a][b+1].iconType="icon-s-type-right",d[a][b+1].group=c[a][b+1].group,b+=1):16==g?(d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].displayType="s-b-left-corner",d[a][b].iconType="icon-b-type-left",d[a][b].group=c[a][b].group,d[a][b+1]={},d[a][b+1].type=g,d[a][b+1].code=c[a][b+1].code+"_P0",d[a][b+1].status=c[a][b+1].status,d[a][b+1].data=btoa(JSON.stringify(c[a][b+1].data)),d[a][b+1].displayType="s-b-right-corner",d[a][b+1].iconType="icon-b-type-right",d[a][b+1].group=c[a][b+1].group,b+=1):(d[a][b].data=btoa(JSON.stringify(c[a][b].data)),d[a][b].indexi=a,d[a][b].indexj=b,d[a][b].displayType="s-square",d[a][b].iconType="icon-s-type-single"),e[g]&&(k(c[a][b].data.areaId,g),e[g]=!1))}else d[a][b].type=g,d[a][b].displayType="s-null s-unclickable";return{i:a,j:b}}function n(){b.best_seat=_.isUndefined(a.list_seat_java.bestSeat)?"":a.list_seat_java.bestSeat;var c=a.list_seat_java.areaSummary;b.area_summary={},b.seat_desc=a.list_seat_java.seatTypes;for(var d in c)b.area_summary[c[d].areaId]=c[d].requiredCapacity;a.typeSeatV2[0]=l(a.list_seat_java.seats),a.timeinterval=setInterval(r,1e3),a.loadingseat=!1}function o(){g.get(c,{url:"/api/booking/standard/seatdata?sessionId="+a.sessionId+"&userHash="+a.user.user_hash,keyCache:"no-cache"},function(c){if(_.isUndefined(c.data)||"0"!=c.data.code)b.errorLoadingSeat=c.data.msg;else{b.best_seat=_.isUndefined(c.data.data.bestSeat)?"":c.data.data.bestSeat,b.seat_desc=c.data.data.seatTypes,a.maxTotalCapacity=c.data.data.maxTotalCapacity,a.typeSeatV2[0]=l(c.data.data.seats),a.timeinterval=setInterval(r,1e3),b.area_summary={};for(var d in b.seat_desc)b.area_summary[d]=a.maxTotalCapacity}a.loadingseat=!1},function(a){console.log("error")})}function p(){g.get(c,{url:"/api/booking/jupiter/seatdata?sessionId="+a.sessionId,keyCache:"no-cache"},function(c){if(_.isUndefined(c.data)||"0"!=c.data.code)b.errorLoadingSeat=c.data.msg;else{b.best_seat=_.isUndefined(c.data.data.bestSeat)?"":c.data.data.bestSeat,b.seat_desc=c.data.data.seatTypes,a.maxTotalCapacity=c.data.data.maxTotalCapacity||10,a.user_session_id=c.data.data.userSessionId,a.typeSeatV2[0]=l(c.data.data.seats),a.timeinterval=setInterval(r,1e3),b.area_summary={};for(var d in b.seat_desc)b.area_summary[d]=a.maxTotalCapacity}a.loadingseat=!1},function(a){console.log("error")})}function q(){D-=1e3;var a=Math.floor(D/1e3%60),b=Math.floor(D/1e3/60%60);return{total:D,minutes:b,seconds:a}}function r(){var b=q();$("#seatv2 .minute").text(("0"+b.minutes).slice(-2)),$("#seatv2 .second").text(("0"+b.seconds).slice(-2)),b.total<=0&&(clearInterval(a.timeinterval),$("#seat-error-modal").modal("hide"),$("#rebookticketcheckout").show())}function s(b,c,d){for(var e=0;e<b.length;e++)if(b[e]==d){b.splice(e,1),c.splice(e,1),a.listseatchosentickettype.splice(e,1);break}}function u(a,b){for(var c in b)if(a[c]!=b[c])return!1;return!0}function v(a){var b=0;for(var c in a)b+=a[c];return b}function w(a){var b=$("#seat"+a);return b.hasClass("colorchoosing")?!0:!1}function x(a){var b=0+a.type,c=0+a.status;return-1==B.indexOf(b)||-1!=[1,2].indexOf(c)?!1:!0}function y(b){var c;for(b.length>0&&(c=a.typeSeatV2[a.curTicketType][parseInt($("#seat"+b[0]).data("indexi"))].length),t=0;t<b.length;t++){var d=$("#seat"+b[t]),e=parseInt(d.data("indexi")),f=parseInt(d.data("indexj"));if(f>0&&x(a.typeSeatV2[a.curTicketType][e][f-1])&&!w(a.typeSeatV2[a.curTicketType][e][f-1].code))if(f-1==0){if(x(a.typeSeatV2[a.curTicketType][e][f+1]))return 1}else if(f-1>0)if(x(a.typeSeatV2[a.curTicketType][e][f-2])){if(w(a.typeSeatV2[a.curTicketType][e][f-2].code))return 2}else for(var g=1;c>f+g&&x(a.typeSeatV2[a.curTicketType][e][f+g]);){if(!w(a.typeSeatV2[a.curTicketType][e][f+g].code))return 1;g++}if(c>f+1&&x(a.typeSeatV2[a.curTicketType][e][f+1])&&!w(a.typeSeatV2[a.curTicketType][e][f+1].code))if(f+2==c){if(x(a.typeSeatV2[a.curTicketType][e][f-1]))return 1}else if(c>f+2)if(x(a.typeSeatV2[a.curTicketType][e][f+2])){if(w(a.typeSeatV2[a.curTicketType][e][f+2].code))return 2}else for(var g=1;f-g+1>0&&x(a.typeSeatV2[a.curTicketType][e][f-g]);){if(!w(a.typeSeatV2[a.curTicketType][e][f-g].code))return 1;g++}}return 0}function z(a,b){var c=0;if(b.length>0)for(var d=0;d<b.length;d++)if(b[d]!=a){c=1;break}return c}a.listseatchosencode=[],a.listseatchosencodesort=[],a.listseatchosentype=[],a.listseatchosentickettype=[],a.timeinterval=0,b.rowlength=0,b.total={},b.idarea={},b.seatColor={0:"colornormal",1:"colorvip",2:"colorcouple",3:"colorcouple",5:"colordeluxe",6:"colorfirst",7:"colorsofa",15:"colorgold",16:"colorbed",17:"colorpremium",18:"colorbeanbag",19:"color4dx",20:"colorsweetbox",21:"colorbed",99:"colornotchosen",100:"colorchosen"},a.loadingseat=!0,b.errorLoadingSeat="",b.maxseat=0,a.fullchosen=!1,a.typeSeatV2={},a.curTicketType=0;var A=[0,1,2,3,5,6,7,8,15,16,17,18,19,20,21],B=[0,1,5,6,15,17,18,19,21],C=[2,3,16,20];(1==a.isRedirectOuterPage&&a.isMobile&&2==a.step||!a.isMobile&&3==a.step||!a.isRedirectOuterPage&&a.step<4)&&i();var D=3e5;b.choose=function(c,d,e,f){var g,h=0,i=[],j=angular.element(c.currentTarget),k=JSON.parse(atob(j[0].dataset.data));if(""!=f)var l=document.getElementsByClassName("js-seat-group-"+f);if(i=A,g=a.listseatchosentickettype[a.listseatchosencode.indexOf(d)],_.isUndefined(g)||g==a.curTicketType||a.changeAllTicketType(0),i.includes(parseInt(e))){if(""!=a.userVoucher&&a.resetVoucher(),1!=e||a.exitsVip||(e=0),3==a.pCinemaId_real){var m=z(e,a.listseatchosentype);if(1==m)return b.seatErrorContent="Vui lòng chọn tất cả ghế cùng loại",$("#seat-error-modal").modal("show"),void(a.fullchosen=!1)}if(j.hasClass("colorchoosing")){if(""==f)j.removeClass("colorchoosing"),j.children(".numbercode").text(""),s(a.listseatchosencode,a.listseatchosentype,d),b.total[b.idarea[e]]-=1;else for(var n=0;n<l.length;n++)$(l[n]).removeClass("colorchoosing"),$(l[n]).children(".numbercode").text(""),s(a.listseatchosencode,a.listseatchosentype,l[n].dataset.code),b.total[b.idarea[e]]-=1;if(2==a.flowId||4==a.flowId)if(""==f)a.totalPrice-=k.price;else for(var o=0,n=0;n<l.length;n++)o=JSON.parse(atob(l[n].dataset.data)).price,a.totalPrice-=o}else{if((2==a.flowId||4==a.flowId)&&(h=v(b.total),h+=""==f?1:l.length,h<=a.maxTotalCapacity))if(""==f)a.totalPrice+=k.price;else for(var o=0,n=0;n<l.length;n++)o=JSON.parse(atob(l[n].dataset.data)).price,a.totalPrice+=o;if(1==a.flowId&&b.area_summary[b.idarea[e]]==b.total[b.idarea[e]]){for(var p,n=0;n<a.listseatchosentype.length;n++)if(a.listseatchosentype[n]==e){p=a.listseatchosencode[n];break}var q=$(".seat"+p).data("group");if(""==q)$(".seat"+p).removeClass("colorchoosing"),$(".seat"+p).children(".numbercode").text(""),s(a.listseatchosencode,a.listseatchosentype,p);else for(var r=document.getElementsByClassName("js-seat-group-"+q),n=0;n<r.length;n++)$(r[n]).removeClass("colorchoosing"),$(r[n]).children(".numbercode").text(""),s(a.listseatchosencode,a.listseatchosentype,r[n].dataset.code)}else h<=a.maxTotalCapacity&&(""==f?b.total[b.idarea[e]]+=1:b.total[b.idarea[e]]+=l.length);if(h<=a.maxTotalCapacity){var t=d,w=e;if(""==f)j.addClass("colorchoosing"),j.children(".numbercode").text(parseInt(t.substring(1,t.length))),a.listseatchosencode.push(t),a.listseatchosentype.push(w),a.listseatchosentickettype.push(a.curTicketType);else for(var n=0;n<l.length;n++)t=l[n].dataset.code,
$(l[n]).addClass("colorchoosing"),$(l[n]).children(".numbercode").text(parseInt(t.substring(1,t.length))),a.listseatchosencode.push(t),a.listseatchosentype.push(w),a.listseatchosentickettype.push(a.curTicketType)}else b.seatErrorContent="Bạn không thể chọn quá "+a.maxTotalCapacity+" ghế",$("#seat-error-modal").modal("show"),a.fullchosen=!1}if(1!=a.flowId&&3!=a.flowId){var m=y(a.sortfilter(a.listseatchosencode,a.listseatchosentype));if(2==m)b.seatErrorContent="Bạn không thể bỏ trống 1 ghế ở giữa",$("#seat-error-modal").modal("show"),a.fullchosen=!1;else if(1==m)b.seatErrorContent="Bạn không thể bỏ trống 1 ghế ở đầu mỗi dãy",$("#seat-error-modal").modal("show"),a.fullchosen=!1;else if(a.listseatchosencode.length>0){a.fullchosen=!0;for(var n in a.seatTicketType)a.seatTicketType[n].codes=getListSeat(a.listseatchosencode,a.listseatchosentype,n)}else a.fullchosen=!1;return}if($("#seat-error-modal").modal("hide"),a.fullchosen=u(b.total,b.area_summary),a.fullchosen){var m=y(a.sortfilter(a.listseatchosencode,a.listseatchosentype));2==m?(b.seatErrorContent="Bạn không thể bỏ trống 1 ghế ở giữa",$("#seat-error-modal").modal("show"),a.fullchosen=!1):1==m&&($("#seat-error-modal").modal("show"),b.seatErrorContent="Bạn không thể bỏ trống 1 ghế ở đầu mỗi dãy",a.fullchosen=!1)}}},b.loadSeat=function(){var a=($("#leftcheckout"),$("#seatcheckout"),$("#rightcheckout"),31*parseInt(b.numseat)+100);$(window).width()<1024?($(".room").css("width",a),$(".noteseat").css("margin-top","20"),$(".parent-panzoom").css({"overflow-x":"scroll","overflow-y":"hidden"})):a>$(".parent-panzoom").width()&&($(".room").css("width",a).css("margin-left","15px"),$(".seat").addClass("small"),$(".parent-panzoom").css({"overflow-x":"scroll","white-space":"nowrap"}))},a.sortlistV2=function(a,b,c){for(var d=[],e="",f=0;f<a.length;f++)b[f]==c&&(e=a[f].split("_")[0],d.push(e));return d.sort()},getListSeat=function(b,c,d){for(var e=[],f="",g=0;g<b.length;g++)_.isUndefined(a.listStandardTicketType[d][c[g]])||(f=b[g].split("_")[0],C.includes(c[g])&&(++g,f+=","+b[g].split("_")[0]),e.push(f));return e.sort()},a.checkTicketType=function(b,c){var d=a.listseatchosencode,e=!1;b=b.split(",")[0];for(var f=0;f<d.length;f++)if(d[f]==b){e=a.listseatchosentickettype[f]==c;break}return e},updateSeatPrice=function(b,c,d){var e,f=a.listseatchosencode.indexOf(b);f>-1&&(e=a.listseatchosentype[f],a.totalPrice-=a.listStandardTicketType[c][e],a.totalPrice+=a.listStandardTicketType[d][e])},a.changeTicketType=function(b,c){for(var d,e=a.listseatchosencode,f=b.split(","),g=0;g<e.length&&f.length>0;)_.isUndefined(a.listStandardTicketType[c][a.listseatchosentype[g]])||(d=f.indexOf(e[g].split("_")[0]),d>-1&&a.listseatchosentickettype[g]!=c&&(updateSeatPrice(e[g],a.listseatchosentickettype[g],c),a.listseatchosentickettype[g]=c-0,f.splice(d,1))),++g},a.changeAllTicketType=function(b){for(var c=a.listseatchosencode,d=0;d<c.length;d++)a.changeTicketType(c[d].split("_")[0],b-0)},b.closeErrorSeatModal=function(){$("#seat-error-modal").modal("hide")},$(window).on("beforeunload",function(){!angular.isDefined(a.user_session_id)||_.isNull(a.user_session_id)||_.isEmpty(a.user_session_id)||!angular.isDefined(a.sessionId)||_.isNull(a.sessionId)||_.isEmpty(a.sessionId)||0!==a.countUnload||(a.countUnload+=1,1==a.flowId&&a.cancelOrderOnUnloadV2(a.sessionId,a.user_session_id))})}])}(),function(){angular.module("TIX").controller("CheckoutStepController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService",function(a,b,c,d,e,f,g){function h(){""!=a.userVoucher&&a.resetVoucher(),1!=a.pCinemaId?(a.step=1,$("#stepcheckout ul").children().eq(a.step).removeClass("active"),$("#stepcheckout ul").children().eq(a.step-1).addClass("active"),$("#leftcheckout").animate({left:0},"slow"),$(window).width()>1024&&$("#stepcheckout").animate({width:"100%"},"slow"),$("#combocheckout").css("right",-575),$("#rightcheckout").animate({right:-$("#rightcheckout").width()-10},"slow")):(a.step=1,$("#stepcheckout ul").children().eq(a.step).removeClass("active"),$("#stepcheckout ul").children().eq(a.step-1).addClass("active"),$("#leftcheckout").animate({left:0},"slow"),$(window).width()>1024&&$("#stepcheckout").animate({width:"100%"},"slow"),$("#combocheckout").css("right",-575),$("#rightcheckout").animate({right:-$("#rightcheckout").width()-10},"slow"),$("#ticketcheckout").animate({"margin-left":"28.5%"},"slow"),$("#ticketcheckout .detailticket").animate({left:"26%",right:0},"slow"))}b.ShowMenu=function(){b.justLoginIn&&(b.justLoginIn=!1)},b.prePage=function(){if(""!=a.userVoucher&&a.resetVoucher(),$(".chosenbutton").removeClass("dupp-disabled"),1==a.step)d.go("main.detail",{slug:a.film_id});else if(a.step>=2&&a.step<=3){if(a.countUnload+=1,a.isNewApi?a.cancelOrderOnUnloadV2(a.sessionId,a.user_session_id):a.cancelOrderOnUnload(a.user_session_id,a.pCinemaId),$("#leftcheckout").is(":animated"))return;$(window).width()>768?(h(),1==a.step&&clearInterval(a.timeinterval)):(d.go("main.detail",{slug:a.film_id}),2==a.step&&clearInterval(a.timeinterval))}else d.go("main.home")},a["continue"]=function(){if(a.totalPrice>0)if(a.step=3,$(window).width()>768){var b=$("#rightcheckout").width(),c=(parseInt($("#rightcheckout").css("padding-right")),Math.round(parseInt($("#leftcheckout").width())*(5/6)),Math.floor(100*($("#stepcheckout").width()-b+20)/$("#stepcheckout").width()));$("#leftcheckout").animate({left:-5*$("#leftcheckout .modalleft ").width()/6},"slow"),$("#rightcheckout").animate({right:0},"slow"),$(window).width()>=1024&&$("#stepcheckout").animate({width:c.toString()+"%"},"slow"),$("#combocheckout").animate({right:-(575-b)},"slow")}else $("#seatcheckout").hide()}}])}(),function(){angular.module("TIX").controller("CheckoutSuccessController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","APIServiceV2","ngMeta",function(a,b,c,d,e,f,g,h,i){function j(){if(d.params.apptransid&&d.params.appid&&1!==d.params.status&&"checkout.resultappid2"==d.current.name)19==d.params.apptransid.length?(b.invoice_no=d.params.apptransid,a.isNewApi=!0):b.invoice_no="20"+d.params.apptransid,g.get(c,{url:"/transaction/query/zalopaygw?invoice_no="+b.invoice_no,keyCache:"no-cache"},function(c){c.data.hasOwnProperty("error")&&d.go("main.home");var e=c.data.result.responseCode;1==e?(a.waitingCheckout=!1,l(b.invoice_no,!0)):0==e||(9==e?d.go("main.home"):(a.waitingCheckout=!1,l(b.invoice_no,!1))),$("#mainContent").addClass("checkout")},function(a){console.log("error")});else if(d.params.apptransid&&"checkout.resultappid"==d.current.name&&-49!=d.params.status)19==d.params.apptransid.length?b.invoice_no=d.params.apptransid:b.invoice_no="20"+d.params.apptransid,19==b.invoice_no.length&&(a.isNewApi=!0),$("#mainContent").addClass("checkout"),C=setInterval(k,3e3);else{if(d.params.invoice_no)b.invoice_no=d.params.invoice_no;else if(d.params.apptransid&&d.params.appid&&(1===d.params.status||-49==d.params.status)){if(19==d.params.apptransid.length?(b.invoice_no=d.params.apptransid,a.isNewApi=!0):b.invoice_no="20"+d.params.apptransid,-49==d.params.status)return a.isNewApi?void h.get(c,{url:"/api/booking/order?invoiceNo="+b.invoice_no,keyCache:"no-cache"},function(b){_.isEmpty(b.data)?d.go("main.home"):0==b.data.code?(a.pCinemaId=b.data.data.pCinemaId,a.flowId=b.data.data.flowId,a.sessionId=b.data.data.sessionId,A()):d.go("main.home")},function(a){console.log("error")}):void z()}else d.params.transactionID?b.invoice_no=d.params.transactionID:d.go("main.home");19==b.invoice_no.length&&(a.isNewApi=!0),$("#mainContent").addClass("checkout"),C=setInterval(k,3e3)}}function k(){var e=localStorage.getItem("email");null===e&&(e=void 0);var f=localStorage.getItem("phone");null===f&&(f=void 0),a.isNewApi?_.isUndefined(a.flowId)||_.isUndefined(a.sessionId)?h.get(c,{url:"/api/booking/order?invoiceNo="+b.invoice_no,keyCache:"no-cache"},function(c){_.isEmpty(c.data)?(clearInterval(C),d.go("main.home")):0==c.data.code?(a.pCinemaId=c.data.data.pCinemaId,a.flowId=c.data.data.flowId,a.sessionId=c.data.data.sessionId,1==a.flowId?m(b.invoice_no):3==a.flowId?o(b.invoice_no):4==a.flowId?p(b.invoice_no):n(b.invoice_no)):(clearInterval(C),d.go("main.home"))},function(a){clearInterval(C),console.log("error")}):1==a.flowId?m(b.invoice_no):3==a.flowId?o(b.invoice_no):4==a.flowId?p(b.invoice_no):n(b.invoice_no):g.get(c,{url:"/transaction/statusweb?invoice_no="+b.invoice_no+"&email="+e+"&phone="+f,keyCache:"no-cache"},function(c){c.data.hasOwnProperty("error")&&(clearInterval(C),d.go("main.home"));var e=c.data.result.responseCode;1==e?(a.waitingCheckout=!1,clearInterval(C),l(b.invoice_no,!0)):0==e||(9==e?(clearInterval(C),d.go("main.home")):(a.waitingCheckout=!1,clearInterval(C),l(b.invoice_no,!1)))},function(a){clearInterval(C),console.log("error")})}function l(b,e){g.get(c,{url:"/transaction/detail?invoice_no="+b,keyCache:"no-cache"},function(c){if(c.data.result){var f=c.data.result;if(a.pCinemaId=f.p_cinema_id,1==a.pCinemaId){a.colorpCinema="#CA4137",a.pCinema=f.p_cinema_name;for(var g in f.vouchers){var h=f.vouchers[g],j=moment(h.date_expired+" 23:00:00","DD/MM/YYYY HH:mm:ss").diff(moment(h.date_bought,"DD/MM/YYYY"),"seconds");j>86400?(j=Math.ceil(j/86400),h.badge=j+" ngày"):j>3600?(j=Math.ceil(j/3600),h.badge=j+" giờ"):j>0?(j=Math.ceil(j/60),h.badge=j+" phút"):(j=0,h.badge="Hết hạn"),h.is_used=0}a.list_voucher=f.vouchers,i.init(),i.setDefaultTag("title",a.pCinema+" - Voucher"),v()}else a.ticket_code=f.ticket_code,a.leftImage=a.isMobile?f.poster_url_landscape:f.poster_url,a.qr_code=f.qr_code,a.list_combo=s(f.list_combo),a.list_ticket=r(f.list_seat),a.film_name=f.film_name,a.film_age=f.film_age,a.film_duration=f.film_duration,a.version_id=f.film_version,a.cinema_address=f.cinema_address,a.cinema_logo=f.cinema_logo,a.session_time=t(f.session_time),a.session_date=u(f.session_time),a.session_day=w(f.session_time),a.room_name=f.room_name,a.imdb_point=f.imdb_point,a.rating=f.rating,i.init(),i.setDefaultTag("title",a.film_name),a.colorpCinema="#9C9C9C",a.pCinema=f.cinema_name_s1,a.pName=f.cinema_name_s2,2==f.p_cinema_id?a.colorpCinema="#ff6600":4==f.p_cinema_id?a.colorpCinema="#8bc541":6==f.p_cinema_id?a.colorpCinema="#9C9C9C":16==f.p_cinema_id?a.colorpCinema="#CA4137":17==f.p_cinema_id?a.colorpCinema="#e5a813":19==f.p_cinema_id?a.colorpCinema="#1D7BD0":20==f.p_cinema_id?a.colorpCinema="#9C9C9C":22==f.p_cinema_id&&(a.colorpCinema="#ea3b92");e?(a.buySuccess=1,a.sendGA("Payment","Payment Success","Invoice_no: "+b+", "+a.pCinema+", "+a.film_name+", "+a.session_date+", "+a.session_time+", "+a.room_name)):(a.buySuccess=2,a.sendGA("Payment","Payment Fail","Invoice_no: "+b+", "+a.pCinema+", "+a.film_name+", "+a.session_date+", "+a.session_time+", "+a.room_name)),v()}else d.go("main.home")},function(a){console.log("error")})}function m(b){h.get(c,{url:"/api/booking/vista/order?invoiceNo="+b,keyCache:"no-cache"},function(b){if(_.isEmpty(b.data))clearInterval(C),d.go("main.home");else if(0==b.data.code){var c=b.data.data;a.ticket_code=c.ticket,a.qr_code=c.qrCode,a.list_combo=_.isUndefined(c.listCombos)?"":s(c.listCombos),a.list_ticket=_.isUndefined(c.listSeats)?"":r(c.listSeats),clearInterval(C),a.buySuccess=1,a.waitingCheckout=!1,q(a.sessionId)}else 10==b.data.code||(a.list_combo="",1!=b.data.code&&setTimeout(function(){$(".buyFail").html(b.data.msg)},1e3),clearInterval(C),a.buySuccess=2,a.waitingCheckout=!1,q(a.sessionId))},function(a){console.log("error")})}function n(b){h.get(c,{url:"/api/booking/standard/order?invoiceNo="+b,keyCache:"no-cache"},function(b){if(_.isEmpty(b.data))clearInterval(C),d.go("main.home");else if(0==b.data.code){var c=b.data.data;a.ticket_code=c.ticket,a.qr_code=c.qrCode,a.list_combo=_.isUndefined(c.listCombos)?"":s(c.listCombos),a.list_ticket=_.isUndefined(c.listSeats)?"":r(c.listSeats),clearInterval(C),a.buySuccess=1,a.waitingCheckout=!1,q(a.sessionId)}else 10==b.data.code||(a.list_combo="",1!=b.data.code&&setTimeout(function(){$(".buyFail").html(b.data.msg)},1e3),clearInterval(C),a.buySuccess=2,a.waitingCheckout=!1,q(a.sessionId))},function(a){console.log("error")})}function o(b){h.get(c,{url:"/api/booking/lotte/order?invoiceNo="+b,keyCache:"no-cache"},function(b){if(_.isEmpty(b.data))clearInterval(C),d.go("main.home");else if(a.pCinema="Lotte",0==b.data.code){var c=b.data.data;clearInterval(C),a.buySuccess=1,a.waitingCheckout=!1,a.colorpCinema="#CA4137";for(var e in c){var f=c[e];f.date_expired=moment(f.validTo,"YYYY-MM-DD HH:mm:ss").format("DD/MM/YYYY"),f.date_bought=moment(f.boughtAt,"YYYY-MM-DD HH:mm:ss").format("DD/MM/YYYY"),f.title=f.voucherName;for(var g in c[e].codes)c[e].codes[g].display_style=c[e].codes[g].displayStyle;var h=moment(f.validTo,"YYYY-MM-DD HH:mm:ss").diff(moment(f.boughtAt,"YYYY-MM-DD HH:mm:ss"),"seconds");h>86400?(h=Math.ceil(h/86400),f.badge=h+" ngày"):h>3600?(h=Math.ceil(h/3600),f.badge=h+" giờ"):h>0?(h=Math.ceil(h/60),f.badge=h+" phút"):(h=0,f.badge="Hết hạn"),f.is_used=0}a.list_voucher=c,i.init(),i.setDefaultTag("title",a.pCinema+" - Voucher"),v()}else 10==b.data.code||(a.list_combo="",1!=b.data.code&&(a.rightErrorContent=b.data.msg,$("#right-error-modal").modal("show")),clearInterval(C),a.buySuccess=2,a.waitingCheckout=!1,i.init(),i.setDefaultTag("title",a.pCinema+" - Voucher"),v())},function(a){console.log("error")})}function p(b){h.get(c,{url:"/api/booking/jupiter/order?invoiceNo="+b,keyCache:"no-cache"},function(b){if(_.isEmpty(b.data))clearInterval(C),d.go("main.home");else if(0==b.data.code){var c=b.data.data;a.ticket_code=c.ticket,a.qr_code=c.qrCode,a.list_combo=_.isUndefined(c.listCombos)?"":s(c.listCombos),a.list_ticket=_.isUndefined(c.listSeats)?"":r(c.listSeats),clearInterval(C),a.buySuccess=1,a.waitingCheckout=!1,q(a.sessionId)}else 10==b.data.code||(a.list_combo="",1!=b.data.code&&setTimeout(function(){$(".buyFail").html(b.data.msg)},1e3),clearInterval(C),a.buySuccess=2,a.waitingCheckout=!1,q(a.sessionId))},function(a){console.log("error")})}function q(b){h.get(c,{url:"/api/data/session?sessionId="+b,keyCache:"no-cache"},function(b){if(a.waitingCheckout=!1,!_.isUndefined(b.data)&&!_.isEmpty(b.data)&&0==b.data.code){var c=b.data.data;a.cinema_address=c.cinema.address,a.cinema_logo=c.pCinema.logo,a.session_time=t(c.time),a.session_date=u(c.time),a.session_day=w(c.time),a.room_name=c.room.name,a.film_duration=c.film.duration,a.film_name=c.film.nameVI,a.film_age=c.film.age,a.leftImage=a.isMobile?c.film.images.type6_path:c.film.images.type1_path,a.imdb_point=c.film.imdbPoint,a.version_id=y(c.version,c.isDub),i.init(),i.setDefaultTag("title",a.film_name),a.colorpCinema="#9C9C9C",a.pCinema=c.cinema.nameS1,a.pName=c.cinema.nameS2,2==a.pCinemaId?a.colorpCinema="#ff6600":4==a.pCinemaId?a.colorpCinema="#8bc541":6==a.pCinemaId?a.colorpCinema="#9C9C9C":16==a.pCinemaId?a.colorpCinema="#CA4137":17==a.pCinemaId?a.colorpCinema="#e5a813":19==a.pCinemaId?a.colorpCinema="#1D7BD0":20==a.pCinemaId?a.colorpCinema="#9C9C9C":22==a.pCinemaId&&(a.colorpCinema="#ea3b92"),v()}},function(a){console.log("error")})}function r(b){var c=[];if(a.isNewApi)c=b.split(",");else for(var d=0;d<b.length;d++)c.push(b[d].seat_code);return c}function s(b){var c=[];if(a.isNewApi)for(var d=0;d<b.length;d++){var e={name:b[d].name,amount:b[d].quantity};c.push(e)}else for(var d=0;d<b.length;d++){var e={name:b[d].item_name,amount:b[d].amount};c.push(e)}return c}function t(a){var b=a.split(" ")[1].split(":");return b[0]+":"+b[1]}function u(a){var b=a.split(" ")[0],c=b.split("-");return c[2]+"/"+c[1]+"/"+c[0]}function v(){$(document).ready(function(){var b,c,d,e=$("#successcheckout .contentfull").height()+20,f=screen.height-60;if(b=$("#successcheckout .contentfull .leftmobile").height(),c=$("#successcheckout .contentfull .infomationticket").height()+30,d=60,codecart=f-b-c-d-30,a.isMobile&&$(window).height()<=B&&f>=e)$("#successcheckout").css("height",f),$("#successcheckout .contentfull .codecart").css("height",codecart);else if(f>=e){var g=$("#successcheckout .ticketinfo");if(g.length>0);else{var h=$("#successcheckout .js-voucher-info").height(),i=Math.max($(window).height()-h-192-110,15);$("#successcheckout .space").css("margin-top",i)}}})}function w(a){for(var b=a.split(" ")[0],c=parseInt(b[8]+b[9]),d=0;7>d;d++)if(moment().add("days",d).date()==c)return 0==d?"Hôm nay":1==d?"Ngày mai":Common.dayOfWeek[moment().add("days",d).day()]}function x(){for(var b in a.list_voucher)for(var c in a.list_voucher[b].codes){var d=a.list_voucher[b].codes[c];"BC"==d.display_style&&JsBarcode("#barcode"+b+"_"+c,d.code,{displayValue:!1,height:60})}}function y(a,b){var c="";return c+=a+"D",2==a&&(c+=_.isUndefined(b)||1!=b?"/Digital":"/L.Tiếng"),c}function z(){var e={invoice_no:b.invoice_no};g.post(c,{url:"/checkout/cancel",keyCache:"no-cache"},e,function(b){b.data.hasOwnProperty("error")?a.rightErrorContent="Hủy giao dịch thất bại":a.rightErrorContent="Hủy giao dịch thành công",$("#right-error-modal").modal("show"),$(".btnOk","#right-error-modal").click(function(){d.go("main.home")})},function(a){console.log("Cancel Order Error")})}function A(){if(!_.isUndefined(b.invoice_no)&&!_.isEmpty(b.invoice_no)){var e="";1==a.flowId?e="/api/booking/vista/order?invoiceNo="+b.invoice_no+"&sessionId="+a.sessionId:2==a.flowId?e="/api/booking/standard/order?invoiceNo="+b.invoice_no+"&sessionId="+a.sessionId:3==a.flowId?e="/api/booking/lotte/order?invoiceNo="+a.invoice_no:4==a.flowId&&(e="/api/booking/jupiter/order?invoiceNo="+b.invoice_no+"&sessionId="+a.sessionId),""!=e&&h["delete"](c,{url:e,keyCache:"no-cache"},function(b){0==b.data.code?a.rightErrorContent="Hủy giao dịch thành công":a.rightErrorContent=b.data.msg,$("#right-error-modal").modal("show"),$(".btnOk","#right-error-modal").click(function(){d.go("main.home")})},function(a){console.log("Cancel Order Error")})}}b.invoice_no=0,a.step=4,a.pCinemaId=0,a.waitingCheckout=!0;var B=736,C=0;a.buySuccess=0,b.isBarcodeUpdated=!1,a.isNewApi=!1,j(),b.returnhome=function(){d.go("main.home")},b.removeAge=function(a){var b="";if(void 0!=a){var c=a.indexOf("(");b=-1!=c?a.slice(0,c):a}return b},b.openLotteGuide=function(){a.isShowModalLotteGuide=!0},b.closeModalVoucher=function(){a.isShowModalVoucher=!1},b.clickVoucher=function(c){b.isBarcodeUpdated||(b.isBarcodeUpdated=!0,x(),$("#v-slider").slick({dots:!0,arrows:!0,fade:!0,infinite:!1})),$("#v-slider").slick("slickGoTo",c),$(window).trigger("resize"),a.isShowModalVoucher=!0}}])}(),function(){angular.module("TIX").controller("CheckoutTicketController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","APIServiceV2","CommonService",function(a,b,c,d,e,f,g,h,i){function j(){a.errorGetTicket=""}function k(b){a.isNewApi?1==a.pCinemaId?l(b):s(b):1==a.pCinemaId?l(b):2==a.pCinemaId?o(b):4==a.pCinemaId?n(b):6==a.pCinemaId?p(b):17==a.pCinemaId&&q(b)}function l(b){if(a.step=3,$(".chosenbutton").addClass("dupp-disabled"),$(window).width()>768){var c=$("#rightcheckout").width(),d=(parseInt($("#rightcheckout").css("padding-right")),Math.round(parseInt($("#leftcheckout").width())*(1/6)),Math.floor(100*($("#stepcheckout").width()-c+20)/$("#stepcheckout").width()));$(window).width()>1500?($("#ticketcheckout .detailticket").animate({left:"7%",right:440},"slow"),$("#ticketcheckout").animate({"margin-left":(4.5+(d-75>0?d-75:0)).toString()+"%"},"slow")):($("#ticketcheckout .detailticket").animate({left:"2%",right:"23%"},"slow"),$("#ticketcheckout").animate({"margin-left":"4.5%"},"slow")),$("#stepcheckout ul").children().eq(0).removeClass("active"),$("#stepcheckout ul").children().eq(1).addClass("active"),$("#leftcheckout").animate({left:-$("#leftcheckout .modalleft ").width()*(5/6)},"slow"),$("#rightcheckout").animate({right:0},"slow"),$(window).width()>1024&&$("#stepcheckout").animate({width:d.toString()+"%"},"slow"),$("#combocheckout").animate({right:-(465-c)},"slow")}else $("#seatcheckout").hide()}function m(){var a=localStorage.getItem("userSessionBHD");return angular.isDefined(a)&&null!==a?!0:!1}function n(b){if(a.isBHDMember)if(b.member_id=a.userid,b.member_session_id=a.usersessionid,m())b.user_session_id=a.usersessionid;else{var d=moment(new Date).add(15,"m"),e=(d.toDate(),{result:a.usersessionid,expire:Math.floor(Date.now()/1e3)});localStorage.setItem("userSessionBHD",JSON.stringify(e)),b.user_session_id=""}g.post(c,{url:"/checkout/bhd/ticket",keyCache:"no-cache"},b,function(b){if(b.data.hasOwnProperty("error")){a.loadingticket=!1;var c=b.data.error.message;-1!=c.indexOf("thẻ thành viên")?a.errorGetTicket="Ưu đãi chỉ dành cho khách hàng mua vé trên app TIX (iOS hoặc Android) và có liên kết thẻ thành viên BHD Star tại mục tài khoản":a.errorGetTicket=b.data.error.message}else a.step=2,$(window).width()>768&&a["continue"](),$("#stepcheckout ul").children().eq(0).removeClass("active"),$("#stepcheckout ul").children().eq(1).addClass("active"),a.user_session_id=b.data.result.user_session_id,a.loadingticket=!1,a.list_seat=b.data.result.list_seat},function(a){console.log("error")})}function o(b){b.is_full_data=1,g.post(c,{url:"/checkout/galaxy/ticket",keyCache:"no-cache"},b,function(b){b.data.hasOwnProperty("error")?(a.loadingticket=!1,a.errorGetTicket=b.data.error.message):(a.step=2,$(window).width()>768&&a["continue"](),$("#stepcheckout ul").children().eq(0).removeClass("active"),$("#stepcheckout ul").children().eq(1).addClass("active"),a.user_session_id=b.data.result.user_session_id,a.loadingticket=!1,a.list_seat=b.data.result.list_seat)},function(a){console.log("error")})}function p(b){g.post(c,{url:"/checkout/ddc/ticket",keyCache:"no-cache"},b,function(b){b.data.hasOwnProperty("error")?(a.loadingticket=!1,a.errorGetTicket=b.data.error.message):(a.step=2,$(window).width()>768&&a["continue"](),$("#stepcheckout ul").children().eq(0).removeClass("active"),$("#stepcheckout ul").children().eq(1).addClass("active"),a.user_session_id=b.data.result.user_session_id,a.loadingticket=!1,a.list_seat=b.data.result.list_seat)},function(a){console.log("error")})}function q(b){g.post(c,{url:"/checkout/megags/ticket",keyCache:"no-cache"},b,function(b){b.data.hasOwnProperty("error")?(a.loadingticket=!1,a.errorGetTicket=b.data.error.message):(a.step=2,$(window).width()>768&&a["continue"](),$("#stepcheckout ul").children().eq(0).removeClass("active"),$("#stepcheckout ul").children().eq(1).addClass("active"),a.user_session_id=b.data.result.user_session_id,a.loadingticket=!1,a.list_seat=b.data.result.list_seat)},function(a){console.log("error")})}function r(b){var c={userHash:a.user.user_hash,sessionId:b.session_id,returnSeatData:1,returnConcession:1,tickets:[]};for(var d in b.list_ticket){var e={};e.quantity=b.list_ticket[d].type_num,e.typeCode=b.list_ticket[d].type_code,e.typePrice=b.list_ticket[d].type_price,c.tickets.push(e)}return c}function s(b){b=r(b),h.post(c,{url:"/api/booking/vista/tickettype",keyCache:"no-cache"},b,function(b){if(0==b.data.code){a.step=2,$(window).width()>768&&a["continue"](),$("#stepcheckout ul").children().eq(0).removeClass("active"),$("#stepcheckout ul").children().eq(1).addClass("active"),a.user_session_id=b.data.data.userSessionId,a.loadingticket=!1;for(var c in b.data.data.concessions)for(var d in b.data.data.concessions[c].concessions)b.data.data.concessions[c].concessions[d].amount=0;a.combolist=b.data.data.concessions,delete b.data.data.concessions,a.list_seat_java=b.data.data}else{a.loadingticket=!1;var e=b.data.msg;-1!=e.indexOf("thẻ thành viên")?a.errorGetTicket="Ưu đãi chỉ dành cho khách hàng mua vé trên app TIX (iOS hoặc Android) và có liên kết thẻ thành viên BHD Star tại mục tài khoản":a.errorGetTicket=b.data.msg}},function(a){console.log("error")})}a.loadingticket=!1;var t=0,u=0;j(),b.choseSeat=function(){if(a.totalPrice>0){a.sendGA("Payment","Click Next Seat Screen",a.film_name),a.sendGA("Payment","Click Next Type Ticket",a.film_name),1!=a.pCinemaId&&(a.loadingticket=!0);var b=[];for(var c in a.ticketTypes)a.ticketTypes[c].type_num>0&&b.push(a.ticketTypes[c]);var d={};d.session_id=a.sessionId,d.list_ticket=b,d.user_session_id=a.user_session_id,a.countUnload=0,k(d)}},b.addTicket=function(b){a.sendGA("Payment","Increase Combo Number",a.film_name),a.totalticket+=b.type_capacity,a.totalticket<=a.maxTotalCapacity?(b.type_num=Math.min(10,b.type_num+1),i.calTotal(a)):a.totalticket-=b.type_capacity,$(window).width()>768?$("#totalcost").is(":animated")?($("#totalcost").stop(!0,!1).animate({fontSize:(t+10).toString()+"px"},400),$("#totalcost").animate({fontSize:t.toString()+"px"},400)):(t=parseInt($("#totalcost").css("font-size")),$("#totalcost").animate({fontSize:(t+10).toString()+"px"},400).animate({fontSize:t.toString()+"px"},400)):$("#totalcostmobile").is(":animated")?($("#totalcostmobile").stop(!0,!1).animate({fontSize:(t+8).toString()+"px"},400),$("#totalcostmobile").animate({fontSize:t.toString()+"px"},400),$("#detailsub").stop(!0,!1).animate({fontSize:(u+4).toString()+"px","margin-top":"2px","margin-bottom":"13px"},400),$("#detailsub").animate({fontSize:u.toString()+"px","margin-top":"0px","margin-bottom":"10px"},400),$("#detailunit").stop(!0,!1).animate({fontSize:(u+4).toString()+"px"},400),$("#detailunit").animate({fontSize:u.toString()+"px"},400)):(t=parseInt($("#totalcostmobile").css("font-size")),u=t/2-2,$("#totalcostmobile").animate({fontSize:(t+8).toString()+"px"},400).animate({fontSize:t.toString()+"px"},400),$("#detailsub").animate({fontSize:(u+4).toString()+"px","margin-top":"2px","margin-bottom":"13px"},400).animate({fontSize:u.toString()+"px","margin-top":"0px","margin-bottom":"10px"},400),$("#detailunit").animate({fontSize:(u+4).toString()+"px"},400).animate({fontSize:u.toString()+"px"},400))},b.minusTicket=function(b){a.totalticket-=b.type_capacity,b.type_num=Math.max(0,b.type_num-1),i.calTotal(a),a.sendGA("Payment","Decrease Ticket Number",a.film_name),$(window).width()>768?$("#totalcost").is(":animated")?($("#totalcost").stop(!0,!1).animate({fontSize:(t+10).toString()+"px"},400),$("#totalcost").animate({fontSize:t.toString()+"px"},400)):(t=parseInt($("#totalcost").css("font-size")),$("#totalcost").animate({fontSize:(t+10).toString()+"px"},400).animate({fontSize:t.toString()+"px"},400)):$("#totalcostmobile").is(":animated")?($("#totalcostmobile").stop(!0,!1).animate({fontSize:(t+8).toString()+"px"},400),$("#totalcostmobile").animate({fontSize:t.toString()+"px"},400),$("#detailsub").stop(!0,!1).animate({fontSize:(u+4).toString()+"px","margin-top":"2px","margin-bottom":"13px"},400),$("#detailsub").animate({fontSize:u.toString()+"px","margin-top":"0px","margin-bottom":"10px"},400),$("#detailunit").stop(!0,!1).animate({fontSize:(u+4).toString()+"px"},400),$("#detailunit").animate({fontSize:u.toString()+"px"},400)):(t=parseInt($("#totalcostmobile").css("font-size")),u=t/2-2,$("#totalcostmobile").animate({fontSize:(t+8).toString()+"px"},400).animate({fontSize:t.toString()+"px"},400),$("#detailsub").animate({fontSize:(u+4).toString()+"px","margin-top":"2px","margin-bottom":"13px"},400).animate({fontSize:u.toString()+"px","margin-top":"0px","margin-bottom":"10px"},400),$("#detailunit").animate({fontSize:(u+4).toString()+"px"},400).animate({fontSize:u.toString()+"px"},400))},b.fixHeightTicketType=function(){$(document).ready(function(){var a=$("#stepcheckout").height(),b=parseInt($("#ticketcheckout").css("padding-top")),c=$("#ticketcheckout .topContent").height(),d=parseInt($("#ticketcheckout .ticketType").css("margin-top")),e=$("#ticketcheckout .detailticket").height(),f=$("#ticketcheckout .ticketType").height()+20,g=$(window).height()-(a+b+c+d+e);f>g&&$("#ticketcheckout .detailticket").addClass("setStatic")})},b.removeAge=function(a){var b="";if(void 0!=a){var c=a.indexOf("(");b=-1!=c?a.slice(0,c):a}return b}}])}(),function(){angular.module("TIX").controller("CinemaMobileController",["$rootScope","$scope","$http","$state","APIService","$window","$timeout",function(a,b,c,d,e,f,g){function h(){a.isCinemaDetail=!1,i(),j(),"main.cinemaMobile"===d.current.name&&$("#footer").hide()}function i(){if(angular.isUndefined(a.listPCinemas)){var b=[];e.get(c,{url:"/cinema/list?location_id="+a.locationId,keyCache:"main-cinemas"+a.locationId},function(c){var d=c.data.result;a.listCinemas=d;var e=-1,g=0;for(var h in d){var i=d[h],j=_.find(b,function(a){return a.p_cinema_id==i.p_cinema_id});"undefined"==typeof j&&(e+=1,b.push({p_cinema_id:i.p_cinema_id,p_cinema_name:i.p_cinema_name,p_cinema_logo:i.cinema_logo,number:g++,cinemas:[]}));var k={cinema_id:i.cinema_id,cinema_name:i.cinema_name,cinema_image:i.cinema_image,cinema_address:i.cinema_address,cinema_slug:i.cinema_slug,cinema_latitude:i.cinema_latitude,cinema_longitude:i.cinema_longitude,cinema_name_s1:i.cinema_name_s1,cinema_name_s2:i.cinema_name_s2};b[e].cinemas.push(k),parseInt(h)+1===d.length&&(a.listPCinemas=b,f.localStorage.setItem("listPCinemas",JSON.stringify(b)))}})}}function j(){e.get(c,{url:"/promotions",keyCache:"no-cache"},function(a){if(a.data.hasOwnProperty("error")||200!==a.status||1!==a.data.status||null===a.data.result)console.error(a.data.error);else{var b=moment().day();for(var c in a.data.result){var d=a.data.result[c];for(var e in d)e==b&&(d[e].length>0?(d[e][0].p_cinema_id=c,m[c]=d[e][0]):m[c]=!1)}}setTimeout(function(){for(var a in m)k(m[a])},100)},function(a){console.log("error")})}function k(a){var b=document.getElementsByClassName("js-promo-tooltip-"+a.p_cinema_id)[0];a.desc;if(b){var c='<div class="tooltip-content"><div class="tooltip-title">'+a.name+'</div><ul class="tooltip-list">';for(var d in a.desc)c+="<li>"+a.desc[d]+"</li>";c+="</ul></div>",b.innerHTML=c;var e=b.parentNode,f=e.getElementsByClassName("promo-info")[0],g=e.getElementsByClassName("pcinema-promo")[0];f&&(f.style.width=g.clientWidth+"px")}}b.isLoadingTrailer=!1;var l,m={};h(),b.$on("$destroy",function(){$("#footer").show()}),b.setIconExpaned=function(a,c){if(l===a)return b.isExpaned=void 0,void(l=void 0);b.isExpaned=a,l=a;var d=c.target.dataset;g(function(){navigator.userAgent.match(/(iPhone|iPad)/)?window.scrollTo(0,80*d.number):$("html,body").animate({scrollTop:80*d.number},"100")},200)},b.goToCinemaDetail=function(c,e){a.isMobile||$("#headMenu .active").removeClass("active"),a.isMobile&&(b.isLoadingTrailer=!0),a.sendGA("Cinema","Go To Cinema Detail",e),d.go("main.detailCinema",{slug:c})},b.showPromo=function(a){var b="";return m[a]&&(b=m[a].short_name),b},b.showPromoTooltip=function(a,b){a.stopPropagation()}}])}(),function(){angular.module("TIX").controller("CinemaDetailController",["$scope","$rootScope","$http","$state","APIService","$sce","ParseUrl","Upload","$q","$window","$timeout","ngMeta","$cookies",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){r(X),p(X)}function o(a){var b=a.session_time.split(/[- :]/);return new Date(b[0],b[1]-1,b[2],b[3],b[4],b[5])>new Date}function p(d){var f={cinema_id:d,film_id:-1,start_date:a.today,end_date:b.sessionEndDate};e.get(c,{url:"/session/cinema"+Common.mergeQueryString(f),keyCache:"no-cache"},function(b){if(1===b.data.status){a.sessionCinema=b.data.result;var c=a.isEmptySession(a.selectedDate);c?a.emptySession=!0:a.emptySession=!1}},function(a){console.log(a)})}function q(){a.listCinemasInPCinema=a.cinema.list_cinemas;var b={};for(var c in a.listCinemasInPCinema)a.listCinemasInPCinema[c].cinema_id==a.cinema.cinema_id&&(b=a.listCinemasInPCinema[c],a.listCinemasInPCinema.splice(c,1));a.listCinemasInPCinema.unshift(b)}function r(b){e.get(c,{url:"/cinema/detail?cinema_id="+b,keyCache:"cinema-detail"+b},function(b){D=b.data.result,a.cinema=b.data.result,q(),a.cinema_image_poster=D.cinema_image_poster,a.cinema_image_large=D.cinema_image_large,a.total_rate=D.total_rate,a.cinema_name=D.cinema_name,a.cinema_address=D.cinema_address,a.cinema_phone=D.cinema_phone,a.cinema_email=D.cinema_email,a.room_info=D.room_info,a.avg_point=D.avg_point,a.content_short=D.content_short,a.circlePercent=10*D.avg_point,a.cinema_description=D.cinema_description,a.opening_closing_time=D.opening_closing_time,a.showing_date=D.showing_date,l.init(),l.setDefaultTag("title",a.cinema.cinema_name),s()},function(a){console.log(a)})}function s(){k(function(){$(".logo-loading").css("opacity",0),k(function(){a.isLoadingFirst=!1;
},500)},500)}function t(d){var f={cinema_id:d,offset:H},g=Common.mergeQueryString(f);e.get(c,{url:"/cinema/comment"+g,keyCache:"cinema-detail-comment"+g},function(d){if(1==d.data.status&&!_.isEmpty(d.data.result)){for(var f=d.data.result.comments?d.data.result.comments:[],g=0;g<f.length;g++)f[g].total_chilren_comment||(f[g].total_chilren_comment=0);if(a.cinemaComments=a.cinemaComments.concat(f),void 0!=b.user.user_id&&f.length>0){var h=_.pluck(f,"comment_id"),i={user_id:b.user.user_id,object_type:31,object_ids:h};e.post(c,{url:"/comment/like",keyCache:"no-cache"},i,function(b){if(1===b.data.status&&void 0!=b.data.result){for(var c in b.data.result)a.commentLike[c]=b.data.result[c];var d;for(var c in a.cinemaComments)d=a.commentLike[a.cinemaComments[c].comment_id],a.cinemaComments[c].user_like=1==d?1:0,d=a.commentLike[a.cinemaComments[c].comment_id+"_sum"],void 0!=d&&(a.cinemaComments[c].up_vote=d)}},function(a){console.log(a)})}}},function(a){console.log("error")})}function u(a){return i(function(b,d){var e=new FileReader;e.readAsDataURL(a),e.onload=function(){var f={};f.data=e.result,f.name=a.name,f.size=a.size,h.post(c,f,function(a){b(a)},function(a){d(a)})}})}function v(b){var c="https://www.youtube.com/embed/",d="autoplay=1";a.trailerUrl=f.trustAsResourceUrl(c+b+"?"+d),$("#modalTrailer").modal("show"),a.$evalAsync()}function w(){document.body.scrollTop>20||document.documentElement.scrollTop>20?$("#btnScrollTop").addClass("active"):$("#btnScrollTop").removeClass("active")}function x(){return J=localStorage.getItem("email"),(angular.isUndefined(J)||null===J)&&angular.isDefined(b.user)&&null!==b.user&&(J=b.user.email),J}function y(){return K=localStorage.getItem("phone"),(angular.isUndefined(K)||null===K)&&angular.isDefined(b.user)&&null!==b.user&&(K=b.user.phone),K}function z(){localStorage.setItem("email",b.userEmail)}function A(){localStorage.setItem("phone",b.userPhone)}var B,C,D={},E=14;a.activeClass=function(a,b){return 0==a?b:""},$(document).ready(function(){a.currentUrl=window.location.href;var b=localStorage.getItem("off-lotte-notice");a.isOffModalLotteNotice=null==b?!1:"true"==b}),a.showChar=285,a.cinemaId=g.byId(d.params.slug),a.cinema={},a.cinemasSessions=[],a.listCinemasInPCinema=[],a.cinema_image_large="app/assets/img/default-trailer.webp",a.cinema_image_poster="app/assets/img/default-film.webp",a.showCurrentNews=3,a.cinemaComments=[],a.showCurrentComment=5,a.selectedDate=moment().format("YYYYMMDD"),a.showAlertApproving=!1,a.isLoadingFirst=!0,b.isCinemaDetail=!0,a.sessionCinema={},a.emptySession=!1,a.listDay=[];var F={desktop:["Chủ Nhật","Thứ 2","Thứ 3","Thứ 4","Thứ 5","Thứ 6","Thứ 7"],mobile:["CN","T2","T3","T4","T5","T6","T7"]};a.spacepoint=0,a.roompoint=0,a.pricingpoint=0,a.servicepoint=0,a.otherpoint=0,b.isHomePage=!1,a.media_id=".",a.today=moment().format("YYYY-MM-DD"),b.sessionEndDate=moment().add("days",E).format("YYYY-MM-DD");var G=!1,H=0;a.row1="Ngay phat hanh",b.isMobileResponsive=!1;var I=(new google.maps.InfoWindow,!1);a.errorComment="",a.commentLike=[],b.isEmailValid=!1,b.isPhoneValid=!1,b.isShowClearEmail=!1,b.isShowClearPhone=!1,a.phoneErrorMsg="",a.emailErrorMsg="",a.isShowModalOverTime=!1;var J,K,L="Email không được bỏ trống. ",M="Email không đúng định dạng. ",N="Phone không được bỏ trống. ",O="Phone chỉ được chứa số. ",P=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,Q=/^[0-9-+]+$/,R=20,S={keyVersion:"",sessionId:""};a.isShowModalNotBooking=!1,a.isShowModalOtherCinema=!1,a.isShowModalLotteNotice=!1,a.isShowModalAgeRestrict=!1,b.isShowModalLotteGuide=!1,a.goToCheckout=function(c,e,f,g,h,i){if(o(h)){if(b.sendGA("Payment","Click Session Film",e.film_name),!Common.isBooking(g)||3==g&&0==b.user.is_allow_cgv)_.isNull(f)||_.isUndefined(f)?a.isShowModalNotBooking=!0:(a.isShowModalOtherCinema=!0,a.currentUrlOtherCinema=f);else if(Common.isBooking(g))if(b.user.user_id)if(1!=g||a.isOffModalLotteNotice){b.passVersion(i,c),localStorage.setItem("favorite-cinema",g);var j=d.href("checkout.index",{sessionId:c});window.open(j,"_blank")}else S.keyVersion=i,S.sessionId=c,a.isShowModalLotteNotice=!0,localStorage.setItem("favorite-cinema",g);else b.goToLogin()}else a.isShowModalOverTime=!0},a.goToOtherCinema=function(){window.open(a.currentUrlOtherCinema,"_blank")},a.closeModalNotBooking=function(){a.isShowModalNotBooking=!1},a.closeModalOtherCinema=function(){a.isShowModalOtherCinema=!1},a.closeModalOverTime=function(){a.isShowModalOverTime=!1},a.closeLotteNotice=function(){a.isShowModalLotteNotice=!1},a.acceptLotteNotice=function(){a.isShowModalLotteNotice=!1,a.isOffModalLotteNotice=document.getElementById("off-lotte-notice").checked,localStorage.setItem("off-lotte-notice",a.isOffModalLotteNotice),a.goForwardCheckout()},a.openLotteGuide=function(){b.isShowModalLotteGuide=!0},a.goForwardCheckout=function(){if(S&&S.keyVersion&&S.sessionId){b.passVersion(S.keyVersion,S.sessionId);var a=d.href("checkout.index",{sessionId:S.sessionId});window.open(a,"_blank")}},a.goToDetailPromotion=function(c,e,f,g){c.preventDefault(),b.isMobile&&(a.isLoadingFirst=!0),b.sendGA("News","Promotions",g),d.go("main.detailPromotions",{slug:e,tab:f})},a.goToCinemaDetail=function(a,c){b.sendGA("Cinema","Go To Cinema Detail",c),d.go("main.detailCinema",{slug:a})};for(var T=0;E>T;T++){var U=b.isMobile?"mobile":"desktop",V=moment().day()+T;V>=7&&(V-=7*Math.floor(V/7));var W={dayOfWeek:F[U][V],day:moment().add("days",T).format("DD"),date:moment().add("days",T).format("YYYYMMDD")};a.listDay.push(W)}a.chooseDate=function(b){a.selectedDate=b;var c=a.isEmptySession(a.selectedDate);c?a.emptySession=!0:a.emptySession=!1,setTimeout(function(){B=$(".blockNavigation").outerHeight(),C=B-$("#datePanel .DayOfWeek").outerHeight()-1,$("#listSessions").css("max-height",C)},500)},a.getCinemaDetail=function(b){return _.find(a.listCinemasInPCinema,function(a){return a.cinema_id===b})};var X=g.byId(d.params.slug);n(),$("#overlay-book").hide(),a.closeCommentBox=function(){$("#overlay-book").hide(),$("#overlay-book .error").text(""),$(document.body).css("overflow-y","auto")},a.openCommentBox=function(){if(b.isLoggedIn){$(document.body).css("overflow-y","hidden"),$("#overlay-book").show(),a.spacepoint="2.5",a.roompoint="2.5",a.pricingpoint="2.5",a.servicepoint="2.5",a.otherpoint="2.5";var c=x(),d=y();$("#emailComment").val(c),a.editEmail(c),$("#phoneComment").val(d),a.editPhone(d)}else b.isHideUserNotSignIn=!1},$("#overlay-trailer").hide(),a.closeTrailerBox=function(){document.getElementById("imgInfoDetailModal").src="",$("#overlay-trailer").hide(),$("body").css("overflow","auto")},$(document).ready(function(){$("#show").click(function(){$("p").show()}),$(this).scrollTop(0);var a=$(window);a.width()<480&&(b.isMobileResponsive=!0),a.resize(function(){a.width()<480?b.isMobileResponsive=!0:b.isMobileResponsive=!1})}),a.isEmptySession=function(b){return"undefined"==typeof a.sessionCinema[b]?!0:!1},b.getSessionDay=function(a){if(a){var b=a.split(" ")[1].split(":");return b[0]+":"+b[1]}return""},a.removeAge=function(a){var b=a.indexOf("("),c=-1!=b?a.slice(0,b):a;return c},a.viewMoreNews=function(){a.showCurrentNews<a.cinema.news.length&&(a.showCurrentNews+=3,a.showCurrentNews>=a.cinema.news.length&&$("#btnNewsRelated").hide())},a.showingInfo=function(){G||($(".slick-next").click(),setTimeout(function(){$(".slick-prev").click()},500),G=!0)},$("#imgInfoDetail").hide(),$(document).on("click","#imgSlick",function(){var b=$(this),c=b.data("class"),d=b.data("index");document.getElementById("imgInfoDetail").src="","trailer"==c?(a.youtube_id=D.list_image_thumbnail[d].youtube_id,a.imgInfoDetail=D.list_image_thumbnail[d].thumbnail,$(window).width()>480?($("#imgInfoDetail").hide(),$("#slickPlayYoutube").show()):($("body").css("overflow","hidden"),$("#slickPlayYoutubeModal").show(),$("#slickPlayYoutube").hide(),$("#overlay-trailer").show())):(a.imgInfoDetail=D.list_image_view[d],$(window).width()>480?($("#imgInfoDetail").hide(),$("#slickPlayYoutube").hide()):($("body").css("overflow","hidden"),$("#imgInfoDetailModal").hide(),$("#slickPlayYoutube").hide(),$("#slickPlayYoutubeModal").hide(),$("#overlay-trailer").show())),a.$evalAsync()}),a.playTrailerSlick=function(){var b="https://www.youtube.com/embed/",c="autoplay=1";$(window).width()>480?(document.getElementById("imgInfoDetail").src=f.trustAsResourceUrl(b+a.youtube_id+"?"+c),$("#imgInfoDetail").show(),$("#slickPlayYoutube").hide()):(document.getElementById("imgInfoDetailMobile").src=f.trustAsResourceUrl(b+a.youtube_id+"?"+c),$("#imgInfoDetailMobile").show(),$("#slickPlayYoutubeMobile").hide())},a.playTrailerSlickModal=function(){var b="https://www.youtube.com/embed/",c="autoplay=1";document.getElementById("imgInfoDetailModal").src=f.trustAsResourceUrl(b+a.youtube_id+"?"+c),$("#imgInfoDetailModal").show(),$("#slickPlayYoutubeModal").hide()},a.buildKeyCache=function(){var a={cinema_id:g.byId(d.params.slug)};return"cinema-detail-comment"+Common.mergeQueryString(a)},a.viewMoreComment=function(){if(a.showCurrentComment<a.cinemaComments.length){a.showCurrentComment+=5;var b="dataIndex"+(a.showCurrentComment-5);setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b).offset().top-85},"slow")},200),a.showCurrentComment%R==0&&(H+=R,t(X))}},$(document).on("click",".tabcinema",function(a){$(this).find(".arrow").css({"-ms-transform":"rotate(90deg)","-webkit-transform":"rotate(90deg)",transform:"rotate(90deg)"})}),a.starRated=function(b){var c;switch(b){case 1:c=2*a.spacepoint,1==c.toString().length&&(c+=".0"),$("#spacepoint").text(c);break;case 2:c=2*a.roompoint,1==c.toString().length&&(c+=".0"),$("#roompoint").text(c);break;case 3:c=2*a.pricingpoint,1==c.toString().length&&(c+=".0"),$("#pricingpoint").text(c);break;case 4:c=2*a.servicepoint,1==c.toString().length&&(c+=".0"),$("#servicepoint").text(c);break;default:c=2*a.otherpoint,1==c.toString().length&&(c+=".0"),$("#otherpoint").text(c)}},a.Upload=function(){$("#Upload").click()},$("#Upload").change(function(){if(a.errorComment="",this.files.length>5)return void(a.errorComment="Bạn chỉ được chọn tối đa 5 ảnh");listfile=this.files,$(".review-images").text("");for(var b=0;b<listfile.length;b++)a.readURL(listfile,b)}),a.readURL=function(a,b){if(a&&a[b]){var c=new FileReader;c.onload=function(a){$(".review-images").append("<div class='review-image' style='background-image: url("+a.target.result+")'><img class='closereview' src='app/assets/img/icons/close_black.png'> </div>")},c.readAsDataURL(a[b])}},$(document).on("click",".closereview",function(a){$(this).parent().remove()}),a.submitCommentBox=function(){if("undefined"!=typeof listfile&&listfile.length>0){for(var b=[],c=0;c<listfile.length;c++)b.push(u(listfile[c]));i.all(b).then(function(b){var c=[];for(var d in b)c.push(b[d].data.result);$(".review-images").empty(),a.postComment(c)})}else{var d=[];a.postComment(d)}},a.postComment=function(d){var f=$("#overlay-book .inputComment").val(),g=$("#overlay-book #spacepoint").text(),h=$("#overlay-book #roompoint").text(),i=$("#overlay-book #pricingpoint").text(),j=$("#overlay-book #servicepoint").text(),l=$("#overlay-book #otherpoint").text(),m=b.user.user_id,n=(b.user.fullname,b.user.avatar,b.userPhone),o=b.userEmail;if(""===f)return void(a.errorComment="Hãy cho TIX biết suy nghĩ của bạn. ");if(""===n||""===o)return void(a.errorComment="");var p={user_id:m,cinema_id:a.cinema.cinema_id,space_point:parseInt(g),room_point:parseInt(h),pricing_point:parseInt(i),service_point:parseInt(j),other_point:parseInt(l),comment:f,phone:n,email:o,list_image:d};e.post(c,{url:"/comment/list",keyCache:"no-cache"},p,function(c){c.data.hasOwnProperty("error")?(45===c.data.error.code||-1===c.data.error.code)&&(b.isHideUserTokenExpired=!1):200===c.status&&1===c.data.status&&""!==c.data.result&&($("#overlay-book .inputComment").val(""),a.showAlertApproving=!0,k(function(){a.showAlertApproving=!1},5e3),b.sendGA("Cinema","Send Comment Cinema",f),z(),A())},function(a){console.log(a)}),a.closeCommentBox()},a.playTrailerPoster=function(){v(a.media_id)},a.closeTrailer=function(){a.trailerUrl="",a.$evalAsync(),a.trailerUrl="",a.$evalAsync()},$("#modalTrailer").click(function(){$("#modalTrailer").modal("hide")}),a.buyTicket=function(){$(".navCenter").children().eq(0).find("a").trigger("click"),$("html,body").animate({scrollTop:$(".navCenter").offset().top},"slow")},window.onscroll=function(){w()},a.topFunction=function(){return $("html, body").animate({scrollTop:0},600),!1},a.setHeightSessionTab=function(){b.isMobile||setTimeout(function(){B=$(".blockNavigation").outerHeight(),C=B-$("#datePanel .DayOfWeek").outerHeight()-1,$("#listSessions").css("max-height",C)},1e3)},a.initLoadCommentCinema=function(){I||(I=!0,t(X))},a.editEmail=function(c){b.userEmail=c,a.emailErrorMsg="",""===c||void 0===c?(b.isShowClearEmail=!1,b.isEmailValid=!1,a.emailErrorMsg=L):c.match(P)?(b.isEmailValid=!0,b.isShowClearEmail=!0):(b.isEmailValid=!1,a.emailErrorMsg=M,b.isShowClearEmail=!0),b.sendGA("Cinema Comment","Change Email",c)},a.editPhone=function(c){b.userPhone=c,a.phoneErrorMsg="",""===c||void 0===c?(b.isShowClearPhone=!1,b.isPhoneValid=!1,a.phoneErrorMsg=N):c.match(Q)?(b.isPhoneValid=!0,b.isShowClearPhone=!0):(b.isPhoneValid=!1,a.phoneErrorMsg=O,b.isShowClearPhone=!0),b.sendGA("Cinema Comment","Change Phone",c)},a.clearEmail=function(){var c=$("#emailComment");b.userEmail="",c.val(""),c.trigger("input"),c.trigger("change"),b.isShowClearEmail=!1,b.isEmailValid=!1,a.emailErrorMsg=L},a.clearPhone=function(){var c=$("#phoneComment");b.userPhone="",c.val(""),c.trigger("input"),c.trigger("change"),b.isShowClearPhone=!1,b.isPhoneValid=!1,a.phoneErrorMsg=N},a.getSubComment=function(b,c){for(var d=a.showChar;;){if(" "==b[d])break;d-=1}return 1===c?b.substr(0,d):2===c?b.substr(d+1,b.length):""},a.onClickViewMoreCmt=function(b){var c="isOpen"+b,d=$(".smallbox_"+b).html();"Thu gọn"===d?($(".smallbox_"+b).html("Xem thêm"),a[c]=!1):($(".smallbox_"+b).html("Thu gọn"),a[c]=!0)}}])}(),function(){angular.module("TIX").controller("DeactiveController",["$rootScope","$scope","$http","$state","$location","$window","APIService","$cookies",function(a,b,c,d,e,f,g,h){function i(){var c=moment(a.user.date_add,"YYYY-MM-DD HH:mm:ss").isBefore("2019-06-01");a.isLoggedIn&&(j(),c||(b.isAllowedDeactivate=!1)),a.isLoading=!1}function j(){g.get(c,{url:"/user/points?user_hash="+a.user.user_hash,keyCache:"no-cache"},function(b){_.isEmpty(b.data)||b.data.hasOwnProperty("error")?(console.log(b),alert(b.data.error.message),d.go("main.home",{})):(a.user.tix_point=b.data.result.tix_point,localStorage.setItem("user",JSON.stringify(a.user)))})}b.isAllowedDeactivate=!0,b.isOpenDeactiveModal=!1,b.isOpenSuccessModal=!1,b.isOpenFailModal=!1,a.redirectUrlLogin="main.deactive1",a.redirectParams={},a.isLoading=!0,i(),b.backToHomepage=function(b){angular.isUndefined(b)&&(b=0),a.isLoading=!0,document.body.style.overflowY="auto",1==b&&a.logout(0),a.redirectUrlLogin="",d.go("main.home",{})},b.openDeactiveModal=function(){b.isOpenDeactiveModal=!0,document.body.style.overflowY="hidden",$(window).scrollTop(0)},b.deactivate=function(){a.isLoading=!0;var d={user_hash:a.user.user_hash};g.post(c,{url:"/user/deactivate",keyCache:"no-cache"},d,function(c){200!=c.status&&(alert("Chức năng này không còn được hỗ trợ"),b.backToHomepage(0)),c.data&&1==c.data.result?b.isOpenSuccessModal=!0:b.isOpenFailModal=!0,b.isOpenDeactiveModal=!1,setTimeout(function(){a.isLoading=!1,a.$evalAsync()},1e3)},function(a){501==a.status&&(alert("Chức năng này không còn được hỗ trợ"),b.backToHomepage(0))})},b.closeDeactiveModal=function(){b.isOpenDeactiveModal=!1,document.body.style.overflowY="auto"},b.closeSuccessModal=function(){b.isOpenSuccessModal=!1,document.body.style.overflowY="auto",a.logout(1)},b.closeFailModal=function(){b.isOpenFailModal=!1,document.body.style.overflowY="auto"}}])}(),function(){angular.module("TIX").controller("FooterController",["$scope","$http","$state",function(a,b,c){}])}(),function(){angular.module("TIX").controller("TermController",["$scope","$http","$state",function(a,b,c){for(var d=document.getElementsByClassName("sidebar-section"),e=function(a){a.preventDefault();var b=this.href.split("#")[1],c=document.getElementById(b);$(window).scrollTop(c.offsetTop-10)},f=0;f<d.length;f++)d[f].addEventListener("click",e),d[f].addEventListener("touch",e)}])}(),function(){angular.module("TIX").controller("HeaderController",["$rootScope","$scope","$http","$state","$location","$window","APIService","APIServiceV2","$cookies",function(a,b,c,d,e,f,g,h,i){function j(){if(a.user.user_id){if("undefined"!=typeof a.user.expire_time){var b=moment().isBefore(moment(a.user.expire_time,"YYYYMMDDHHmmss"));if(b)return}a.user.expire_time=moment().add(15,"m").format("YYYYMMDDHHmmss");var d="&userId="+a.user.user_id+"&configName=cgv";h.get(c,{url:"/api/config?debug=dev"+d,keyCache:"no-cache"},function(b){var c=!1;0==b.data.code&&(c="true"==b.data.data),c?a.user.is_allow_cgv=1:a.user.is_allow_cgv=0,localStorage.setItem("user",JSON.stringify(a.user))},function(b){a.user.is_allow_cgv=0,localStorage.setItem("user",JSON.stringify(a.user))})}}function k(b){a.isLoggedIn=!1,localStorage.removeItem("user"),a.user={},1==a.newLogin?h.post(c,{url:"/api/profile/logout",keyCache:"no-cache"},function(c){0==c.data.code?(a.sendGA("Profile","LogoutV2 "+a.user.login_type,"Success"),0!=b&&($(document.body).css("overflow-y","auto"),d.reload())):0!=b&&($(document.body).css("overflow-y","auto"),d.reload())},function(a){0!=b&&($(document.body).css("overflow-y","auto"),d.reload())}):(a.sendGA("Profile","Logout "+a.user.login_type,"Success"),0!=b&&($(document.body).css("overflow-y","auto"),d.reload()))}function l(){var a=localStorage.getItem("RegistrationEmail"),c=new Date(localStorage.getItem("FirstGoTIX")),d=new Date,e=Math.abs(d.getTime()-c.getTime()),f=864e5;if(angular.isUndefined(c)||null===c||(angular.isUndefined(a)||null===a)&&e>=f){var g=!1;if($(window).width()<=480?b.device="mobile":$(window).width()<=768?(b.device="ipad",window.innerHeight<=y&&(g=!0)):b.device="web",!g){b.isShowPopUpEmail=!0,localStorage.setItem("FirstGoTIX",new Date),x=m(1,w.length),b.templateCurrent=w[x-1],b.$evalAsync();var h=setInterval(function(){$("#PopUpEmail").length>0&&($("#PopUpEmail").css("opacity",1),clearInterval(h))},200)}}}function m(a,b){return Math.floor(Math.random()*b+a)}var n=[],o=$("#navbarHeader .menu"),p=($("#headMenu"),$("#sideMenu")),q=$("#sideMenu .close"),r=-1,s=!1,t=($("#wrapPCinemaMobile"),/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),u="Email không được bỏ trống",v="Email không đúng định dạng",w=[{banner:{web:"byeIQ-web.png",ipad:"byeIQ-ipad.png",mobile:"byeIQ-mobile.png"}}],x=0,y=414;a.isHideUserNotSignIn=!0,a.isHideUserTokenExpired=!0,b.labelMovie="Phim",b.listLocations=[],b.isShowPopUpEmail=!1,b.isPostSuccess=!1,b.emailErrorMsg="",b.emailSuccessMsg="",b.templateCurrent={},b.isLoadingEmail=!1,b.device="",b.isDebugPopUpEmail=!0,b.isHideTabBar=!1,b.isShowDownload="true"===localStorage.getItem("isShowDownload"),b.isShowDownload&&setTimeout(function(){$("#PopUpDownload").css("opacity",1)},3e3),j(),h.get(c,{url:"/api/data/location",keyCache:"no-cache"},function(a){var c={};if(a&&0==a.data.code){a=a.data.data;for(var d=0;d<a.length;d++)c[a[d].id-1]=a[d].cityName}else c[0]="Hồ Chí Minh";b.listLocations=c}),setTimeout(function(){l()},3e4),b.selectLocation=function(b){a.locationId=b-0+1,localStorage.setItem("locationId",a.locationId),a.sendGA("Profile","Change Location",a.locationId),"main.detailCinema"===d.current.name?f.location.href="/":(f.localStorage.removeItem("listPCinemas"),window.location.reload(!1))},a.logout=function(b){switch(angular.isUndefined(b)&&(b=!0),a.user.login_type){case"Gmail":gapi.auth2.getAuthInstance().signOut().then(function(){k(b)});break;default:k(b)}},b.Relogin=function(){a.isHideUserTokenExpired=!0,a.logout(!1),a.FBLogin()},b.closeRelogin=function(){a.isHideUserTokenExpired=!0},b.SignIn=function(){a.isHideUserNotSignIn=!0,a.FBLogin()},b.closeSignIn=function(){a.isHideUserNotSignIn=!0},b.hideCinema=function(){$("#wrapPCinemaMobile").removeClass("active")},o.on("click",function(b){b.stopPropagation(),b.preventDefault(),p.click();var c=$(this),e=c.data("scroll");"main.home"!==d.current.name&&d.go("main.home",{scr:e}),"homeCinemaComplex"===e&&(a.isMobile||$(window).width()<=480)||(s=!0,$.scrollTo("#"+e,500),o.removeClass("active"),c.addClass("active"),setTimeout(function(){s=!1},2e3))}),$(window).scroll(function(){if(s===!1){var a=$(this).scrollTop();$.each(n,function(b,c){a>this-70?(b!=r&&b>r&&(o.removeClass("active"),o.eq(b).addClass("active")),r=b):a<parseInt(n[1])-70&&(o.removeClass("active"),o.eq(0).addClass("active"))})}}),p.on("click",function(a){a.stopPropagation(),a.preventDefault(),p.removeClass("active"),$("body").css({overflow:"auto"})}),$(".wrapMenuMobile").on("click",function(a){a.stopPropagation()}),q.on("click",function(){p.click()}),b.onClickBackMobile=function(){"main.cinemaMobile"===d.current.name?d.go("main.home"):a.isCinemaDetail?d.go("main.cinemaMobile"):d.go("main.home")},$(".rightmobile").click(function(a){a.stopPropagation(),a.preventDefault(),p.toggleClass("active"),p.hasClass("active")?$("body").css({overflow:"hidden"}):$("body").css({overflow:"auto"})}),b.onClickMainLogo=function(){a.sendGA("Home","Back to Home","Header"),a.isMobile?"main.home"!==d.current.name?d.go("main.home"):document.location.href="/":window.scrollTo(0,0)},b.openSelectLocation=function(){$("#modalLocationMobile").addClass("in"),$("#modalLocationMobile").css("display","block")},b.closeLocation=function(){$("#modalLocationMobile").removeClass("in"),$("#modalLocationMobile").css("display","none")},b.limitPostEmail=function(a){b.isLoadingEmail||b.PostEmail(a)},b.PostEmail=function(d){b.isLoadingEmail=!0;var e={email:d,template_id:x,user_id:a.user.user_id};angular.isUndefined(d)||""===d?(b.isEmailValid=!1,b.emailErrorMsg=u):d.match(t)?b.isEmailValid=!0:(b.isEmailValid=!1,b.emailErrorMsg=v),b.isEmailValid?g.post(c,{url:"/registration-email/register",keyCache:"no-cache"},e,function(a){var c=a.data;c.hasOwnProperty("error")?(b.isEmailValid=!1,b.emailErrorMsg=c.error.message):c.result&&(b.closeEmail(),localStorage.setItem("RegistrationEmail",!0)),b.isLoadingEmail=!1}):b.isLoadingEmail=!1},b.closeEmail=function(){$("#PopUpEmail").css("opacity",0),setTimeout(function(){b.isShowPopUpEmail=!1,b.$evalAsync()},500)},b.download=function(){localStorage.setItem("isShowDownload",!1),b.isShowDownload=!1,d.go("app.index1")},b.closeDownload=function(){$("#PopUpDownload").css("opacity",0),setTimeout(function(){localStorage.setItem("isShowDownload",!1),b.isShowDownload=!1,b.$evalAsync()},500)},$(window).bind("mousewheel",function(a){a.originalEvent.wheelDelta>=0&&l()}),b.$watch(function(){return d.current.name},function(a,c){"main.deactive1"==a||"main.deactive2"==a?b.isHideTabBar=!0:b.isHideTabBar=!1})}])}(),function(){angular.module("TIX").controller("LoginController",["$rootScope","$scope","$http","$state","$location","$window","APIService","APIServiceV2","$cookies",function(a,b,c,d,e,f,g,h,i){function j(){if(!a.isLoggedIn){var b=m();if(b.code)if(0==a.newLogin){var c={type_desc:"Zalo",type:q,oauth_provider:r,oauth_access_token:b.code};b.state&&""!=b.state&&(a.redirectUrlLogin=b.state),b.uid?c.oauth_user_id=b.uid:Zalo.getLoginStatus(function(a){"connected"===a.status&&Zalo.api("/me","GET",{fields:"id"},function(a){c.oauth_user_id=a.id,k(c)})})}else{var c={channel:2,socialCode:b.code};b.state&&""!=b.state&&(a.redirectUrlLogin=b.state),"undefined"==typeof b.uid?Zalo.getLoginStatus(function(a){"connected"===a.status&&Zalo.api("/me","GET",{fields:"id"},function(a){c.socialId=a.id})}):c.socialId=b.uid,o(c)}}}function k(b){g.post(c,{url:"/auth/login",keyCache:"no-cache"},b,function(c){if(_.isEmpty(c.data)||c.data.hasOwnProperty("error"))console.log(c),alert(c.data.error.message),d.go("main.home",{});else{var e=c.data.result;e.login_type=b.type_desc,a.isLoggedIn=!0,g.setUser(e.user_token,e.user_id),h.setUser(e.user_token,e.user_id),a.sendGA("Profile","Login "+(b.type_desc?b.type_desc:""),"Success"),l(e)}})}function l(b){g.get(c,{url:"/user/profile?user_hash="+b.user_hash,keyCache:"no-cache"},function(c){var e=i.get("redirectParams");if(e=atob(e),e=JSON.parse(e),_.isEmpty(c.data)||c.data.hasOwnProperty("error"))console.log(c),alert(c.data.error.message),d.go("main.home",{});else{a.user=c.data.result;for(var f in b)a.user[f]=b[f];"Facebook"==a.user.login_type&&(a.user.avatar="https://graph.facebook.com/"+a.user.facebook_id+"/picture?type=square"),a.user.is_admin=1==c.data.result.is_admin?1:0,localStorage.setItem("user",JSON.stringify(a.user)),$(window).scrollTop(0),_.isUndefined(a.redirectParams)&&(_.isUndefined(e)?a.redirectParams={}:a.redirectParams=e),(_.isUndefined(a.redirectUrlLogin)||""==a.redirectUrlLogin)&&(a.redirectUrlLogin="main.home"),d.go(a.redirectUrlLogin,a.redirectParams,{reload:!0})}a.isLoading=!1})}function m(){var a,b,c={};a=window.location.search.substring(1),b=a.split("&");for(var d=0;d<b.length;d++){var e=b[d].split("=");c[decodeURIComponent(e[0])]=decodeURIComponent(e[1]||"")}return c}function n(){gapi.signin2.render("gSignIn",{onsuccess:function(a){onSignInGG(a)},onerror:function(a){console.log("Google signIn2.render button err: "+a)}})}function o(b){h.post(c,{url:"/api/profile/login",keyCache:"no-cache"},b,function(c){if(_.isEmpty(c.data)||0!=c.data.code)console.log(c),_.isEmpty(c.data)?alert("Có lỗi xảy ra. Vui lòng thử lại sau"):alert(c.data.msg),d.go("main.home",{});else{var e=c.data.data;a.isLoggedIn=!0,g.setUser(e.sid,e.uid),h.setUser(e.sid,e.uid),a.sendGA("Profile","LoginV2 "+(b.type_desc?b.type_desc:""),"Success"),p(e)}})}function p(b){h.get(c,{url:"/api/profile",keyCache:"no-cache"},function(c){var e=i.get("redirectParams");if(e=atob(e),e=JSON.parse(e),_.isEmpty(c.data)||0!=c.data.code)console.log(c),_.isEmpty(c.data)?alert("Có lỗi xảy ra. Vui lòng thử lại sau"):alert(c.data.msg),d.go("main.home",{});else{var f=c.data.data;switch(1==f.channel&&(f.avatar="https://graph.facebook.com/"+f.socialId+"/picture?type=square"),a.user={fullname:f.displayName,email:f.email,phone:f.phone,birthday:f.birthday,facebook_id:"",gmail_id:"",zalo_id:"",gender:f.gender,avatar:f.avatar,user_id:f.userId,user_token:b.sid,user_hash:b.userHash,is_admin:0,channel:f.channel,socialId:f.socialId},f.channel){case 1:a.user.login_type="Facebook",a.user.facebook_id=f.socialId;break;case 4:a.user.login_type="Gmail",a.user.gmail_id=f.socialId;break;case 2:case 5:a.user.login_type="Zalo",a.user.zalo_id=f.socialId}localStorage.setItem("user",JSON.stringify(a.user)),$(window).scrollTop(0),_.isUndefined(a.redirectParams)&&(_.isUndefined(e)?a.redirectParams={}:a.redirectParams=e),(_.isUndefined(a.redirectUrlLogin)||""==a.redirectUrlLogin)&&(a.redirectUrlLogin="main.home"),d.go(a.redirectUrlLogin,a.redirectParams,{reload:!0})}a.isLoading=!1})}const q="OA",r="ZL",s="GO",t="FB",u="https://123phim.zalopay.vn/login";b.signInGG=function(a){$("#gSignIn .abcRioButton").click()},window.onSignInGG=function(b){if(!a.isLoggedIn){var c=b.getBasicProfile(),d=b.getAuthResponse().id_token;if(1==a.newLogin){var e={channel:4,socialId:c.getId(),socialCode:d};o(e)}else{var e={type_desc:"Gmail",type:q,oauth_provider:s,oauth_user_id:c.getId(),oauth_access_token:d};k(e)}}},window.onload=function(){a.isLoggedIn&&d.go("main.home",{}),$("#mainContent").removeClass("checkout"),Zalo.init({version:"2.0",appId:"714662308097449161",redirectUrl:u}),j(),n()},b.signInFB=function(b){FB.getLoginStatus(function(b){a.isLoggedIn||("connected"===b.status?FB.api("/me",{fields:"name, email, birthday, gender, picture"},function(c){if(1==a.newLogin){var d={channel:1,socialId:b.authResponse.userID,socialCode:b.authResponse.accessToken};o(d)}else{var d={type_desc:"Facebook",type:q,oauth_provider:t,oauth_user_id:b.authResponse.userID,oauth_access_token:b.authResponse.accessToken};k(d)}}):FB.login(function(b){b.authResponse?FB.api("/me",{fields:"name, email, picture"},function(c){if(console.log(b),1==a.newLogin){var d={channel:1,socialId:b.authResponse.userID,socialCode:b.authResponse.accessToken};o(d)}else{var d={type_desc:"Facebook",type:q,oauth_provider:t,oauth_user_id:b.authResponse.userID,oauth_access_token:b.authResponse.accessToken};k(d)}}):console.log("Login FB fail")}))},!0)},b.signInZL=function(b){var c="714662308097449161",d=u,e=a.redirectUrlLogin?a.redirectUrlLogin:"main.home";location.href="https://oauth.zaloapp.com/v3/auth?app_id="+c+"&redirect_uri="+d+"&state="+e}}])}(),function(){angular.module("TIX").controller("LoginIndexController",["$rootScope","$scope","$http","$state","$location","$window","APIService","$cookies",function(a,b,c,d,e,f,g,h){function i(){a.isLoggedIn&&d.go("main.home",{}),b.isLoading=!1}i(),b.backToHomepage=function(b){angular.isUndefined(b)&&(b=0),a.isLoading=!0,document.body.style.overflowY="auto",1==b&&a.logout(0),a.redirectUrlLogin="",d.go("main.home",{})}}])}(),function(){angular.module("TIX").controller("AppHomeController",["$rootScope","$scope","$http","$state","APIService",function(a,b,c,d,e){var f=!0,g=0;localStorage.setItem("slide",g);var h=setInterval(function(){g=localStorage.getItem("slide"),f=1==g?!0:!1,f&&($("#sliderScreen").slick({dots:!0,autoplay:!0,autoplaySpeed:2e3,dots:!1,arrows:!1}),clearInterval(h))},1e3)}])}(),function(){angular.module("TIX").controller("MainController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){var b=a.session_time.split(/[- :]/);return new Date(b[0],b[1]-1,b[2],b[3],b[4],b[5])>new Date}function m(){A=localStorage.getItem("favorite-cinema");var a=localStorage.getItem("off-lotte-notice");b.isOffModalLotteNotice=null==a?!1:"true"==a,k.init(),k.setDefaultTag("title","TIX - Đặt Vé Nhanh Nhất / Trang chủ"),j(function(){$(".logo-loading").css("opacity",0),j(function(){b.isLoadingTrailer=!1},500)},1e3),g.get(c,{url:"/film/banner",keyCache:"home-banner"},function(a){b.homeBanner=a.data.result}),g.get(c,{url:"/banner/ads",keyCache:"no-cache"},function(a){b.bannerAds=a.data.result}),b.listShowingFilms=[],g.get(c,{url:"/film/list?status=2",keyCache:"showing-film"},function(a){if(1===a.data.status&&a.data.result.length>0){b.listShowingFilms=a.data.result;var c=moment();for(var d in b.listShowingFilms){var e=!1;b.listShowingFilms[d].publish_date&&(e=c.isBefore(moment(b.listShowingFilms[d].publish_date,"YYYY-MM-DD"))),b.listShowingFilms[d].is_ss=e&&1==b.listShowingFilms[d].has_session?1:0}}}),t(b.listNews.type,0,b.listNews.name);for(var d=0;7>d;d++){if(0==d)var e="Hôm nay";else if(1==d)var e="Ngày mai";else var e=Common.dayOfWeek[moment().add("days",d).day()];var f={apiDay:moment().add("days",d).format("YYYYMMDD"),friendlyDay:e,dayOfWeek:moment().add("days",d).day(),originDay:moment().add("days",d).format("YYYY-MM-DD")};b.listDate.push(f)}setTimeout(function(){u=i.byQueryString("scr"),"undefined"!=typeof u&&$("#navbarHeader .menu."+u).click()},2500),p()}function n(a,b){var c=b-8;return a>=c?c:n(a,c)}function o(){if(document.body.scrollTop>20||document.documentElement.scrollTop>20){if($("#btnScrollTop").addClass("active"),!a.isMobile){var b=$("#filmblock").height(),c=$("#cinemablock").height(),d=$("#newsblock").height(),e=($("#appblock").height(),$("#sliderTrailer").height()),f=e,g=f+b,h=g+c,i=h+d;document.body.scrollTop>f&&document.body.scrollTop<g?($("#headMenu .active").removeClass("active"),$("#headMenu").children().eq(0).addClass("active")):document.body.scrollTop>g&&document.body.scrollTop<h?($("#headMenu .active").removeClass("active"),$("#headMenu").children().eq(1).addClass("active")):document.body.scrollTop>h&&document.body.scrollTop<i?($("#headMenu .active").removeClass("active"),$("#headMenu").children().eq(2).addClass("active")):document.body.scrollTop>i?($("#headMenu .active").removeClass("active"),
$("#headMenu").children().eq(3).addClass("active")):$("#headMenu .active").removeClass("active")}}else $("#btnScrollTop").removeClass("active")}function p(){var d=[],e="undefined"!=typeof a.locationId?a.locationId:1;g.get(c,{url:"/cinema/list?location_id="+e,keyCache:"main-cinemas"+e},function(c){var e=c.data.result;e&&_.isEmpty(e)&&(b.isHideSession=!0),a.listCinemas=e,q();var f=-1,g=0;for(var i in e){var j,k=e[i],l=_.find(d,function(a){return a.p_cinema_id==k.p_cinema_id});"undefined"==typeof l?(f+=1,d.push({p_cinema_id:k.p_cinema_id,p_cinema_name:k.p_cinema_name,p_cinema_logo:k.p_cinema_logo,number:g++,cinemas:[],index:f}),j=f):j=l.index;var m={cinema_id:k.cinema_id,cinema_name:k.cinema_name,cinema_image:k.cinema_image,cinema_address:k.cinema_address,cinema_slug:k.cinema_slug,cinema_slug_new:k.cinema_slug_new,cinema_latitude:k.cinema_latitude,cinema_longitude:k.cinema_longitude,cinema_name_s1:k.cinema_name_s1,cinema_name_s2:k.cinema_name_s2};if(d[j].cinemas.push(m),parseInt(i)+1===e.length){if(angular.isDefined(A)&&null!==A){var n=[];angular.forEach(d,function(a){a.p_cinema_id==A?n.unshift(a):n.push(a)}),a.listPCinemas=n}else a.listPCinemas=d;h.localStorage.setItem("listPCinemas",JSON.stringify(a.listPCinemas))}}})}function q(){a.listCinemas.length>0&&(b.toolCinemas=a.listCinemas)}function r(){j(function(){if(a.isMobile)for(var c=3;c<b.listShowingFilms.length;c++)b.filmShowingMore.push(b.listShowingFilms[c]);else $("#nowShowingFilms").slick({slidesPerRow:4,rows:2})},100)}function s(){b.listUpComingFilms.length>0&&setTimeout(function(){a.isMobile||$("#upComingFilms").slick({slidesPerRow:4,rows:2})},100)}function t(d,e,f,h){angular.isUndefined(h)&&(h=null);var i={type_id:d,offset:e,count:8,is_hot:-1,p_cinema_id:0};g.get(c,{url:"/news/list"+Common.mergeQueryString(i),keyCache:"news"+Common.mergeQueryString(i)},function(e){if(0==e.data.result.length)return void(1===d?b.isShowMoreNews=!1:8===d?b.isShowMoreReview=!1:b.isShowMorePromotion=!1);for(var i in e.data.result)b[f].list.push(e.data.result[i]);if(void 0!=a.user.user_id){var j=_.pluck(e.data.result,"news_id"),k={user_id:a.user.user_id,object_type:1,object_ids:j};g.post(c,{url:"/comment/like",keyCache:"no-cache"},k,function(a){if(1===a.data.status&&void 0!=a.data.result){for(var c in a.data.result)b.userLike[c]=a.data.result[c];var d,e=b[f].list;for(var c in e)d=b.userLike[e[c].news_id],e[c].user_like=1==d?1:0,void 0!=d&&(e[c].up_vote=b.userLike[e[c].news_id+"_sum"])}},function(a){console.log(a)})}null!==h&&$(h.target).html("XEM THÊM"),b[f].currentOffset+=b[f].count,b[f].currentOffset>b[f].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[f].id+" .news:nth-child("+(b[f].currentOffset-b[f].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}a.listCinemas=[],a.listPCinemas=[],a.listSessionByCinema={},a.isHomePage=!0,b.listFilms=[],b.listDate=[],b.listUpComingFilms=[],b.listFilmByCinema=[],b.showTrailer=!1,b.loadedTrailer=!1,b.labelMovie="Phim",b.labelCinema="Rạp",b.labelDate="Ngày xem",b.labelSession="Suất chiếu",b.toolFilms=[],b.toolCinemas=[],b.buyNowData={filmId:"",cinemaId:"",sessionDay:"",sessionId:""},b.canBuyNowTool=!1,b.listSessions=[],b.listSessionByFilm={},b.filmShowingMore=[],b.isShowMoreFilms=!1,b.listFilmAndSession={},b.chosenCinemaId=0,b.showError=!1,b.isLoadingTrailer=!0,b.checkSessionCinema=[],b.homeBanner=[],b.mobileWidth=737,a.isCinemaDetail=!1,b.listNews={currentOffset:0,count:8,list:[],type:1,id:"showingNews",name:"listNews"},b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"},b.listPromotion={currentOffset:0,count:8,list:[],type:4,id:"showingPromotion",name:"listPromotion"},b.isChoseMovie=!1,b.isChoseCinema=!1,b.isChoseDate=!1,b.isShowMoreNews=!0,b.isShowMoreReview=!0,b.isShowMorePromotion=!0,b.userLike=[],b.isHideSession=!1,b.isShowModalOverTime=!1,b.bannerAds={banner_ads_cinema:[],banner_ads_news:[]};var u,v,w=!1,x=!1,y=!1,z=(window.location.pathname,new Date,[4,3,2,1]),A=16,B={keyVersion:"",sessionId:""};m(),b.goToHomeBannerPage=function(a){location.href=a},b.goToFilmsDetail=function(c,e,f,g){c.preventDefault(),a.isMobile||$("#headMenu .active").removeClass("active"),a.isMobile&&(b.isLoadingTrailer=!0),a.sendGA("Film","Go To Film Detail - "+g,f),d.go("main.detail",{slug:e})},b.goToCinemaDetail=function(c,d){a.isMobile||$("#headMenu .active").removeClass("active"),a.isMobile&&(b.isLoadingTrailer=!0),a.sendGA("Cinema","Go To Cinema Detail",d)},b.goToDetailNews=function(c,e,f,g){c.preventDefault(),a.isMobile||$("#headMenu .active").removeClass("active"),a.isMobile&&(b.isLoadingTrailer=!0),a.sendGA("News","Showing News",f),d.go("main.detailNews",{slug:e,tab:g})},b.goToDetailPromotion=function(c,e,f,g){c.preventDefault(),a.isMobile||$("#headMenu .active").removeClass("active"),a.isMobile&&(b.isLoadingTrailer=!0),a.sendGA("Promotion","Showing Promotion",f),d.go("main.detailPromotions",{slug:e,tab:g})},b.goToDetailReviews=function(c,e,f,g){c.preventDefault(),a.isMobile||$("#headMenu .active").removeClass("active"),a.isMobile&&(b.isLoadingTrailer=!0),a.sendGA("Review","Showing Reviews",f),d.go("main.detailReviews",{slug:e,tab:g})},b.listSessionHomeToday={},b.selectedHomePCinema=0,b.selectedHomeCinema=0,function(d){a.locationId="undefined"!=typeof a.locationId&&a.locationId>0?a.locationId:1;var e={location_id:a.locationId};g.get(c,{url:"/session/today"+Common.mergeQueryString(e),keyCache:"no-cache"},function(a){b.listSessionHomeToday=a.data.result,b.setSelectedCinema(v)},function(a){console.log(a)});var e={location_id:a.locationId,start_date:moment().format("YYYY-MM-DD"),end_date:moment().add("days",7).format("YYYY-MM-DD")};g.get(c,{url:"/session/checkcinema"+Common.mergeQueryString(e),keyCache:"no-cache"},function(a){b.checkSessionCinema=a.data.result},function(a){console.log(a)})}(jQuery),b.isShowModalNotBooking=!1,b.isShowModalOtherCinema=!1,b.isShowModalLotteNotice=!1,b.isShowModalAgeRestrict=!1,a.isShowModalLotteGuide=!1,b.goToCheckout=function(c,e,f,g,h,i){if(l(h)){if(a.sendGA("Payment","Click Session Film",g.film_name),!Common.isBooking(f)||3==f&&0==a.user.is_allow_cgv)_.isNull(e)||_.isUndefined(e)?b.isShowModalNotBooking=!0:(b.isShowModalOtherCinema=!0,b.currentUrlOtherCinema=e);else if(Common.isBooking(f))if(a.user.user_id)if(1!=f||b.isOffModalLotteNotice){a.passVersion(i,c),localStorage.setItem("favorite-cinema",f);var j=d.href("checkout.index",{sessionId:c});window.open(j,"_blank")}else B.keyVersion=i,B.sessionId=c,b.isShowModalLotteNotice=!0,localStorage.setItem("favorite-cinema",f);else a.goToLogin()}else b.isShowModalOverTime=!0},b.goToOtherCinema=function(){window.open(b.currentUrlOtherCinema,"_blank")},b.closeModalNotBooking=function(){b.isShowModalNotBooking=!1},b.closeModalOtherCinema=function(){b.isShowModalOtherCinema=!1},b.closeModalOverTime=function(){b.isShowModalOverTime=!1},b.closeLotteNotice=function(){b.isShowModalLotteNotice=!1},b.acceptLotteNotice=function(){b.isShowModalLotteNotice=!1,b.isOffModalLotteNotice=document.getElementById("off-lotte-notice").checked,localStorage.setItem("off-lotte-notice",b.isOffModalLotteNotice),b.goForwardCheckout()},b.openLotteGuide=function(){a.isShowModalLotteGuide=!0},b.goForwardCheckout=function(){if(B&&B.keyVersion&&B.sessionId){a.passVersion(B.keyVersion,B.sessionId);var b=d.href("checkout.index",{sessionId:B.sessionId});window.open(b,"_blank")}},b.setSelectedPCinema=function(c){b.selectedHomePCinema=c;for(var d in a.listPCinemas)if(a.listPCinemas[d].p_cinema_id==c){var e=a.listPCinemas[d].cinemas;b.setSelectedCinema(e[0].cinema_id);break}},b.isEmptySession=!1,b.setSelectedCinema=function(a){b.selectedHomeCinema=a,"undefined"==typeof b.listSessionHomeToday[a]||0===Object.keys(b.listSessionHomeToday).length?b.isEmptySession=!0:b.isEmptySession=!1},b.isLoadedSession=!1,b.setHeightSessionTab=function(){b.isLoadedSession=!0,j(function(){var a=$("#parentListPCinemas").outerHeight();$("#listCinemas").css("height",a),$("#listMovies").css("height",a)},1e3)};var C=b.$watch("listShowingFilms",function(){angular.isDefined(b.listShowingFilms)&&b.listShowingFilms.length>0&&(b.toolFilms=b.listShowingFilms,r(),C())});b.createKeyCache=function(a,c,d){var e=n(d,b[c].currentOffset),f={type_id:a,offset:e,count:8,is_hot:-1,p_cinema_id:0};return"news"+Common.mergeQueryString(f)},window.onscroll=function(){o()},b.topFunction=function(){return $("html, body").animate({scrollTop:0},600),!1},b.watchTrailer=function(a){var c="https://www.youtube.com/embed/",d="autoplay=1";b.trailerUrl=e.trustAsResourceUrl(c+a+"?"+d),$("#modalTrailer").modal("show"),$("body").removeClass("modal-open"),$("body").css("padding-right",0),b.$evalAsync()},b.convertSessionTime=function(a){if(a){var b=a.split(" ")[1].split(":");return b[0]+":"+b[1]}return""},b.getSessionDay=function(a){if(a){var b=a.split(" ")[1].split(":");return b[0]+":"+b[1]}return""},b.removeAge=function(a){var b=a.indexOf("("),c=-1!=b?a.slice(0,b):a;return c},b.playTrailer=function(a){a.preventDefault(),a.stopPropagation(),b.watchTrailer(a.currentTarget.dataset.trailer)},b.goToComment=function(a){$("#headMenu .active").removeClass("active"),d.go("main.detailNews",{slug:a.currentTarget.dataset.slug,tab:"comment"})},b.closeTrailer=function(){$("#modalTrailer").modal("hide"),b.trailerUrl=e.trustAsResourceUrl("https://www.youtube.com/embed")},b.trailerOnChangeListFilm=function(){b.showTrailer=!0,setTimeout(function(){$("#sliderTrailer").slick({dots:!0,autoplay:!0,autoplaySpeed:5e3}),$("#sliderTrailer").addClass("active"),b.loadedTrailer=!0},100)},b.getCinemasByFilm=function(c){b.toolCinemas=[];var d=b.checkSessionCinema[c];for(var e in d){var f=d[e];for(var g in a.listCinemas)if(f==a.listCinemas[g].cinema_id){b.toolCinemas.push({cinema_id:f,cinema_name:a.listCinemas[g].cinema_name,p_cinema_id:a.listCinemas[g].p_cinema_id});break}}b.toolCinemas.sort(function(a,b){return a.cinema_name<b.cinema_name?-1:a.cinema_name>b.cinema_name?1:0})},b.buyTicket=function(){if(""!=b.buyNowData.sessionId&&b.canBuyNowTool){a.sendGA("Payment","Click Session Film",b.buyNowData.sessionId);var c=d.href("checkout.index",{sessionId:b.buyNowData.sessionId});window.open(c,"_blank")}},b.filter=function(a,c){switch(angular.isUndefined(c)&&(c=0),a){case 1:b.getCinemasByFilm(c)}},b.onClickHomeToolsMenu=function(a){var b=a.target.attributes["aria-expanded"];if(angular.isUndefined(b)||angular.isDefined(b)&&"false"===b.value){var c=$("#homeTools").offset().top-$(window).scrollTop(),d=window.innerHeight;if(c>d/2){var e=c-d/2+80+80;e>300&&$("html, body").animate({scrollTop:e},500)}}},b.chooseMovie=function(a){var c=$(a.target).data();b.buyNowData.filmId=c.id,b.labelMovie=c.name,b.labelCinema="Rạp",b.labelDate="Ngày Xem",b.labelSession="Suất chiếu",b.isChoseMovie=!0,b.filter(1,c.id),b.getSessionOnTool(),j(function(){$("#homeTools .selectCinema").addClass("open")},200)},b.chooseCinema=function(c){var d=$(c.target).data();!Common.isBooking(d.pId+"")||3==d.pId&&0==a.user.is_allow_cgv?b.isShowModalNotBooking=!0:(b.labelCinema=d.name,b.labelDate="Ngày Xem",b.labelSession="Suất chiếu",b.buyNowData.cinemaId=d.id,b.isChoseCinema=!0,b.filter(2,d.id),b.getSessionOnTool(),j(function(){$("#homeTools .selectDate").addClass("open")},200))},b.chooseDate=function(a,c){b.labelDate=a,b.labelSession="Suất chiếu",b.buyNowData.sessionDay=c,b.isChoseDate=!0,b.getSessionOnTool(),j(function(){$("#homeTools .selectSession").addClass("open")},200)},b.chooseSession=function(a){var c=$(a.target).data();b.labelSession=c.name,b.buyNowData.sessionId=c.id,b.canBuyNowTool=!0},b.getSessionOnTool=function(){if(b.canBuyNowTool=!1,""!=b.buyNowData.filmId&&""!=b.buyNowData.cinemaId&&""!=b.buyNowData.sessionDay){var a={film_id:b.buyNowData.filmId,cinema_id:b.buyNowData.cinemaId,start_date:b.buyNowData.sessionDay,end_date:b.buyNowData.sessionDay},d=Common.mergeQueryString(a);g.get(c,{url:"/session/list"+d,keyCache:"no-cache"},function(a){b.listSessions=a.data.result.filter(l)})}},b.showMoreFilms=function(){b.isShowMoreFilms=!0},b.onClickIconComment=function(a){a.preventDefault(),a.stopPropagation();var b=a.currentTarget.dataset.slug;d.go("main.detail",{slug:b,tab:"comment"})},b.isBigNews=function(a){return-1!==z.indexOf((parseInt(a)+1)%8)?!0:!1},b.changeNewsLike=function(a){var c=a.news_id;1==b.userLike[c]?(b.userLike[c]=0,b.userLike[c+"_sum"]-=1):(b.userLike[c]=1,void 0!=b.userLike[c+"_sum"]?b.userLike[c+"_sum"]+=1:b.userLike[c+"_sum"]=a.up_vote+1)},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),t(b[e].type,b[e].currentOffset,b[e].name,a)},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}},b.initNewsReview=function(){w||(w=!0,t(b.listReview.type,0,b.listReview.name))},b.initNewsPromotion=function(){x||(x=!0,t(b.listPromotion.type,0,b.listPromotion.name))},b.initFilmUpComing=function(){y||(y=!0,g.get(c,{url:"/film/list?status=1",keyCache:"main-films-coming"},function(a){b.listUpComingFilms=a.data.result,s(),b.isLoadedUpComming=!0},function(a){console.log(a)}))},b.setFirstCinema=function(a){v=a},b.isLoadedReview=!1,b.loadedReview=function(){b.isLoadedReview=!0},b.isLoadedPromotion=!1,b.loadedPromotion=function(){b.isLoadedPromotion=!0},a.closeErrorSessionModal=function(){$("#session-error-modal").modal("hide")},b.adsClick=function(b){var c=b.target.parentNode,d=c.dataset;a.sendGA("Banner Ads","Position "+d.position,d.link),window.open(d.link,"_blank")},b.updateSlick=function(){setTimeout(function(){$("#sliderAdsNews").slick({dots:!0,autoplay:!0,autoplaySpeed:3e3}),$("#sliderAdsCinema").slick({dots:!0,autoplay:!0,autoplaySpeed:3e3})},100)}}])}(),function(){angular.module("TIX").controller("ModalLotteController",["$rootScope","$scope","$http","$state",function(a,b,c,d){b.step=1,b.min=1,b.max=3,b.closeLotteGuide=function(){a.isShowModalLotteGuide=!1},b.backStep=function(){b.step--},b.forwStep=function(){b.step++}}])}(),function(){angular.module("TIX").controller("ModalTutorialController",["$rootScope","$scope","$http","$state",function(a,b,c,d){function e(){setTimeout(function(){$("#m-slide").slick({dots:!0,autoplay:!1,arrows:!1})},100)}b.step=0,b.min=0,b.max=2,b.modalDescHTML="",b.modalContent=[{modalTitle:"Đổi tại rạp Lotte Cinema",modalImage:"app/assets/img/lotte_new_flow/IMG_Lotte_Cineplex.png",modalDesc:"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text. Lorem Ipsum has been the industry's standard dummy text"},{modalTitle:"Đổi qua ứng dụng Lotte Cinema",modalImage:"app/assets/img/lotte_new_flow/IMG_Lotte_App.png",modalDesc:"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text. Lorem Ipsum has been the industry's standard dummy text"},{modalTitle:"Đổi qua website Lotte Cinema",modalImage:"app/assets/img/lotte_new_flow/IMG_Lotte_Web.png",modalDesc:"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text. Lorem Ipsum has been the industry's standard dummy text"}],e(),b.closeModalTutorial=function(){a.isShowModalTutorial=!1},b.backStep=function(){b.step--},b.forwStep=function(){b.step++}}]),angular.module("TIX").controller("ModalPromoController",["$rootScope","$scope","$http","$state","APIServiceV2",function(a,b,c,d,e){function f(){e.get(c,{url:"/api/promotion/popup",keyCache:"no-cache"},function(a){if(a&&0==a.data.code){var c=a.data.data;console.log(c),b.modalType=c.type?c.type:0,b.modalFreq=c.freq?c.freq:0,b.modalTitle=c.title?c.title:"",b.modalImage=c.img?c.img:"",b.modalDesc=c.desc?c.desc:"",b.modalData=c.data?c.data:"",i()}},function(a){})}function g(a){a-=0,a=a&&a>0?a:0;var b=moment().add(a,"hours");localStorage.setItem("modal-promo-expired",b)}function h(){f()}function i(){var b=localStorage.getItem("modal-promo-expired");b?(b=moment(b),moment().isAfter(b)?a.isShowModalPromo=!0:a.isShowModalPromo=!1):a.isShowModalPromo=!0}b.modalType=1,b.modalFreq=0,b.modalTitle="",b.modalImage="",b.modalDesc="",b.modalData="",a.isShowModalPromo=!1,h(),b.joinModalPromo=function(){var c=JSON.parse(b.modalData);switch(b.closeModalPromo(),b.modalType){case 1:c.filmId&&d.go("main.detail",{slug:c.filmId});break;case 2:a.isMobile?d.go("main.cinemaMobile",{}):$([document.documentElement,document.body]).animate({scrollTop:$("#cinemablock").offset().top},500)}},b.closeModalPromo=function(){a.isShowModalPromo=!1,g(b.modalFreq)}}])}(),function(){angular.module("TIX").controller("MovieDetailController",["$scope","$rootScope","$http","$state","APIService","$sce","ParseUrl","Upload","$q","$location","$window","$timeout","CommonService","ngMeta","$cookies",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(c){a.listDay=[];for(var d={desktop:["Chủ Nhật","Thứ 2","Thứ 3","Thứ 4","Thứ 5","Thứ 6","Thứ 7"],mobile:["CN","T2","T3","T4","T5","T6","T7"]},e=0;Q>e;e++){var f=b.isMobile?"mobile":"desktop",g=moment().day()+e;g>=7&&(g-=7*Math.floor(g/7));var h={dayOfWeek:d[f][g],day:c.add("days",e).format("DD"),date:c.format("YYYYMMDD")};a.listDay.push(h),c.add("days",-e)}}function q(){r(),s(ia),C(ia);var a=g.byQueryString("tab");"undefined"!=typeof a&&"comment"===a&&$(".navCenter .commentTab").click(),b.isLoggedIn&&(1==b.user.is_admin?(ca="https://s3img.vcdn.vn/123phim/2018/04/39287a70b5571631581725e325603577.png",ba="tix.vn"):(ca=b.user.avatar,ba=b.user.fullname))}function r(){e.get(c,{url:"/session/order",keyCache:"session-order"},function(a){T=a.data.result})}function s(d){a.keyCache="movie-detail"+d,e.get(c,{url:"/film/detail?film_id="+d,keyCache:"movie-detail"+d},function(d){if(P=d.data.result,a.filmDetail=d.data.result,a.filmDetail.film_category=x(a.filmDetail.film_category),a.filmDetail.film_description_mobile=y(a.filmDetail.film_description_mobile),a.poster=P.poster,a.media_id=P.media_id,a.publishDay=v(P.publish_date),a.circlePercent=10*P.avg_point,a.director=P.film_director,a.artistName=w(P.list_actor),aa=""+a.filmDetail.layout_style,a.filmDetail.layout_style=parseInt(aa.substr(0,1)),aa=aa.slice(2),u(),void 0!=b.user.user_id&&void 0!=a.filmDetail.list_news&&0!=a.filmDetail.list_news.length){var f=_.pluck(d.data.result.list_news,"news_id"),g={user_id:b.user.user_id,object_type:1,object_ids:f};e.post(c,{url:"/comment/like",keyCache:"no-cache"},g,function(b){if(1===b.data.status&&void 0!=b.data.result){for(var c in b.data.result)a.userLike[c]=b.data.result[c];var d,e=a.filmDetail.list_news;for(var c in e)d=a.userLike[e[c].news_id],e[c].user_like=1==d?1:0,void 0!=d&&(e[c].up_vote=a.userLike[e[c].news_id+"_sum"])}else console.log(b.data.error)},function(a){console.log(a)})}b.isMobile?a.posterLandscape=null!=P.poster_landscape_mobile?P.poster_landscape_mobile:P.poster_landscape:a.posterLandscape=P.poster_landscape,a.stylemovie=1==P.layout_style?!0:!1,n.init(),n.setDefaultTag("title",a.filmDetail.film_name),$(window).width()<=V&&$("#homeNewsMain .description").addClass("more"),t(),M()},function(a){console.log("error")})}function t(){l(function(){$(".logo-loading").css("opacity",0),l(function(){a.isLoadingFirst=!1},500)},500)}function u(){var a=/^([0-9a-fA-F]{3}){1,2}$/;a.test(aa)&&(document.getElementById("detailMain").style.backgroundColor="#"+aa,document.getElementsByClassName("styleGradient")[0].style.background="linear-gradient(to top,#"+aa+",transparent 100%)")}function v(a){var b=a[8]+a[9]+"."+a[5]+a[6]+"."+a[0]+a[1]+a[2]+a[3];return b}function w(a){for(var b="",c=0;c<a.length;c++)"Đạo diễn"!=a[c].char_name&&(0!=b.length&&(b+=", "),b+=a[c].artist_name);return b}function x(a){for(var b=a.split(","),c="",d=0;d<b.length;d++)0!=c.length&&(c+=", "),c+=b[d];return c}function y(a){a+="\n";var b=a.indexOf("NSX"),c=a.indexOf("\n",b),d=a.slice(b,c+1),e=a.replace(d,"");return e}function z(b){b<P.list_trailer.length?a.isHidePlayYoutubeModal=!1:(a.isHideImgInfoDetailModal=!0,a.isHidePlayYoutubeModal=!0),A(b)}function A(b){0==b?a.isHidePreSlickMobile=!0:a.isHidePreSlickMobile=!1,b==P.list_trailer.length+P.list_image_view.length-1?a.isHideNextSlickMobile=!0:a.isHideNextSlickMobile=!1}function B(a){var b=a.session_time.split(/[- :]/);return new Date(b[0],b[1]-1,b[2],b[3],b[4],b[5])>new Date}function C(d){p(moment());var f={cinema_id:-1,film_id:d,start_date:a.today,end_date:b.sessionEndDate,location_id:b.locationId},g=Common.mergeQueryString(f);e.get(c,{url:"/session/film"+g,keyCache:"no-cache"},function(b){if(1!=b.data.status||_.isEmpty(b.data.result))a.isShowLoading=!1,a.emptySession=!0;else if(angular.isDefined(fa)&&null!==fa){for(var c=[],d=0;d<b.data.result.length;d++){var e=Object.keys(b.data.result[d])[0],f=e.split("_")[0];f===fa?c.unshift(b.data.result[d]):c.push(b.data.result[d])}a.sessionFilm=c}else a.sessionFilm=b.data.result},function(a){console.log("error")})}function D(){return _.pluck(T,"p_cinema_id")}function E(d){var f={film_id:d,offset:S},g=Common.mergeQueryString(f);e.get(c,{url:"/film/comment"+g,keyCache:"no-cache"},function(d){if(1==d.data.status&&!_.isEmpty(d.data.result)){for(var f=d.data.result.comments?d.data.result.comments:[],g=0;g<f.length;g++)(null==f[g].total_chilren_comment||angular.isUndefined(f[g].total_chilren_comment))&&(f[g].total_chilren_comment=0);a.filmComments=a.filmComments.concat(f),a.totalComment=d.data.result.total;var h=h=d.data.result.children_comment?d.data.result.children_comment:[];for(var g in h)0===h[g].length&&delete h[g];if(void 0!=b.user.user_id&&d.data.result.total>0){a.commentLike=[];var i=_.pluck(f,"comment_id"),j={user_id:b.user.user_id,object_type:3,object_ids:i};e.post(c,{url:"/comment/like",keyCache:"no-cache"},j,function(b){if(1===b.data.status&&void 0!=b.data.result){for(var c in b.data.result)a.commentLike[c]=b.data.result[c];var d;for(var c in a.filmComments)d=a.commentLike[a.filmComments[c].comment_id],a.filmComments[c].user_like=1==d?1:0,d=a.commentLike[a.filmComments[c].comment_id+"_sum"],void 0!=d&&(a.filmComments[c].up_vote=d)}else console.log(b.data.error)},function(a){console.log(a)});var k=[];for(var g in h)k=k.concat(_.pluck(h[g],"comment_id"));if(k.length>0){var l={user_id:b.user.user_id,object_type:3,object_ids:k};e.post(c,{url:"/comment/like",keyCache:"no-cache"},l,function(b){if(1===b.data.status&&void 0!=b.data.result){for(var c in b.data.result)a.commentLike[c]=b.data.result[c];var d,e;for(var c in h)for(var f=0;f<h[c].length;f++)e=h[c][f].comment_id,d=a.commentLike[e],void 0!=d&&(h[c][f].user_like=1==d?1:0,d=a.commentLike[e+"_sum"],h[c][f].up_vote=d)}else console.log(b.data.error)},function(a){console.log(a)})}}for(var g in h)a.listChildComment[g]||(a.listChildComment[g]=h[g],a.showCurrentChildComment[g]=X,W[g]=0)}},function(a){console.log("error")})}function F(d){var f={comment_id:d,offset:W[d]},g=Common.mergeQueryString(f);e.get(c,{url:"/comment/reply"+g,keyCache:"no-cache"},function(f){if(f.data.hasOwnProperty("error")||200!==f.status||1!==f.data.status||null===f.data.result)45==f.data.error.code||-1==f.data.error.code?b.isHideUserTokenExpired=!1:console.log(f.data.error);else{var g=f.data.result,h=[];if(h=h.concat(_.pluck(f.data.result,"comment_id")),h.length>0){var i={user_id:b.user.user_id,object_type:3,object_ids:h};e.post(c,{url:"/comment/like",keyCache:"no-cache"},i,function(b){if(1===b.data.status&&void 0!=b.data.result){for(var c in b.data.result)a.commentLike[c]=b.data.result[c];for(var e,f,c=0;c<g.length;c++)f=g[c].comment_id,e=a.commentLike[f],void 0!=e&&(g[c].user_like=1==e?1:0,e=a.commentLike[f+"_sum"],g[c].up_vote=e),a.listChildComment[d].push(g[c])}else console.log(b.data.error)},function(a){console.log(a)})}}},function(a){console.log(a)})}function G(c){var d=c.target.dataset.commentId;b.isMobile||13!=c.keyCode||c.shiftKey||(c.preventDefault(),a.postReply(d))}function H(a){var d=[],f="undefined"!=typeof b.locationId?b.locationId:1;e.get(c,{url:"/cinema/list?location_id="+f,keyCache:"no-cache"},function(a){var c=a.data.result;b.listCinemas=c;var e=-1;for(var f in c){var g,h=c[f],i=_.find(d,function(a){return a.p_cinema_id==h.p_cinema_id});"undefined"==typeof i?(e+=1,d.push({p_cinema_id:h.p_cinema_id,p_cinema_name:h.p_cinema_name,p_cinema_logo:h.cinema_logo,cinemas:[],index:e}),g=e):g=i.index;var j={cinema_id:h.cinema_id,cinema_name:h.cinema_name,cinema_image:h.cinema_image,cinema_address:h.cinema_address,cinema_slug:h.cinema_slug,cinema_latitude:h.cinema_latitude,cinema_longitude:h.cinema_longitude,cinema_name_s1:h.cinema_name_s1,cinema_name_s2:h.cinema_name_s2};d[g].cinemas.push(j),parseInt(f)+1===c.length&&I(d)}})}function I(a){if(angular.isDefined(fa)&&null!==fa){var c=[];angular.forEach(a,function(a){a.p_cinema_id==fa?c.unshift(a):c.push(a)}),b.listPCinemas=c}else b.listPCinemas=a}function J(b){var c="https://www.youtube.com/embed/",d="autoplay=1";a.trailerUrl=f.trustAsResourceUrl(c+b+"?"+d),$("#modalTrailer").modal("show"),a.$evalAsync()}function K(a){return i(function(b,d){var e=new FileReader;e.readAsDataURL(a),e.onload=function(){var f={};f.data=e.result,f.name=a.name,f.size=a.size,h.post(c,f,function(a){b(a)},function(a){d(a)})}})}function L(){document.body.scrollTop>20||document.documentElement.scrollTop>20?$("#btnScrollTop").addClass("active"):$("#btnScrollTop").removeClass("active")}function M(){e.get(c,{url:"/promotions",keyCache:"no-cache"},function(c){if(c.data.hasOwnProperty("error")||200!==c.status||1!==c.data.status||null===c.data.result)console.error(c.data.error);else{for(var d in c.data.result){var e=c.data.result[d];for(var f in e)e[f].length>0?(e[f][0].p_cinema_id=d,ea[d+"_"+f]=e[f][0]):ea[d+"_"+f]=!1}setTimeout(function(){if(b.isMobile){var c=moment(a.selectedDate,"YYYYMMDD").day();for(var d in ea)d.substr(-1)==c&&O(ea[d])}else N(a.selectedPCinema,a.selectedDate)},1e3)}},function(a){console.log("error")})}function N(a,b){var c=moment(b,"YYYYMMDD").day();ea[a+"_"+c]&&O(ea[a+"_"+c])}function O(c){if(b.isMobile)var d=document.getElementsByClassName("js-promo-tooltip-"+c.p_cinema_id+"-"+a.selectedDate)[0];else var d=document.getElementsByClassName("js-promo-tooltip-"+c.p_cinema_id)[0];c.desc;if(d){var e='<div class="tooltip-content"><div class="tooltip-title">'+c.name+'</div><ul class="tooltip-list">';for(var f in c.desc)e+="<li>"+c.desc[f]+"</li>";e+="</ul></div>",d.innerHTML=e;var g=d.parentNode,h=g.getElementsByClassName("promo-info")[0],i=g.getElementsByClassName("pcinema-promotion")[0];h&&(b.isMobile?h.style.width=i.clientWidth+"px":(h.addEventListener("mouseover",function(){a.selectedPCinema==c.p_cinema_id&&(d.style.opacity=1)}),h.addEventListener("mouseout",function(){d.style.opacity=0})))}}var P={},Q=14;a.showChar=285;a.rateit=0,b.isHomePage=!1,a.poster="app/assets/img/default-film.webp",a.posterLandscape="app/assets/img/default-trailer.webp",a.media_id=".",a.today=moment().format("YYYY-MM-DD"),b.sessionEndDate=moment().add("days",Q).format("YYYY-MM-DD");var R=!1,S=0;a.row1="Ngay phat hanh",b.isMobileResponsive=!1,a.filmDetail={},a.showCurrentNews=3,a.filmComments=[],a.showCurrentComment=5,a.sessionFilm={},a.isHideOverlayBook=!0,a.isHideOverlayTrailer=!0,a.errorComment="",a.isHideOverlayMap=!0,a.isHideImgInfo=!0,a.idHideSlickPlayYtb=!1,a.isHideImgInfoDetailModal=!0,a.isHidePlayYoutubeModal=!0,a.isHidePreviewImage=!1,a.viewMoreText=!1;new google.maps.InfoWindow;a.emptySession=!1,a.isShowLoading=!0,a.isLoadingFirst=!0,a.isHidePreSlickMobile=!1,a.isHideNextSlickMobile=!1,$(document).ready(function(){a.currentUrl=window.location.href;var b=localStorage.getItem("off-lotte-notice");a.isOffModalLotteNotice=null==b?!1:"true"==b}),a.stylemovie=!0,a.isHideSlick=!1,a.mobileWidth=737,a.currentSlideMobile=0,a.isShowModalOverTime=!1,b.isCinemaDetail=!1;var T=[],U=!1,V=737;a.userLike=[],a.commentLike=[],a.isReply=[],a.listChildComment=[],a.showCurrentChildComment=[],a.totalComment=0;var W=[],X=5,Y=10,Z=20,aa="",ba="",ca="",da={keyVersion:"",sessionId:""},ea={};a.isShowModalNotBooking=!1,a.isShowModalOtherCinema=!1,a.isShowModalLotteNotice=!1,b.isShowModalLotteGuide=!1,a.goToCheckout=function(c,e,f,g,h,i){if(B(h)){if(b.sendGA("Payment","Click Session Film",e+" - "+a.filmDetail.film_name),!Common.isBooking(g)||3==g&&0==b.user.is_allow_cgv)_.isNull(f)||_.isUndefined(f)?a.isShowModalNotBooking=!0:(a.isShowModalOtherCinema=!0,a.currentUrlOtherCinema=f);else if(Common.isBooking(g))if(b.user.user_id)if(1!=g||a.isOffModalLotteNotice){b.passVersion(i,c),localStorage.setItem("favorite-cinema",g);var j=d.href("checkout.index",{sessionId:c});window.open(j,"_blank")}else da.keyVersion=i,da.sessionId=c,a.isShowModalLotteNotice=!0,localStorage.setItem("favorite-cinema",g);else b.goToLogin()}else a.isShowModalOverTime=!0},a.goToOtherCinema=function(){window.open(a.currentUrlOtherCinema,"_blank")},a.closeModalNotBooking=function(){a.isShowModalNotBooking=!1},a.closeModalOtherCinema=function(){a.isShowModalOtherCinema=!1},a.closeModalOverTime=function(){a.isShowModalOverTime=!1},a.closeLotteNotice=function(){a.isShowModalLotteNotice=!1},a.acceptLotteNotice=function(){a.isShowModalLotteNotice=!1,a.isOffModalLotteNotice=document.getElementById("off-lotte-notice").checked,localStorage.setItem("off-lotte-notice",a.isOffModalLotteNotice),a.goForwardCheckout()},a.openLotteGuide=function(){b.isShowModalLotteGuide=!0},a.goForwardCheckout=function(){if(da&&da.keyVersion&&da.sessionId){b.passVersion(da.keyVersion,da.sessionId);var a=d.href("checkout.index",{sessionId:da.sessionId});window.open(a,"_blank")}},a.goToDetailNews=function(c,e,f,g){c.preventDefault(),b.isMobile&&(a.isLoadingFirst=!0),b.sendGA("News","News",g),d.go("main.detailNews",{slug:e,tab:f})};var fa=localStorage.getItem("favorite-cinema");if(null===k.localStorage.getItem("listPCinemas"))H(g.byId(d.params.slug));else{var ga=JSON.parse(k.localStorage.getItem("listPCinemas"));I(ga)}a.chooseDateMobile=function(b){a.selectedDate=b;var c=a.isNotEmptySessionMobile(b);c?a.emptySession=!1:a.emptySession=!0,setTimeout(function(){var b=moment(a.selectedDate,"YYYYMMDD").day();for(var c in ea)c.substr(-1)==b&&O(ea[c])},100)},a.chooseDate=function(b){a.selectedDate=b;var c=a.isEmptySession(b);c?a.emptySession=!0:a.emptySession=!1,N(a.selectedPCinema,a.selectedDate)};var ha=[];ha.push({version:2,detail:[{voice:0,link:""},{voice:1,link:""}]}),ha.push({version:3,detail:[{voice:0,link:""},{voice:1,link:""}]}),ha.push({version:2,detail:[{voice:0,link:""},{voice:1,link:""}]});var ia=g.byId(d.params.slug);q(),a.closeCommentBox=function(){a.isHideOverlayBook=!0,a.errorComment=""},a.openCommentBox=function(){b.isLoggedIn?(a.isHideOverlayBook=!1,a.rateit="2.5"):b.isHideUserNotSignIn=!1},a.closeTrailerBox=function(){document.getElementById("imgInfoDetailModal").src="",a.isHideOverlayTrailer=!0,a.isHideImgInfoDetailModal=!0,$("body").css("overflow","auto")},a.removeLoading=function(){a.isShowLoading=!1},a.setHeightSessionTab=function(){b.isMobile||setTimeout(function(){var a=$(".listPCinemas").outerHeight();$("#listSession").css("height",a-$("#listDayOfWeek .DayOfWeek").outerHeight()-2)},1e3)},a.isNotEmptySessionMobile=function(b){var c=D();return _.some(c,function(c){return _.some(a.sessionFilm,function(a){return"undefined"!=typeof a[c+"_"+b]})})},a.isEmptySession=function(b){var c,d,e=0,f=Object.keys(a.sessionFilm).length;return _.some(a.sessionFilm,function(g){return c=Object.values(g)[0].p_cinema_id,e+=1,c==a.selectedPCinema&&(d=1),c==a.selectedPCinema&&"undefined"==typeof g[a.selectedPCinema+"_"+b]||angular.isUndefined(d)&&e===f})},$(document).ready(function(){$("#show").click(function(){$("p").show()}),$(this).scrollTop(0);var a=$(window);a.width()<V&&(b.isMobileResponsive=!0),a.resize(function(){a.width()<V?b.isMobileResponsive=!0:b.isMobileResponsive=!1})});var ja,ka;a.onClickShowMap=function(b){b.stopPropagation();var c=b.target.dataset,d=new google.maps.LatLng(c.latitude,c.longitude),e={zoom:15,center:d,mapTypeId:google.maps.MapTypeId.ROADMAP};ja=new google.maps.Map(document.getElementById("map"),e),a.isHideOverlayMap=!1,la(c,ja,d),$(document).ready(function(){google.maps.event.trigger(ja,"resize"),
ja.setCenter(d)})},a.closeMapBox=function(){a.isHideOverlayMap=!0,ka.setMap(null)};var la=function(a,b,c){ka=new google.maps.Marker({map:b,position:c,title:a.tittle,animation:google.maps.Animation.DROP}),ka.content='<div class="infoWindowContent">'+a.address+"</div>"};a.choosePCinema=function(b){a.selectedPCinema=b;var c=a.isEmptySession(a.selectedDate);c?a.emptySession=!0:a.emptySession=!1,N(a.selectedPCinema,a.selectedDate)},a.choosePCinemaMobile=function(b,c){if(a.selectedPCinema==c)a.selectedPCinema=0;else{a.selectedPCinema=c;var d=b.target.dataset;l(function(){$("html,body").animate({scrollTop:$("#"+d.id).offset().top-60},"100")},200)}},a.onClickMap=function(a){a.preventDefault(),a.stopPropagation()},a.viewMoreNews=function(){a.showCurrentNews<a.filmDetail.list_news.length&&(a.showCurrentNews+=3,a.showCurrentNews>=a.filmDetail.list_news.length&&$("#btnNewsRelated").hide())},a.slickTrailerFunction=function(){$(window).width()>V?$(".detailImgTrailer").slick({infinite:!1,slidesToShow:6,slidesToScroll:6,useCSS:!0}):$("#detailSlick").removeClass("wrapSlick2 showHover"),a.filmDetail.list_trailer.length>0?(a.youtube_id=a.filmDetail.list_trailer[0].youtube_id,a.imgInfoDetail=f.trustAsResourceUrl(a.filmDetail.list_trailer[0].thumbnail)):(a.imgInfoDetail=f.trustAsResourceUrl(a.filmDetail.list_image_view[0]),a.idHideSlickPlayYtb=!0)},a.slickTrailerFunctionMobile=function(){$(window).width()<=V&&$(".detailImgTrailerMobile").slick({infinite:!1,speed:500,fade:!0,useCSS:!0,centerMode:!0,initialSlide:-1,nextArrow:$("#nextSlickMobile"),prevArrow:$("#preSlickMobile")})},a.showingInfo=function(){R||($(".slick-next").click(),setTimeout(function(){$(".slick-prev").click()},500),R=!0)},$(".detailImgTrailerMobile").on("afterChange",function(b,c,d){z(d),a.$apply()}),a.updateMainImage=function(b){var c,d=b.target,e=d.dataset,g=e["class"],h=e.index;document.getElementById("imgInfoDetail").src="","trailer"==g?(a.youtube_id=P.list_trailer[h].youtube_id,a.imgInfoDetail=f.trustAsResourceUrl(P.list_trailer[h].thumbnail),$(window).width()>V?(a.isHideImgInfo=!0,a.idHideSlickPlayYtb=!1,a.isHidePreviewImage=!1):($("body").css("overflow","hidden"),c=parseInt(h),a.isHidePreSlickMobile=!1,a.isHideNextSlickMobile=!1,a.isHidePreviewImage=!1,a.idHideSlickPlayYtb=!0,a.isHideOverlayTrailer=!1,$(".detailImgTrailerMobile").slick("slickGoTo",c),A(c))):(a.imgInfoDetail=f.trustAsResourceUrl(P.list_image_view[h]),$(window).width()>V?(a.isHideImgInfo=!0,a.idHideSlickPlayYtb=!0,a.isHidePreviewImage=!1):($("body").css("overflow","hidden"),c=parseInt(h)+P.list_trailer.length,a.isHidePreSlickMobile=!1,a.isHideNextSlickMobile=!1,a.isHidePreviewImage=!1,a.idHideSlickPlayYtb=!0,a.isHideOverlayTrailer=!1,$(".detailImgTrailerMobile").slick("slickGoTo",c),A(c))),a.$evalAsync()},a.playTrailerSlick=function(){var b="https://www.youtube.com/embed/",c="autoplay=1";$(window).width()>V?(document.getElementById("imgInfoDetail").src=f.trustAsResourceUrl(b+a.youtube_id+"?"+c),a.isHideImgInfo=!1,a.idHideSlickPlayYtb=!0,a.isHidePreviewImage=!0):(document.getElementById("imgInfoDetailMobile").src=f.trustAsResourceUrl(b+a.media_id+"?"+c),$("#imgInfoDetailMobile").show(),$("#slickPlayYoutubeMobile").hide())},a.playTrailerSlickModal=function(){var b="https://www.youtube.com/embed/",c="autoplay=1";a.isHideImgInfoDetailModal=!1,a.isHidePlayYoutubeModal=!0,a.isHidePreviewImage=!0,a.isHidePreSlickMobile=!0,a.isHideNextSlickMobile=!0,document.getElementById("imgInfoDetailModal").src=f.trustAsResourceUrl(b+a.youtube_id+"?"+c)},a.getPCinemaInfo=function(a){for(var c in b.listPCinemas)if(b.listPCinemas[c].p_cinema_id==a)return b.listPCinemas[c]},a.buildKeyCache=function(){var a={film_id:g.byId(d.params.slug)};return"movie-detail-comment"+Common.mergeQueryString(a)},a.postReply=function(f){var h=$(".inputComment","#reply_"+f).val(),i=b.user.user_id,j={};""!==h&&(j.user_id=i,j.film_id=g.byId(d.params.slug),j.comment=h,j.p_comment_id=f,e.post(c,{url:"/comment/reply",keyCache:"no-cache"},j,function(d){if(d.data.hasOwnProperty("error")||200!==d.status||1!==d.data.status||null===d.data.result)45===d.data.error.code||-1===d.data.error.code?b.isHideUserTokenExpired=!1:console.log(d.data.error);else{$(".inputComment","#reply_"+f).val("");for(var g={user_id:b.user.user_id,avatar:ca,is_buy_ticket:0,fullname:ba,date_add:moment().format("YYYY-MM-DD HH:mm:ss"),comment_id:d.data.result,content:h,user_like:0,up_vote:0,p_comment_id:f,is_admin:b.user.is_admin,facebook_id:b.user.facebook_id,zalo_id:b.user.zalo_id,gmail_id:b.user.gmail_id},i=0;i<a.filmComments.length;i++)if(a.filmComments[i].comment_id==f){a.filmComments[i].total_chilren_comment++;break}a.listChildComment[f]?(a.listChildComment[f].unshift(g),a.showCurrentChildComment[f]++):(a.listChildComment[f]=new Array(g),a.showCurrentChildComment[f]=1),a.isReply[f]=!1;var j={film_id:a.filmDetail.film_id},k=Common.mergeQueryString(j);b.sendGA("Film","Send Comment Film",h),e.clearCache(c,"movie-detail-comment"+k,function(a){})}}))},a.loadMoreChildComment=function(b){a.showCurrentChildComment[b]+=X,a.showCurrentChildComment[b]%Y==0&&(W[b]+=Y,F(b))},a.autosize=function(a){var b=a.target;setTimeout(function(){b.style.cssText="height:auto",b.style.cssText="height:"+b.scrollHeight+"px"},0),G(a)},a.getTime=function(a){if(a){var b=a.split(" ")[1].split(":");return b[0]+":"+b[1]}return""},a.removeAge=function(a){var b=void 0!=a?a.indexOf("("):-1,c=-1!=b?a.slice(0,b):a;return c},a.getSubComment=function(b,c){for(var d=a.showChar;;){if(" "==b[d])break;d-=1}return 1===c?b.substr(0,d):2===c?b.substr(d+1,b.length):""},a.onClickViewMoreCmt=function(b){var c="isOpen"+b,d=$(".smallbox_"+b).html();"Thu gọn"===d?($(".smallbox_"+b).html("Xem thêm"),a[c]=!1):($(".smallbox_"+b).html("Thu gọn"),a[c]=!0)},a.viewMoreComment=function(){if(a.showCurrentComment<a.totalComment){a.showCurrentComment+=5;var b="dataIndex"+(a.showCurrentComment-5);setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b).offset().top-85},"slow")},200),a.showCurrentComment%Z==0&&(S+=Z,E(ia))}},a.starRated=function(){var b=2*a.rateit;1==b.toString().length&&(b+=".0"),$("#scoreRate").text(b)},a.playTrailerPoster=function(){J(a.media_id)},a.closeTrailer=function(){$("#modalTrailer").modal("hide"),a.trailerUrl=f.trustAsResourceUrl("https://www.youtube.com/embed")},$("#modalTrailer").click(function(){$("#modalTrailer").modal("hide")}),a.Upload=function(){$("#Upload").click()},$("#Upload").change(function(){if(a.errorComment="",this.files.length>5)return void(a.errorComment="Bạn chỉ được chọn tối đa 5 ảnh");listfile=this.files,$(".review-images").text("");for(var b=0;b<listfile.length;b++)a.readURL(listfile,b)}),a.readURL=function(a,b){if(a&&a[b]){var c=new FileReader;c.onload=function(a){$(".review-images").append("<div class='review-image' style='background-image: url("+a.target.result+")'><img class='closereview' src='app/assets/img/icons/close_black.png'> </div>")},c.readAsDataURL(a[b])}},$(document).on("click",".closereview",function(a){$(this).parent().remove()}),a.submitCommentBox=function(){if("undefined"!=typeof listfile&&listfile.length>0){for(var b=[],c=0;c<listfile.length;c++)b.push(K(listfile[c]));i.all(b).then(function(b){var c=[];for(var d in b)c.push(b[d].data.result);$(".review-images").empty(),a.postComment(c)})}else{var d=[];a.postComment(d)}},a.postComment=function(f){var h=$("#overlay-book .inputComment").val(),i=$("#overlay-book #scoreRate").text(),j=b.user.user_id,k={};return""===h?void(a.errorComment="Hãy cho TIX biết suy nghĩ của bạn"):(k.user_id=j,k.film_id=g.byId(d.params.slug),k.rating=parseInt(i),k.comment=h,k.list_image=f,void e.post(c,{url:"/comment/list",keyCache:"no-cache"},k,function(d){if(d.data.hasOwnProperty("error")||200!==d.status||1!==d.data.status||null===d.data.result)(45===d.data.error.code||-1===d.data.error.code)&&(b.isHideUserTokenExpired=!1),a.errorComment=d.data.error.message;else{$("#overlay-book .inputComment").val("");var g={user_id:b.user.user_id,avatar:ca,is_buy_ticket:0,fullname:ba,date_add:moment().format("YYYY-MM-DD HH:mm:ss"),rate:parseInt(i),comment_id:d.data.result,content:h,user_like:0,up_vote:0,list_image:f,is_admin:b.user.is_admin,total_chilren_comment:0,facebook_id:b.user.facebook_id&&"null"!=b.user.facebook_id?b.user.facebook_id:"",zalo_id:b.user.zalo_id&&"null"!=b.user.zalo_id?b.user.zalo_id:"",gmail_id:b.user.gmail_id&&"null"!=b.user.gmail_id?b.user.gmail_id:""};a.filmComments.unshift(g),a.isHideOverlayBook=!0;var j={film_id:a.filmDetail.film_id},k=Common.mergeQueryString(j);b.sendGA("Film","Send Comment Film",h),e.clearCache(c,"movie-detail-comment"+k,function(a){})}}))},a.buyTicket=function(){$(".navCenter").children().eq(0).find("a").trigger("click"),$("html,body").animate({scrollTop:$(".navCenter").offset().top},"slow")},a.cmt=function(){$("html,body").animate({scrollTop:$("body").height()-800},"slow"),$(".navCenter").children().eq(2).find("a").trigger("click")},window.onscroll=function(){L()},a.topFunction=function(){return $("html, body").animate({scrollTop:0},600),!1},a.sortByOrder=function(a){return a.$key+1},a.initCommentFilm=function(){U||(U=!0,E(ia))},a.checkFirstItem=function(c){a.selectedDate=Object.values(c)[0].date,b.isMobile||(a.selectedPCinema=Object.values(c)[0].p_cinema_id),setTimeout(function(){var a=document.getElementsByClassName("DayOfWeek")[0],b=document.getElementsByClassName("selectDate active")[0];a.scrollLeft=b.offsetLeft-a.clientWidth+b.clientWidth},100)},a.init=function(b,c){a.removeLoading(b),a.checkFirstItem(c)},a.reply=function(c){b.isLoggedIn&&1==b.user.is_admin&&(a.isReply[c]=!0)},a.changeFBAvatar=function(a,b,c){var d="";return d=""!=b&&b?1==c||a.includes("graph.facebook.com")?a:"https://graph.facebook.com/"+b+"/picture?type=square":a},a.showPromoTooltip=function(b,c){b.stopPropagation(),a.selectedPCinema=c;var d=b.target.parentNode.dataset;$("html,body").animate({scrollTop:$("#"+d.id).offset().top-60},"100")},a.showPromo=function(b){var c=moment(a.selectedDate,"YYYYMMDD").day(),d="";return ea[b+"_"+c]&&(d=ea[b+"_"+c].short_name),d},a.showPromoInfo=function(b){var c=moment(a.selectedDate,"YYYYMMDD").day(),d=!1;return ea[b+"_"+c]&&(d=!0),d}}])}(),function(){angular.module("TIX").controller("NewsDetailController",["$rootScope","$scope","$http","$state","APIService","ParseUrl","Upload","$q","$sce","ngMeta","$timeout",function(a,b,c,d,e,f,g,h,i,j,k){function l(){b.newsId=f.byId(d.params.slug),b.keyCache="news-detail"+b.newsId,a.isLoggedIn&&(1==a.user.is_admin?(C="https://s3img.vcdn.vn/123phim/2018/04/39287a70b5571631581725e325603577.png",B="tix.vn"):(C=a.user.avatar,B=a.user.fullname))}function m(d){e.get(c,{url:"/news/detail?news_id="+b.newsId,keyCache:"news-detail"+b.newsId},function(d){if(b.news=d.data.result,void 0!=a.user.user_id){var f=_.pluck(d.data.result.list_related,"news_id");f.push(b.news.news_id);var g={user_id:a.user.user_id,object_type:1,object_ids:f};e.post(c,{url:"/comment/like",keyCache:"no-cache"},g,function(a){if(1===a.data.status&&void 0!=a.data.result){for(var c in a.data.result)b.userLike[c]=a.data.result[c];var d=b.userLike[b.news.news_id];b.news.user_like=1==d?1:0,b.news.up_vote=void 0!=d?b.userLike[b.news.news_id+"_sum"]:b.news.up_vote;var e=b.news.list_related;for(var c in e)d=b.userLike[e[c].news_id],e[c].user_like=1==d?1:0,void 0!=d&&(e[c].up_vote=b.userLike[e[c].news_id+"_sum"])}},function(a){console.log(a)})}switch(b.newsContent=i.trustAsHtml(b.news.content),b.date_post=n(b.news.date_add),b.first_related=b.news.list_related[0],$(window).width()>480?(b.second_related=b.news.list_related[1],b.numstart=2,b.numend=5):(b.numstart=1,b.news.list_related.length-1<3?b.numend=b.news.list_related.length+1:b.numend=4),b.list_related=b.news.list_related,b.news.type_id){case 1:D=" / Điện ảnh 24h";break;case 4:D=" / Khuyến mãi";break;case 8:D=" / Đánh giá"}j.init(),j.setDefaultTag("title",b.news.news_title+D),setTimeout(function(){$("iframe").length>0&&$("iframe").each(function(){$(this).parent().addClass("isVideo")})},300)},function(a){console.log(a)}),o(b.newsId)}function n(a){return a[8]+a[9]+"."+a[5]+a[6]+"."+a[2]+a[3]}function o(d){var f={news_id:d,offset:w},g=Common.mergeQueryString(f);e.get(c,{url:"/news/comment"+g,keyCache:"no-cache"},function(d){if(1!=d.data.status||_.isEmpty(d.data.result))b.isHideBtnCommentMore=!0;else{for(var f=d.data.result.comments?d.data.result.comments:[],g=0;g<f.length;g++)f[g].total_chilren_comment||(f[g].total_chilren_comment=0);b.newsComments=b.newsComments.concat(f);var h=d.data.result.children_comment?d.data.result.children_comment:[];for(var g in h)0===h[g].length&&delete h[g];if(void 0!=a.user.user_id&&d.data.result.total>0){var i=_.pluck(f,"comment_id"),j={user_id:a.user.user_id,object_type:32,object_ids:i};e.post(c,{url:"/comment/like",keyCache:"no-cache"},j,function(a){if(1===a.data.status&&void 0!=a.data.result){for(var c in a.data.result)b.commentLike[c]=a.data.result[c];var d;for(var c in b.newsComments)d=b.commentLike[b.newsComments[c].comment_id],b.newsComments[c].user_like=1==d?1:0,d=b.commentLike[b.newsComments[c].comment_id+"_sum"],void 0!=d&&(b.newsComments[c].up_vote=d)}},function(a){console.log(a)});var k=[];for(var g in h)k=k.concat(_.pluck(h[g],"comment_id"));if(k.length>0){var l={user_id:a.user.user_id,object_type:32,object_ids:k};e.post(c,{url:"/comment/like",keyCache:"no-cache"},l,function(a){if(1===a.data.status&&void 0!=a.data.result){for(var c in a.data.result)b.commentLike[c]=a.data.result[c];var d,e;for(var c in h)for(var f=0;f<h[c].length;f++)e=h[c][f].comment_id,d=b.commentLike[e],void 0!=d&&(h[c][f].user_like=1==d?1:0,d=b.commentLike[e+"_sum"],h[c][f].up_vote=d)}else console.log(a.data.error)},function(a){console.log(a)})}}for(var g in h)b.listChildComment[g]||(b.listChildComment[g]=h[g],b.showCurrentChildComment[g]=y,x[g]=0)}},function(a){console.log("error")})}function p(a,b){if(a&&a[b]){var c=new FileReader;c.onload=function(a){$(".review-images").append("<div class='review-image' style='background-image: url("+a.target.result+")'><img class='closereview' src='app/assets/img/icons/close_black.png'> </div>")},c.readAsDataURL(a[b])}}function q(a){return h(function(b,d){var e=new FileReader;e.readAsDataURL(a),e.onload=function(){var f={};f.stringBase64=e.result,f.name=a.name,f.size=a.size,g.post(c,f,function(a){b(a)},function(a){d(a)})}})}function r(){document.body.scrollTop>20||document.documentElement.scrollTop>20?$("#btnScrollTop").addClass("active"):$("#btnScrollTop").removeClass("active")}function s(d){var f={news_comment_id:d,object_type:32,offset:x[d]},g=Common.mergeQueryString(f);e.get(c,{url:"/comment/reply"+g,keyCache:"no-cache"},function(f){if(f.data.hasOwnProperty("error")||200!==f.status||1!==f.data.status||null===f.data.result)45==f.data.error.code||-1==f.data.error.code?a.isHideUserTokenExpired=!1:console.log(f.data.error);else{var g=f.data.result,h=[];if(h=h.concat(_.pluck(f.data.result,"comment_id")),h.length>0){var i={user_id:a.user.user_id,object_type:32,object_ids:h};e.post(c,{url:"/comment/like",keyCache:"no-cache"},i,function(a){if(1===a.data.status&&void 0!=a.data.result){for(var c in a.data.result)b.commentLike[c]=a.data.result[c];for(var e,f,c=0;c<g.length;c++)f=g[c].comment_id,e=b.commentLike[f],void 0!=e&&(g[c].user_like=1==e?1:0,e=b.commentLike[f+"_sum"],g[c].up_vote=e),b.listChildComment[d].push(g[c])}else console.log(a.data.error)},function(a){console.log(a)})}}},function(a){console.log(a)})}function t(c){var d=c.target.dataset.commentId;a.isMobile||13!=c.keyCode||c.shiftKey||(c.preventDefault(),b.postReply(d))}b.news={},b.first_related={},b.second_related={},b.list_related=[],b.date_post="",a.isHomePage=!1,b.numstart=0,b.numend=0,b.newsId,b.hideOverlayBook=!0,b.isHideBtnCommentMore=!1,b.inputCmt="",b.cmtError="",b.showCurrentComment=5,b.newsComments=[],b.newsContent="",b.showChar=285,b.isLoadingFirst=!0,a.sharingCount=0,b.mobileWidth=737,b.userLike=[],b.commentLike=[];var u,v,w=0;b.isReply=[],b.listChildComment=[],b.showCurrentChildComment=[];var x=[],y=5,z=10,A=20,B="",C="",D="";$(document).ready(function(){b.currentUrl=window.location.href;var c=b.currentUrl.split("?");$.getJSON("https://graph.facebook.com/?id="+c[0]).then(function(b){a.sharingCount=b.share.share_count,a.$apply()})}),l(),m(),b.removeLoading=function(){k(function(){$(".logo-loading").css("opacity",0),k(function(){b.isLoadingFirst=!1},500)},500)},b.closeCommentBox=function(){b.hideOverlayBook=!0,b.cmtError=""},b.openCommentBox=function(){a.isLoggedIn?(b.hideOverlayBook=!1,b.rateitSet="0.0"):a.isHideUserNotSignIn=!1},b.viewMoreComment=function(){if(b.showCurrentComment<b.newsComments.length){b.showCurrentComment+=5;var a="dataIndex"+(b.showCurrentComment-5);setTimeout(function(){$("html,body").animate({scrollTop:$("#"+a).offset().top-85},"slow")},200),b.showCurrentComment%A==0&&(w+=A,o(v))}},b.onClickViewMoreCmt=function(a){var c="isOpen"+a,d=$(".smallbox_"+a).html();"Thu gọn"===d?($(".smallbox_"+a).html("Xem thêm"),b[c]=!1):($(".smallbox_"+a).html("Thu gọn"),b[c]=!0)},b.getSubComment=function(a,c){for(var d=b.showChar;;){if(" "==a[d])break;d-=1}return 1===c?a.substr(0,d):2===c?a.substr(d+1,a.length):""},b.buildKeyCache=function(){var a={news_id:f.byId(d.params.slug)};return"news-detail-comment"+Common.mergeQueryString(a)},$(document).on("click",".closereview",function(a){$(this).parent().remove()}),$("#Upload").change(function(){if(b.cmtError="",this.files.length>5)return void(b.cmtError="Bạn chỉ được chọn tối đa 5 ảnh");u=this.files,$(".review-images").text("");for(var a=0;a<u.length;a++)p(u,a)}),b.Upload=function(){$("#Upload").click()},b.postComment=function(d){var f=b.inputCmt,g={};return""===f?void(b.cmtError="Hãy cho TIX biết suy nghĩ của bạn."):(g.user_id=a.user.user_id,g.news_id=b.newsId,g.rating=0,g.comment=f,g.list_image=d,void e.post(c,{url:"/comment/list",keyCache:"no-cache"},g,function(g){if(g.data.hasOwnProperty("error"))(45===g.data.error.code||-1===g.data.error.code)&&a.sessionLoginExpired();else if(200===g.status&&1===g.data.status&&null!==g.data.result){b.inputCmt="";var h={user_id:a.user.user_id,avatar:C,is_buy_ticket:0,fullname:B,date_add:moment().format("YYYY-MM-DD HH:mm:ss"),comment_id:g.data.result,content:f,user_like:0,up_vote:0,list_image:d,is_admin:a.user.is_admin,total_chilren_comment:0,facebook_id:a.user.facebook_id,zalo_id:a.user.zalo_id,gmail_id:a.user.gmail_id};b.newsComments.unshift(h),b.hideOverlayBook=!0;var i={news_id:b.news.news_id},j=Common.mergeQueryString(i);a.sendGA("News","Send Comment News",f),e.clearCache(c,"news-detail-comment"+j,function(a){},function(a){})}else b.cmtError="Bình luận của bạn bị lỗi. Hãy thử lại sau."},function(a){console.log(a)}))},b.submitCommentBox=function(){if("undefined"!=typeof u&&u.length>0){for(var a=[],c=0;c<u.length;c++)a.push(q(u[c]));h.all(a).then(function(a){var c=[];for(var d in a)c.push(a[d].data.result);b.postComment(c)})}else{var d=[];b.postComment(d)}},b.createHref=function(a,b){var c="";return 1===b?c=/goc-dien-anh/+a:8===b?c=/review/+a:4===b&&(c=/khuyen-mai/+a),c},b.showingDetailNews=function(c,d){a.isMobile&&(b.isLoadingFirst=!0),1===d?a.sendGA("News","News",c):8===d?a.sendGA("News","Reviews",c):4===d&&a.sendGA("News","Promotions",c)},b.cmt=function(){$("html,body").animate({scrollTop:$("body").height()-800},"slow")},setTimeout(function(){var a=f.byQueryString("tab");if("undefined"!=typeof a){var b=$("#detailReviewer").offset().top;$("html,body").animate({scrollTop:b-80},500)}},1e3),window.onscroll=function(){r()},b.topFunction=function(){return $("html, body").animate({scrollTop:0},600),!1},b.viewMoreNews=function(){b.numend+=1,$("#btnNewsRelated").hide()},b.shareNews=function(){FB.ui({method:"share",href:b.currentUrl},function(b){b&&!b.error_code&&(a.sharingCount+=1,a.$apply())})},b.postReply=function(g){var h=$(".inputComment","#reply_"+g).val(),i=a.user.user_id,j={};""!==h&&(j.user_id=i,j.news_id=f.byId(d.params.slug),j.rating=0,j.comment=h,j.p_comment_id=g,e.post(c,{url:"/comment/reply",keyCache:"no-cache"},j,function(d){if(d.data.hasOwnProperty("error")||200!==d.status||1!==d.data.status||null===d.data.result)45===d.data.error.code||-1===d.data.error.code?a.isHideUserTokenExpired=!1:console.log(d.data.error);else{$(".inputComment","#reply_"+g).val("");for(var f={user_id:a.user.user_id,avatar:C,is_buy_ticket:0,fullname:B,date_add:moment().format("YYYY-MM-DD HH:mm:ss"),comment_id:d.data.result,content:h,user_like:0,up_vote:0,p_comment_id:g,is_admin:a.user.is_admin,facebook_id:a.user.facebook_id,zalo_id:a.user.zalo_id,gmail_id:a.user.gmail_id},i=0;i<b.newsComments.length;i++)if(b.newsComments[i].comment_id==g){b.newsComments[i].total_chilren_comment++;break}b.listChildComment[g]?(b.listChildComment[g].unshift(f),b.showCurrentChildComment[g]++):(b.listChildComment[g]=new Array(f),b.showCurrentChildComment[g]=1),b.isReply[g]=!1;var j={news_id:b.news.news_id},k=Common.mergeQueryString(j);a.sendGA("News","Send Comment News",h),e.clearCache(c,"news-detail-comment"+k,function(a){},function(a){})}}))},b.loadMoreChildComment=function(a){b.showCurrentChildComment[a]+=y,b.showCurrentChildComment[a]%z==0&&(x[a]+=z,s(a))},b.autosize=function(a){var b=a.target;setTimeout(function(){b.style.cssText="height:auto",b.style.cssText="height:"+b.scrollHeight+"px"},0),t(a)},b.changeFBAvatar=function(a,b,c){var d="";return d=""!=b&&b?1==c||a.includes("graph.facebook.com")?a:"https://graph.facebook.com/"+b+"/picture?type=square":a}}])}(),function(){angular.module("TIX").controller("SDKController",["$scope","$rootScope","$http","$state","$sce","ParseUrl","Upload","$q","$location","$window","$timeout","CommonService","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n,o=$("#sidebar"),p=o.outerHeight()+15,q=o.find("a"),r=q.map(function(){var a=$($(this).attr("href"));return a.length?a:void 0});console.log(q.eq(3).data("parent")),q.click(function(a){var b=$(this).attr("href"),c="#"===b?0:$(b).offset().top-p+1;$("html, body").stop().animate({scrollTop:c},300),a.preventDefault()}),$(window).scroll(function(){var a=$(this).scrollTop()+p,b=r.map(function(){return $(this).offset().top<a?this:void 0});b=b[b.length-1];var c=b&&b.length?b[0].id:"";if(n!==c){n=c,q.parent().removeClass("active");var d=q.filter("[href='#"+c+"']");if(d.parent().addClass("active"),void 0!==d.data("parent")){var e=d.data("parent");q.filter("[href='#"+e+"']").parent().addClass("active")}}})}])}(),function(){angular.module("TIX").controller("CinemaController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){var b=[],d="undefined"!=typeof a.locationId?a.locationId:1;g.get(c,{url:"/cinema/list?location_id="+d,keyCache:"main-cinemas"+d},function(c){var d=c.data.result;a.listCinemas=d,m();var e=-1,f=0;for(var g in d){var i=d[g],j=_.find(b,function(a){return a.p_cinema_id==i.p_cinema_id});"undefined"==typeof j&&(e+=1,b.push({p_cinema_id:i.p_cinema_id,p_cinema_name:i.p_cinema_name,p_cinema_logo:i.cinema_logo,number:f++,cinemas:[]}));var k={cinema_id:i.cinema_id,cinema_name:i.cinema_name,cinema_image:i.cinema_image,cinema_address:i.cinema_address,cinema_slug:i.cinema_slug,cinema_latitude:i.cinema_latitude,cinema_longitude:i.cinema_longitude,cinema_name_s1:i.cinema_name_s1,cinema_name_s2:i.cinema_name_s2};b[e].cinemas.push(k),parseInt(g)+1===d.length&&(a.listPCinemas=b,onChangeListPCinemas(),h.localStorage.setItem("listPCinemas",JSON.stringify(a.listPCinemas)))}})}function m(){a.listCinemas.length>0&&(b.toolCinemas=a.listCinemas)}a.listPCinemas=[],b.listSessionHomeToday={},b.selectedHomePCinema=0,b.selectedHomeCinema=0,function(d){var e={location_id:a.locationId};g.get(c,{url:"/session/today"+Common.mergeQueryString(e),keyCache:"no-cache"},function(a){b.listSessionHomeToday=a.data.result},function(a){console.log(a)})}(jQuery),l(),b.goToCinemaDetail=function(b,c){$("#headMenu .active").removeClass("active"),a.sendGA("Cinema","Go To Cinema Detail",c)},b.goToCheckout=function(c,e,f){if(3==f)b.isShowModalCGV=!0,b.currentUrlCGV=e,a.sendGA("Payment","Click Session Film",c);else{a.sendGA("Payment","Click Session Film",c);var g=d.href("checkout.index",{sessionId:c});window.open(g,"_blank")}},b.setSelectedPCinema=function(c){b.selectedHomePCinema=c;for(var d in a.listPCinemas)if(a.listPCinemas[d].p_cinema_id==c){var e=a.listPCinemas[d].cinemas;b.setSelectedCinema(e[0].cinema_id);break}},b.isEmptySession=!1,b.setSelectedCinema=function(a){b.selectedHomeCinema=a,"undefined"==typeof b.listSessionHomeToday[a]&&Object.keys(b.listSessionHomeToday).length>0?b.isEmptySession=!0:b.isEmptySession=!1},b.setHeightSessionTab=function(){$(".loadingSession").hide(),j(function(){var a=$("#parentListPCinemas").outerHeight();$("#listCinemas").css("height",a),$("#listMovies").css("height",a)},1e3)},b.getSessionDay=function(a){var b=a.split(" ")[1].split(":");return b[0]+":"+b[1]}}])}(),function(){angular.module("TIX").controller("FilmController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){j(function(){if(a.isMobile)for(var c=3;c<b.listShowingFilms.length;c++)b.filmShowingMore.push(b.listShowingFilms[c]);else $("#nowShowingFilms").slick({slidesPerRow:4,rows:2})},100)}function m(){g.get(c,{url:"/film/list?status=2",keyCache:"showing-film"},function(a){1===a.data.status&&a.data.result.length>0&&(b.listShowingFilms=a.data.result)}),g.get(c,{url:"/film/list?status=1",keyCache:"main-films-coming"},function(a){b.listUpComingFilms=a.data.result,n()},function(a){console.log(a)}),o(b.listNews.type,0,b.listNews.name),o(b.listReview.type,0,b.listReview.name),o(b.listPromotion.type,0,b.listPromotion.name)}function n(){b.listUpComingFilms.length>0&&setTimeout(function(){a.isMobile||$("#upComingFilms").slick({slidesPerRow:4,rows:2})},200)}function o(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1,p_cinema_id:-1};g.get(c,{url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)},function(c){if(0==c.data.result.length)return void(1===a?b.isShowMoreNews=!1:8===a?b.isShowMoreReview=!1:b.isShowMorePromotion=!1);for(var d in c.data.result)b[e].list.push(c.data.result[d]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}b.listFilms=[],b.listShowingFilms=[],b.listUpComingFilms=[],b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.isShowMoreReview=!0,b.isShowMorePromotion=!0,b.listNews={currentOffset:0,count:8,list:[],type:1,id:"showingNews",name:"listNews"},b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"},b.listPromotion={currentOffset:0,count:8,list:[],type:4,id:"showingPromotion",name:"listPromotion"};var p=[4,3,2,1];m(),b.goToDetailNews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("News","Showing News",c)},b.goToDetailPromotion=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Promotion","Showing Promotion",c)},b.goToDetailReviews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Review","Showing Reviews",c)},b.goToFilmsDetail=function(b,c,e){a.sendGA("Film","Go To Film Detail - "+e,c),d.go("main.detail",{slug:b})};var q=b.$watch("listShowingFilms",function(){angular.isDefined(b.listShowingFilms)&&b.listShowingFilms.length>0&&(b.toolFilms=b.listShowingFilms,l(),q())});b.showMoreFilms=function(){b.isShowMoreFilms=!0},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),o(b[e].type,b[e].currentOffset,b[e].name,a)},b.playTrailer=function(a){a.preventDefault(),a.stopPropagation(),b.watchTrailer(a.currentTarget.dataset.trailer)},b.watchTrailer=function(a){var c="https://www.youtube.com/embed/",d="autoplay=1";b.trailerUrl=e.trustAsResourceUrl(c+a+"?"+d),$("#modalTrailer").modal("show"),$("body").removeClass("modal-open"),$("body").css("padding-right",0),b.$evalAsync()},b.isBigNews=function(a){return-1!==p.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("FilmRecommendController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){g.get(c,{url:"/film/list?status=1",keyCache:"main-films-coming"},function(a){b.listUpComingFilms=a.data.result,n()},function(a){console.log(a)}),m(b.listNews.type,0,b.listNews.name),m(b.listReview.type,0,b.listReview.name),m(b.listPromotion.type,0,b.listPromotion.name)}function m(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1,p_cinema_id:-1};g.get(c,{url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)},function(c){if(0==c.data.result.length)return void(1===a?b.isShowMoreNews=!1:8===a?b.isShowMoreReview=!1:b.isShowMorePromotion=!1);for(var d in c.data.result)b[e].list.push(c.data.result[d]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}function n(){b.listUpComingFilms.length>0&&setTimeout(function(){a.isMobile||$("#upComingFilms").slick({slidesPerRow:4,rows:2})},200)}b.listUpComingFilms=[],b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.isShowMoreReview=!0,b.isShowMorePromotion=!0,b.listNews={currentOffset:0,count:8,list:[],type:1,id:"showingNews",name:"listNews"},b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"},b.listPromotion={currentOffset:0,count:8,list:[],type:4,id:"showingPromotion",name:"listPromotion"};var o=[4,3,2,1];l(),b.goToDetailNews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("News","Showing News",c)},b.goToDetailPromotion=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Promotion","Showing Promotion",c)},b.goToDetailReviews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Review","Showing Reviews",c)},b.goToFilmsDetail=function(b,c,e){a.sendGA("Film","Go To Film Detail - "+e,c),d.go("main.detail",{slug:b})},b.showMoreFilms=function(){b.isShowMoreFilms=!0},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),m(b[e].type,b[e].currentOffset,b[e].name,a)},b.playTrailer=function(a){a.preventDefault(),a.stopPropagation(),b.watchTrailer(a.currentTarget.dataset.trailer)},b.watchTrailer=function(a){var c="https://www.youtube.com/embed/",d="autoplay=1";b.trailerUrl=e.trustAsResourceUrl(c+a+"?"+d),$("#modalTrailer").modal("show"),$("body").removeClass("modal-open"),$("body").css("padding-right",0),b.$evalAsync()},b.isBigNews=function(a){return-1!==o.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("FilmUpComingController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){g.get(c,{url:"/film/list?status=1",keyCache:"main-films-coming"},function(a){b.listUpComingFilms=a.data.result,n()},function(a){console.log(a)}),m(b.listNews.type,0,b.listNews.name),m(b.listReview.type,0,b.listReview.name),m(b.listPromotion.type,0,b.listPromotion.name)}function m(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1,p_cinema_id:-1};g.get(c,{url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)
},function(c){if(0==c.data.result.length)return void(1===a?b.isShowMoreNews=!1:8===a?b.isShowMoreReview=!1:b.isShowMorePromotion=!1);for(var d in c.data.result)b[e].list.push(c.data.result[d]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}function n(){b.listUpComingFilms.length>0&&setTimeout(function(){a.isMobile||$("#upComingFilms").slick({slidesPerRow:4,rows:2})},200)}b.listUpComingFilms=[],b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.isShowMoreReview=!0,b.isShowMorePromotion=!0,b.listNews={currentOffset:0,count:8,list:[],type:1,id:"showingNews",name:"listNews"},b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"},b.listPromotion={currentOffset:0,count:8,list:[],type:4,id:"showingPromotion",name:"listPromotion"};var o=[4,3,2,1];l(),b.goToDetailNews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("News","Showing News",c)},b.goToDetailPromotion=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Promotion","Showing Promotion",c)},b.goToDetailReviews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Review","Showing Reviews",c)},b.goToFilmsDetail=function(b,c,e){a.sendGA("Film","Go To Film Detail - "+e,c),d.go("main.detail",{slug:b})},b.showMoreFilms=function(){b.isShowMoreFilms=!0},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),m(b[e].type,b[e].currentOffset,b[e].name,a)},b.playTrailer=function(a){a.preventDefault(),a.stopPropagation(),b.watchTrailer(a.currentTarget.dataset.trailer)},b.watchTrailer=function(a){var c="https://www.youtube.com/embed/",d="autoplay=1";b.trailerUrl=e.trustAsResourceUrl(c+a+"?"+d),$("#modalTrailer").modal("show"),$("body").removeClass("modal-open"),$("body").css("padding-right",0),b.$evalAsync()},b.isBigNews=function(a){return-1!==o.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("FilmVietController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){g.get(c,{url:"/film/category?status=1&category=0",keyCache:"upcoming-category-filmviet"},function(a){b.listUpComingFilms=a.data.result,0===b.listUpComingFilms.length&&(b.isEmptyFilmUpcoming=!0),n()},function(a){console.log(a)}),g.get(c,{url:"/film/category?status=2&category=0",keyCache:"showing-category-filmviet"},function(a){b.listShowingFilms=a.data.result,0===b.listShowingFilms.length&&(b.isEmptyFilmShowing=!0),m()},function(a){console.log(a)}),o(b.listNews.type,0,b.listNews.name),o(b.listReview.type,0,b.listReview.name),o(b.listPromotion.type,0,b.listPromotion.name)}function m(){b.listShowingFilms.length>0&&j(function(){if(a.isMobile)for(var c=3;c<b.listShowingFilms.length;c++)b.filmShowingMore.push(b.listShowingFilms[c]);else $("#nowShowingFilms").slick({slidesPerRow:4,rows:2})},100)}function n(){b.listUpComingFilms.length>0&&j(function(){a.isMobile||$("#upComingFilms").slick({slidesPerRow:4,rows:2})},200)}function o(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1,p_cinema_id:-1};g.get(c,{url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)},function(c){if(0==c.data.result.length)return void(1===a?b.isShowMoreNews=!1:8===a?b.isShowMoreReview=!1:b.isShowMorePromotion=!1);for(var d in c.data.result)b[e].list.push(c.data.result[d]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}b.listUpComingFilms=[],b.listShowingFilms=[],b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.isShowMoreReview=!0,b.isShowMorePromotion=!0,b.isEmptyFilmUpcoming=!1,b.isEmptyFilmShowing=!1,b.listNews={currentOffset:0,count:8,list:[],type:1,id:"showingNews",name:"listNews"},b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"},b.listPromotion={currentOffset:0,count:8,list:[],type:4,id:"showingPromotion",name:"listPromotion"};var p=[4,3,2,1];l(),b.goToDetailNews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("News","Showing News",c)},b.goToDetailPromotion=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Promotion","Showing Promotion",c)},b.goToDetailReviews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Review","Showing Reviews",c)},b.goToFilmsDetail=function(b,c,e){a.sendGA("Film","Go To Film Detail - "+e,c),d.go("main.detail",{slug:b})},b.showMoreFilms=function(){b.isShowMoreFilms=!0},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),o(b[e].type,b[e].currentOffset,b[e].name,a)},b.playTrailer=function(a){a.preventDefault(),a.stopPropagation(),b.watchTrailer(a.currentTarget.dataset.trailer)},b.watchTrailer=function(a){var c="https://www.youtube.com/embed/",d="autoplay=1";b.trailerUrl=e.trustAsResourceUrl(c+a+"?"+d),$("#modalTrailer").modal("show"),$("body").removeClass("modal-open"),$("body").css("padding-right",0),b.$evalAsync()},b.isBigNews=function(a){return-1!==p.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("FilmActionController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){g.get(c,{url:"/film/category?status=1&category=4",keyCache:"upcoming-category-filmaction"},function(a){b.listUpComingFilms=a.data.result,0===b.listUpComingFilms.length&&(b.isEmptyFilmUpcoming=!0),n()},function(a){console.log(a)}),g.get(c,{url:"/film/category?status=2&category=4",keyCache:"showing-category-filmaction"},function(a){b.listShowingFilms=a.data.result,0===b.listShowingFilms.length&&(b.isEmptyFilmShowing=!0),m()},function(a){console.log(a)}),o(b.listNews.type,0,b.listNews.name),o(b.listReview.type,0,b.listReview.name),o(b.listPromotion.type,0,b.listPromotion.name)}function m(){b.listShowingFilms.length>0&&j(function(){if(a.isMobile)for(var c=3;c<b.listShowingFilms.length;c++)b.filmShowingMore.push(b.listShowingFilms[c]);else $("#nowShowingFilms").slick({slidesPerRow:4,rows:2})},100)}function n(){b.listUpComingFilms.length>0&&setTimeout(function(){a.isMobile||$("#upComingFilms").slick({slidesPerRow:4,rows:2})},200)}function o(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1,p_cinema_id:-1};g.get(c,{url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)},function(c){if(0==c.data.result.length)return void(1===a?b.isShowMoreNews=!1:8===a?b.isShowMoreReview=!1:b.isShowMorePromotion=!1);for(var d in c.data.result)b[e].list.push(c.data.result[d]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}b.listUpComingFilms=[],b.listShowingFilms=[],b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.isShowMoreReview=!0,b.isShowMorePromotion=!0,b.isEmptyFilmUpcoming=!1,b.isEmptyFilmShowing=!1,b.listNews={currentOffset:0,count:8,list:[],type:1,id:"showingNews",name:"listNews"},b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"},b.listPromotion={currentOffset:0,count:8,list:[],type:4,id:"showingPromotion",name:"listPromotion"};var p=[4,3,2,1];l(),b.goToDetailNews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("News","Showing News",c)},b.goToDetailPromotion=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Promotion","Showing Promotion",c)},b.goToDetailReviews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Review","Showing Reviews",c)},b.goToFilmsDetail=function(b,c,e){a.sendGA("Film","Go To Film Detail - "+e,c),d.go("main.detail",{slug:b})},b.showMoreFilms=function(){b.isShowMoreFilms=!0},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),o(b[e].type,b[e].currentOffset,b[e].name,a)},b.playTrailer=function(a){a.preventDefault(),a.stopPropagation(),b.watchTrailer(a.currentTarget.dataset.trailer)},b.watchTrailer=function(a){var c="https://www.youtube.com/embed/",d="autoplay=1";b.trailerUrl=e.trustAsResourceUrl(c+a+"?"+d),$("#modalTrailer").modal("show"),$("body").removeClass("modal-open"),$("body").css("padding-right",0),b.$evalAsync()},b.isBigNews=function(a){return-1!==p.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("FilmAnimationController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){g.get(c,{url:"/film/category?status=1&category=3",keyCache:"upcoming-category-filmanimation"},function(a){b.listUpComingFilms=a.data.result,0===b.listUpComingFilms.length&&(b.isEmptyFilmUpcoming=!0),n()},function(a){console.log(a)}),g.get(c,{url:"/film/category?status=2&category=3",keyCache:"showing-category-filmanimation"},function(a){b.listShowingFilms=a.data.result,0===b.listShowingFilms.length&&(b.isEmptyFilmShowing=!0),m()},function(a){console.log(a)}),o(b.listNews.type,0,b.listNews.name),o(b.listReview.type,0,b.listReview.name),o(b.listPromotion.type,0,b.listPromotion.name)}function m(){b.listShowingFilms.length>0&&j(function(){if(a.isMobile)for(var c=3;c<b.listShowingFilms.length;c++)b.filmShowingMore.push(b.listShowingFilms[c]);else $("#nowShowingFilms").slick({slidesPerRow:4,rows:2})},100)}function n(){b.listUpComingFilms.length>0&&setTimeout(function(){a.isMobile||$("#upComingFilms").slick({slidesPerRow:4,rows:2})},200)}function o(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1,p_cinema_id:-1};g.get(c,{url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)},function(c){if(0==c.data.result.length)return void(1===a?b.isShowMoreNews=!1:8===a?b.isShowMoreReview=!1:b.isShowMorePromotion=!1);for(var d in c.data.result)b[e].list.push(c.data.result[d]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}b.listUpComingFilms=[],b.listShowingFilms=[],b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.isShowMoreReview=!0,b.isShowMorePromotion=!0,b.isEmptyFilmUpcoming=!1,b.isEmptyFilmShowing=!1,b.listNews={currentOffset:0,count:8,list:[],type:1,id:"showingNews",name:"listNews"},b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"},b.listPromotion={currentOffset:0,count:8,list:[],type:4,id:"showingPromotion",name:"listPromotion"};var p=[4,3,2,1];l(),b.goToDetailNews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("News","Showing News",c)},b.goToDetailPromotion=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Promotion","Showing Promotion",c)},b.goToDetailReviews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Review","Showing Reviews",c)},b.goToFilmsDetail=function(b,c,e){a.sendGA("Film","Go To Film Detail - "+e,c),d.go("main.detail",{slug:b})},b.showMoreFilms=function(){b.isShowMoreFilms=!0},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),o(b[e].type,b[e].currentOffset,b[e].name,a)},b.playTrailer=function(a){a.preventDefault(),a.stopPropagation(),b.watchTrailer(a.currentTarget.dataset.trailer)},b.watchTrailer=function(a){var c="https://www.youtube.com/embed/",d="autoplay=1";b.trailerUrl=e.trustAsResourceUrl(c+a+"?"+d),$("#modalTrailer").modal("show"),$("body").removeClass("modal-open"),$("body").css("padding-right",0),b.$evalAsync()},b.isBigNews=function(a){return-1!==p.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("FilmComedyController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){g.get(c,{url:"/film/category?status=1&category=1",keyCache:"upcoming-category-filmcomedy"},function(a){b.listUpComingFilms=a.data.result,0===b.listUpComingFilms.length&&(b.isEmptyFilmUpcoming=!0),n()},function(a){console.log(a)}),g.get(c,{url:"/film/category?status=2&category=1",keyCache:"showing-category-filmcomedy"},function(a){b.listShowingFilms=a.data.result,0===b.listShowingFilms.length&&(b.isEmptyFilmShowing=!0),m()},function(a){console.log(a)}),o(b.listNews.type,0,b.listNews.name),o(b.listReview.type,0,b.listReview.name),o(b.listPromotion.type,0,b.listPromotion.name)}function m(){b.listShowingFilms.length>0&&j(function(){if(a.isMobile)for(var c=3;c<b.listShowingFilms.length;c++)b.filmShowingMore.push(b.listShowingFilms[c]);else $("#nowShowingFilms").slick({slidesPerRow:4,rows:2})},100)}function n(){b.listUpComingFilms.length>0&&setTimeout(function(){a.isMobile||$("#upComingFilms").slick({slidesPerRow:4,rows:2})},200)}function o(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1,p_cinema_id:-1};g.get(c,{url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)},function(c){if(0==c.data.result.length)return void(1===a?b.isShowMoreNews=!1:8===a?b.isShowMoreReview=!1:b.isShowMorePromotion=!1);for(var d in c.data.result)b[e].list.push(c.data.result[d]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}b.listUpComingFilms=[],b.listShowingFilms=[],b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.isShowMoreReview=!0,b.isShowMorePromotion=!0,b.isEmptyFilmUpcoming=!1,b.isEmptyFilmShowing=!1,b.listNews={currentOffset:0,count:8,list:[],type:1,id:"showingNews",name:"listNews"},b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"},b.listPromotion={currentOffset:0,count:8,list:[],type:4,id:"showingPromotion",name:"listPromotion"};var p=[4,3,2,1];l(),b.goToDetailNews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("News","Showing News",c)},b.goToDetailPromotion=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Promotion","Showing Promotion",c)},b.goToDetailReviews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Review","Showing Reviews",c)},b.goToFilmsDetail=function(b,c,e){a.sendGA("Film","Go To Film Detail - "+e,c),d.go("main.detail",{slug:b})},b.showMoreFilms=function(){b.isShowMoreFilms=!0},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),o(b[e].type,b[e].currentOffset,b[e].name,a)},b.playTrailer=function(a){a.preventDefault(),a.stopPropagation(),b.watchTrailer(a.currentTarget.dataset.trailer)},b.watchTrailer=function(a){var c="https://www.youtube.com/embed/",d="autoplay=1";b.trailerUrl=e.trustAsResourceUrl(c+a+"?"+d),$("#modalTrailer").modal("show"),$("body").removeClass("modal-open"),$("body").css("padding-right",0),b.$evalAsync()},b.isBigNews=function(a){return-1!==p.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("FilmHorrorController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){g.get(c,{url:"/film/category?status=1&category=2",keyCache:"upcoming-category-filmhorror"},function(a){b.listUpComingFilms=a.data.result,0===b.listUpComingFilms.length&&(b.isEmptyFilmUpcoming=!0),n()},function(a){console.log(a)}),g.get(c,{url:"/film/category?status=2&category=2",keyCache:"showing-category-filmhorror"},function(a){b.listShowingFilms=a.data.result,0===b.listShowingFilms.length&&(b.isEmptyFilmShowing=!0),m()},function(a){console.log(a)}),o(b.listNews.type,0,b.listNews.name),o(b.listReview.type,0,b.listReview.name),o(b.listPromotion.type,0,b.listPromotion.name)}function m(){b.listShowingFilms.length>0&&j(function(){if(a.isMobile)for(var c=3;c<b.listShowingFilms.length;c++)b.filmShowingMore.push(b.listShowingFilms[c]);else $("#nowShowingFilms").slick({slidesPerRow:4,rows:2})},100)}function n(){b.listUpComingFilms.length>0&&setTimeout(function(){a.isMobile||$("#upComingFilms").slick({slidesPerRow:4,rows:2})},200)}function o(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1,p_cinema_id:-1};g.get(c,{url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)},function(c){if(0==c.data.result.length)return void(1===a?b.isShowMoreNews=!1:8===a?b.isShowMoreReview=!1:b.isShowMorePromotion=!1);for(var d in c.data.result)b[e].list.push(c.data.result[d]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}b.listUpComingFilms=[],b.listShowingFilms=[],b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.isShowMoreReview=!0,b.isShowMorePromotion=!0,b.isEmptyFilmUpcoming=!1,b.isEmptyFilmShowing=!1,b.listNews={currentOffset:0,count:8,list:[],type:1,id:"showingNews",name:"listNews"},b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"},b.listPromotion={currentOffset:0,count:8,list:[],type:4,id:"showingPromotion",name:"listPromotion"};var p=[4,3,2,1];l(),b.goToDetailNews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("News","Showing News",c)},b.goToDetailPromotion=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Promotion","Showing Promotion",c)},b.goToDetailReviews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Review","Showing Reviews",c)},b.goToFilmsDetail=function(b,c,e){a.sendGA("Film","Go To Film Detail - "+e,c),d.go("main.detail",{slug:b})},b.showMoreFilms=function(){b.isShowMoreFilms=!0},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),o(b[e].type,b[e].currentOffset,b[e].name,a)},b.playTrailer=function(a){a.preventDefault(),a.stopPropagation(),b.watchTrailer(a.currentTarget.dataset.trailer)},b.watchTrailer=function(a){var c="https://www.youtube.com/embed/",d="autoplay=1";b.trailerUrl=e.trustAsResourceUrl(c+a+"?"+d),$("#modalTrailer").modal("show"),$("body").removeClass("modal-open"),$("body").css("padding-right",0),b.$evalAsync()},b.isBigNews=function(a){return-1!==p.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("NewsController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){j(function(){b.isLoadingTrailer=!1},1e3),m(b.listNews.type,0,b.listNews.name),setTimeout(function(){isScrollBlock=i.byQueryString("scr"),"undefined"!=typeof isScrollBlock&&$("#navbarHeader .menu."+isScrollBlock).click()},2500)}function m(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1,p_cinema_id:-1};g.get(c,{url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)},function(a){if(0==a.data.result.length)return void(b.isShowMoreNews=!1);for(var c in a.data.result)b[e].list.push(a.data.result[c]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.listNews={currentOffset:0,count:8,list:[],type:1,id:"showingNews",name:"listNews"};var n=[4,3,2,1];l(),b.goToDetailNews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("News","Showing News",c)},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),m(b[e].type,b[e].currentOffset,b[e].name,a)},b.isBigNews=function(a){return-1!==n.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("PromotionBHDController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){j(function(){b.isLoadingTrailer=!1},1e3),m(b.listPromotion.type,0,b.listPromotion.name),setTimeout(function(){isScrollBlock=i.byQueryString("scr"),"undefined"!=typeof isScrollBlock&&$("#navbarHeader .menu."+isScrollBlock).click()},2500)}function m(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1,p_cinema_id:4};g.get(c,{url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)},function(a){if(0==a.data.result.length)return void(b.isShowMoreNews=!1);for(var c in a.data.result)b[e].list.push(a.data.result[c]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.listNews={currentOffset:0,count:8,list:[],type:1,id:"showingNews",name:"listNews"},b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"},b.listPromotion={currentOffset:0,count:8,list:[],type:4,id:"showingPromotion",name:"listPromotion"};var n=[4,3,2,1];l(),b.goToDetailPromotion=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Promotion","Showing Promotion",c)},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),m(b[e].type,b[e].currentOffset,b[e].name,a)},b.isBigNews=function(a){return-1!==n.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("PromotionGalaxyController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){j(function(){b.isLoadingTrailer=!1},1e3),m(b.listPromotion.type,0,b.listPromotion.name),setTimeout(function(){isScrollBlock=i.byQueryString("scr"),"undefined"!=typeof isScrollBlock&&$("#navbarHeader .menu."+isScrollBlock).click()},2500)}function m(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1,p_cinema_id:2};g.get(c,{url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)},function(a){if(0==a.data.result.length)return void(b.isShowMoreNews=!1);for(var c in a.data.result)b[e].list.push(a.data.result[c]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.listNews={currentOffset:0,count:8,list:[],type:1,id:"showingNews",name:"listNews"},b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"},b.listPromotion={currentOffset:0,count:8,list:[],type:4,id:"showingPromotion",name:"listPromotion"};var n=[4,3,2,1];l(),b.goToDetailPromotion=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Promotion","Showing Promotion",c)},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),m(b[e].type,b[e].currentOffset,b[e].name,a)},b.isBigNews=function(a){return-1!==n.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("PromotionLotteController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){j(function(){b.isLoadingTrailer=!1},1e3),m(b.listPromotion.type,0,b.listPromotion.name),setTimeout(function(){isScrollBlock=i.byQueryString("scr"),"undefined"!=typeof isScrollBlock&&$("#navbarHeader .menu."+isScrollBlock).click()},2500)}function m(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1,p_cinema_id:1};g.get(c,{url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)},function(a){if(0==a.data.result.length)return void(b.isShowMoreNews=!1);for(var c in a.data.result)b[e].list.push(a.data.result[c]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.listNews={currentOffset:0,count:8,list:[],type:1,id:"showingNews",name:"listNews"},b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"},b.listPromotion={currentOffset:0,count:8,list:[],type:4,id:"showingPromotion",name:"listPromotion"};var n=[4,3,2,1];l(),b.goToDetailPromotion=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Promotion","Showing Promotion",c)},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),m(b[e].type,b[e].currentOffset,b[e].name,a)},b.isBigNews=function(a){return-1!==n.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("PromotionOtherController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){j(function(){b.isLoadingTrailer=!1},1e3),m(b.listPromotion.type,0,b.listPromotion.name),setTimeout(function(){isScrollBlock=i.byQueryString("scr"),"undefined"!=typeof isScrollBlock&&$("#navbarHeader .menu."+isScrollBlock).click()},2500)}function m(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1,p_cinema_id:-1};g.get(c,{url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)},function(a){if(0==a.data.result.length)return void(b.isShowMoreNews=!1);for(var c in a.data.result)b[e].list.push(a.data.result[c]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.listNews={currentOffset:0,count:8,list:[],type:1,id:"showingNews",name:"listNews"},b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"},b.listPromotion={currentOffset:0,count:8,list:[],type:4,id:"showingPromotion",name:"listPromotion"};var n=[4,3,2,1];l(),b.goToDetailPromotion=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Promotion","Showing Promotion",c)},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),m(b[e].type,b[e].currentOffset,b[e].name,a)},b.isBigNews=function(a){return-1!==n.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("PromotionController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){j(function(){b.isLoadingTrailer=!1},1e3),m(b.listPromotion.type,0,b.listPromotion.name),setTimeout(function(){isScrollBlock=i.byQueryString("scr"),"undefined"!=typeof isScrollBlock&&$("#navbarHeader .menu."+isScrollBlock).click()},2500)}function m(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1,p_cinema_id:0};g.get(c,{url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)},function(a){if(0==a.data.result.length)return void(b.isShowMoreNews=!1);for(var c in a.data.result)b[e].list.push(a.data.result[c]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.listNews={currentOffset:0,count:8,list:[],type:1,id:"showingNews",name:"listNews"},b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"},b.listPromotion={currentOffset:0,count:8,list:[],type:4,id:"showingPromotion",name:"listPromotion"};var n=[4,3,2,1];l(),b.goToDetailPromotion=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Promotion","Showing Promotion",c)},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),m(b[e].type,b[e].currentOffset,b[e].name,a)},b.isBigNews=function(a){return-1!==n.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("ReviewTIXController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){j(function(){b.isLoadingTrailer=!1},1e3),m(b.listReview.type,0,b.listReview.name),setTimeout(function(){isScrollBlock=i.byQueryString("scr"),"undefined"!=typeof isScrollBlock&&$("#navbarHeader .menu."+isScrollBlock).click()},2500)}function m(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1,p_cinema_id:-1};g.get(c,{
url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)},function(a){if(0==a.data.result.length)return void(b.isShowMoreNews=!1);for(var c in a.data.result)b[e].list.push(a.data.result[c]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"};var n=[4,3,2,1];l(),b.goToDetailReviews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Review","Showing Reviews",c)},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),m(b[e].type,b[e].currentOffset,b[e].name,a)},b.isBigNews=function(a){return-1!==n.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("ReviewPublicController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){j(function(){b.isLoadingTrailer=!1},1e3),m(b.listReview.type,0,b.listReview.name),setTimeout(function(){isScrollBlock=i.byQueryString("scr"),"undefined"!=typeof isScrollBlock&&$("#navbarHeader .menu."+isScrollBlock).click()},2500)}function m(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1,p_cinema_id:-1};g.get(c,{url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)},function(a){if(0==a.data.result.length)return void(b.isShowMoreNews=!1);for(var c in a.data.result)b[e].list.push(a.data.result[c]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"};var n=[4,3,2,1];l(),b.goToDetailReviews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Review","Showing Reviews",c)},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),m(b[e].type,b[e].currentOffset,b[e].name,a)},b.isBigNews=function(a){return-1!==n.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("ReviewController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){j(function(){b.isLoadingTrailer=!1},1e3),m(b.listReview.type,0,b.listReview.name),setTimeout(function(){isScrollBlock=i.byQueryString("scr"),"undefined"!=typeof isScrollBlock&&$("#navbarHeader .menu."+isScrollBlock).click()},2500)}function m(a,d,e,f){angular.isUndefined(f)&&(f=null);var h={type_id:a,offset:d,count:8,is_hot:-1};g.get(c,{url:"/news/list"+Common.mergeQueryString(h),keyCache:"news"+Common.mergeQueryString(h)},function(a){if(0==a.data.result.length)return void(b.isShowMoreNews=!1);for(var c in a.data.result)b[e].list.push(a.data.result[c]);null!==f&&$(f.target).html("XEM THÊM"),b[e].currentOffset+=b[e].count,b[e].currentOffset>b[e].count&&setTimeout(function(){$("html,body").animate({scrollTop:$("#"+b[e].id+" .news:nth-child("+(b[e].currentOffset-b[e].count+1)+")").offset().top-80},"slow")},200)},function(a){console.log(a)})}b.isShowMoreFilms=!1,b.isShowMoreNews=!0,b.listReview={currentOffset:0,count:8,list:[],type:8,id:"showingReview",name:"listReview"};var n=[4,3,2,1];l(),b.goToDetailReviews=function(b,c,d){$("#headMenu .active").removeClass("active"),a.sendGA("Review","Showing Reviews",c)},b.viewMoreNews=function(a){var c=a.target,d=c.dataset,e=d.type;$(c).html('<img class="smallLoading" src="app/assets/img/loading.gif" />'),m(b[e].type,b[e].currentOffset,b[e].name,a)},b.isBigNews=function(a){return-1!==n.indexOf((parseInt(a)+1)%8)?!0:!1},b.checkSmallNews=function(a,b){var c,d;for(c=3;b>c;c+=8){if(d=c+5,a>c&&d>a)return!0;if(c>a)return!1}}}])}(),function(){angular.module("TIX").controller("SessionController",["$rootScope","$scope","$http","$state","$sce","$cookies","APIService","$window","ParseUrl","$timeout","ngMeta",function(a,b,c,d,e,f,g,h,i,j,k){function l(){var b=[],d="undefined"!=typeof a.locationId?a.locationId:1;g.get(c,{url:"/cinema/list?location_id="+d,keyCache:"main-cinemas"+d},function(c){var d=c.data.result;a.listCinemas=d,m();var e=-1,f=0;for(var g in d){var i=d[g],j=_.find(b,function(a){return a.p_cinema_id==i.p_cinema_id});"undefined"==typeof j&&(e+=1,b.push({p_cinema_id:i.p_cinema_id,p_cinema_name:i.p_cinema_name,p_cinema_logo:i.cinema_logo,number:f++,cinemas:[]}));var k={cinema_id:i.cinema_id,cinema_name:i.cinema_name,cinema_image:i.cinema_image,cinema_address:i.cinema_address,cinema_slug:i.cinema_slug,cinema_latitude:i.cinema_latitude,cinema_longitude:i.cinema_longitude,cinema_name_s1:i.cinema_name_s1,cinema_name_s2:i.cinema_name_s2};b[e].cinemas.push(k),parseInt(g)+1===d.length&&(a.listPCinemas=b,onChangeListPCinemas(),h.localStorage.setItem("listPCinemas",JSON.stringify(a.listPCinemas)))}})}function m(){a.listCinemas.length>0&&(b.toolCinemas=a.listCinemas)}a.listPCinemas=[],b.listSessionHomeToday={},b.selectedHomePCinema=0,b.selectedHomeCinema=0,function(d){var e={location_id:a.locationId};g.get(c,{url:"/session/today"+Common.mergeQueryString(e),keyCache:"no-cache"},function(a){b.listSessionHomeToday=a.data.result},function(a){console.log(a)})}(jQuery),l(),b.goToCinemaDetail=function(b,c){$("#headMenu .active").removeClass("active"),a.sendGA("Cinema","Go To Cinema Detail",c)},b.goToCheckout=function(c,e,f){if(3==f)b.isShowModalCGV=!0,b.currentUrlCGV=e,a.sendGA("Payment","Click Session Film",c);else{a.sendGA("Payment","Click Session Film",c);var g=d.href("checkout.index",{sessionId:c});window.open(g,"_blank")}},b.setSelectedPCinema=function(c){b.selectedHomePCinema=c;for(var d in a.listPCinemas)if(a.listPCinemas[d].p_cinema_id==c){var e=a.listPCinemas[d].cinemas;b.setSelectedCinema(e[0].cinema_id);break}},b.isEmptySession=!1,b.setSelectedCinema=function(a){b.selectedHomeCinema=a,"undefined"==typeof b.listSessionHomeToday[a]&&Object.keys(b.listSessionHomeToday).length>0?b.isEmptySession=!0:b.isEmptySession=!1},b.setHeightSessionTab=function(){$(".loadingSession").hide(),j(function(){var a=$("#parentListPCinemas").outerHeight();$("#listCinemas").css("height",a),$("#listMovies").css("height",a)},1e3)},b.getSessionDay=function(a){var b=a.split(" ")[1].split(":");return b[0]+":"+b[1]}}])}(),function(){angular.module("TIX").controller("WebviewController",["$rootScope","$scope","$http","$state","ParseUrl",function(a,b,c,d,e){var f=parseInt(e.byQueryString("status"));switch(a.isHideFooter=!0,a.isHideHeader=!0,b.webviewPaymentStatus="Fail",f){case 0:b.webviewPaymentStatus="Waiting";break;case 1:b.webviewPaymentStatus="Success";break;default:b.webviewPaymentStatus="Fail"}}])}();